

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>7. Probability and land-use &#8212; Near or far</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'probability';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="6. Rivers: new map data" href="hex-3000-m-rivers.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="titlepage.html">
  
  
  
  
  
    <p class="title logo__title">Near or far</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="bielersee_results.html">1. Bielersee</a></li>
<li class="toctree-l1"><a class="reference internal" href="lac_leman.html">2. Lac Léman</a></li>
<li class="toctree-l1"><a class="reference internal" href="project_results.html">3. All Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="consider_distance_to_river.html">4. River and lake intersections</a></li>
<li class="toctree-l1"><a class="reference internal" href="hex-3000-m.html">5. Lakes: new map data</a></li>
<li class="toctree-l1"><a class="reference internal" href="hex-3000-m-rivers.html">6. Rivers: new map data</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">7. Probability and land-use</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/hammerdirt-analyst/landuse" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/hammerdirt-analyst/landuse/issues/new?title=Issue%20on%20page%20%2Fprobability.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Probability and land-use</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation">7.1. Motivation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#proposition">7.1.1. Proposition</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methods-of-inference">7.2. Methods of inference</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#binomial-distribution">7.2.1. Binomial distribution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#odds-and-log-odds">7.2.2. Odds and log odds</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#variables">7.3. Variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data">7.4. Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#survey-data">7.4.1. Survey data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-land-use-data">7.4.2. The land use data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#aggregating-scaling-and-binning">7.4.2.1. Aggregating, scaling and binning</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-the-threshold-one-object-cigarette-ends">7.5. Testing the threshold one object: cigarette ends</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-frequency-of-exceeding-the-threshold-cigarette-ends">7.5.1. The frequency of exceeding the threshold: cigarette ends</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-probability-of-exceeding-the-threshold-cigarette-ends">7.5.2. The probability of exceeding the threshold: cigarette ends</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-prior">7.5.2.1. The prior</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-a-threshold-survey-area">7.6. Testing a threshold: Survey area</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-chance-of-exceeding-the-threshold-at-each-lake">7.6.1. The chance of exceeding the threshold at each lake</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-chance-of-exceeding-the-threshold-at-each-location-on-a-lake">7.6.2. The chance of exceeding the threshold at each location on a lake</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-lake-that-has-the-highest-probability-of-exceeding-the-threshhold">7.6.2.1. The lake that has the highest probability of exceeding the threshhold</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#details-the-location-that-has-the-highest-probability">7.6.3. Details: the location that has the highest probability</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#effects-of-land-use-how-does-land-use-change-the-probability-of-exceeding-the-threshhold">7.7. Effects of land use: How does land use change the probability of exceeding the threshhold?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-aare-survey-area">7.7.1. The Aare survey area</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#all-survey-results-logistic-regression">7.7.2. All survey results: Logistic regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#infrastructure">7.7.3. Infrastructure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#urbanization">7.7.4. Urbanization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forest">7.7.5. Forest</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#undefined">7.7.6. Undefined</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#recreation">7.7.7. Recreation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distance-to-river-intersection">7.7.8. Distance to river intersection</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#length-of-river-intersects">7.7.9. Length of river intersects</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="tex2jax_ignore mathjax_ignore section" id="probability-and-land-use">
<h1><span class="section-number">7. </span>Probability and land-use<a class="headerlink" href="#probability-and-land-use" title="Permalink to this headline">#</a></h1>
<p><em>draft: need to add definition and method for logistic regression</em></p>
<p>The introduction of a threshhold value for beach-litter density by the EU and the reasons for the application of that threshhold mark a change in the importance and use of beach litter data. Prior to the establishment of a threshold the primary use of beach-litter data was to <em>educate</em> the public and in some instances define a link with mortality and mobidity of marine species. At present beach-litter survey results are also considered on the numerical distance from a stated goal. That goal is defined in <strong>pieces of trash for every 100 m</strong>. The goal is based on principal of precaution, that means we are unsure of the long term consequences and it would be best to minimize exposure if possible.<a class="reference external" href="https://mcc.jrc.ec.europa.eu/main/dev.py?N=41&amp;O=454">EU Threshold Value for Macro Litter on Coastlines</a></p>
<p>With the announcement of a threshhold value <strong>there was no subsequent recomendation for changing the methods of sampling</strong>. Consequently, this environmental assessment relies on the recorded observations of volunteers following a standard protocol. According to the journal <a class="reference external" href="https://www.nature.com/articles/s41893-019-0390-3">Nature</a>, programs that include the involvement of citizens in scientific research and/or knowledge production, can complement and ultimately improve the Sustainale Development Goals (SDG) reporting process. Beach litter applies specifically to SDG 14, <strong>the target of achieving substantial reductions in marine pollution</strong>.</p>
<div class="section" id="motivation">
<h2><span class="section-number">7.1. </span>Motivation<a class="headerlink" href="#motivation" title="Permalink to this headline">#</a></h2>
<p>Each encounter is local by definition (the location can be defined by a GPS point) and the time/date is unique for each survey for each person, or group of people doing a survey. Often the people that conduct the survey are beach-users themselves and local to the region. The encounter is the result of the desire of the person to remove these objects from the environment. <strong>That is, the motivation to remove the object was present before the desire to record its existence</strong>.</p>
<div class="section" id="proposition">
<h3><span class="section-number">7.1.1. </span>Proposition<a class="headerlink" href="#proposition" title="Permalink to this headline">#</a></h3>
<ol class="arabic simple">
<li><p>Data from beach litter surveys can be used to estimate survey results at a local level.</p>
<ol class="arabic simple">
<li><p>The municipal level: assisst with local mitigation and reduction efforts</p></li>
<li><p>The method of inference should be adaptable to a a machine learning (ML) process</p></li>
</ol>
</li>
</ol>
<p><strong>assumptions</strong></p>
<ol class="arabic simple">
<li><p>reasonable people are collecting the data</p></li>
<li><p>protocols are followed</p></li>
<li><p>similar environmental conditions produce similar results</p></li>
<li><p>there is high varaibility in survey results</p></li>
<li><p>results represent the minimum number, the maximum is unknown</p></li>
<li><p>samples are independent</p></li>
<li><p>results are local</p></li>
</ol>
<p><strong>Results are local:</strong> This means that events that produce large amounts of trash on the shoreline are possible at all moments. This includes thunderstorms, accidental spills, high-winds, local flood events or any event that includes consumption as a revenue source. It is also possible that a beach litter survey can yield extremely low results. <strong>There is no immediate significance attached to the magnitude of a survey result. Extreme values are expected</strong>.</p>
</div>
</div>
<div class="section" id="methods-of-inference">
<h2><span class="section-number">7.2. </span>Methods of inference<a class="headerlink" href="#methods-of-inference" title="Permalink to this headline">#</a></h2>
<p>The method of data collection suggests a method of interpretation and analysis that is appropriate to real systems, can be tested empirically and allows reasonbale people to arrive at reasonable conclusions. Fortunately we don’t need to invent a method, there are several appropriate techniques for arriving at a consensus estimate of a requested metric. (Maxwell, La Place, Bayes, Jaynes, Gelman, Savage, Davidson-Pilon, Downey).</p>
<div class="section" id="binomial-distribution">
<h3><span class="section-number">7.2.1. </span>Binomial distribution<a class="headerlink" href="#binomial-distribution" title="Permalink to this headline">#</a></h3>
<p>In the previous sections we were concerned with defining the relationship between the land use profile and the density of litter identified. This definition we limited to defining wether or not the quantity or magnitude of a type of land use was montotonic with litter density and if so what was the direction ? positive or negative ?. In this section, the question is more detailed and more specific:</p>
<ol class="arabic simple">
<li><p>How likely is a survey result to exceed a value given the land use profile of the survey location ?</p></li>
<li><p><strong>How likely is a survey result to exceed a threshold here and now ?</strong></p>
<ol class="arabic simple">
<li><p>The land use profile is the collection of land use attriutes within a 3’000 m hex with the survey location at the middle.</p></li>
<li><p><strong>Here</strong> can be any location with a land-use profile that would also make an appropriate survey location</p></li>
<li><p><strong>Now</strong> siginifies our expectations at the next survey.</p></li>
</ol>
</li>
</ol>
<p>This metric was introduced in the federal report as the fail-rate: <em>the number of times that at least one of an object was found at a survey</em>, all landuse values were consiered equal. This allowed us to select ojects of interest using frequency as a metric as well as quantity or density. Thus, it is easy to identify objects that are found frequently but not in large quantities. In this form the fail rate is also the most likely estimate (MLE) of the parameter <em>p</em> for the <a class="reference external" href="https://en.wikipedia.org/wiki/Binomial_distribution">binomial distribution</a> that describes the probability of finding at least one of a requested object at a survey. How the fail rate can be used to determine a range of probable values for any object at any location was defined in, <a class="reference external" href="https://hammerdirt-analyst.github.io/finding-one-object/titlepage.html">finding one object</a>, the example was feminine hygiene products.</p>
</div>
<div class="section" id="odds-and-log-odds">
<h3><span class="section-number">7.2.2. </span>Odds and log odds<a class="headerlink" href="#odds-and-log-odds" title="Permalink to this headline">#</a></h3>
<p>The odds of success are defined as the number of times that a test had a positive result v/s the number of times that the results were negative, or <em>k/(n-k)</em>. The probability of success can also be given as an <em>odds ratio:</em> the probability of success divided by the probability of failure or <span class="math notranslate nohighlight">\(\frac{p}{1-p}\)</span>, where <span class="math notranslate nohighlight">\(p\)</span> = the probability of success. Therefore, the log odds are <em>ln(</em><span class="math notranslate nohighlight">\(\frac{p}{1-p}\)</span><em>)</em> or <a class="reference external" href="https://en.wikipedia.org/wiki/Logit">Logit</a>.</p>
<p>The log odds are used in <a class="reference external" href="https://en.wikipedia.org/wiki/Logistic_regression">logistic regression</a>, a commonly used method to model binary variables with multiple independent variables. In the case of beach litter data we are modeling the binary variable: “Did the survey result exceed the threshold?. Commonly used in machine learning models, logistic regression is often part of classification or labeling processes.</p>
</div>
</div>
<div class="section" id="variables">
<h2><span class="section-number">7.3. </span>Variables<a class="headerlink" href="#variables" title="Permalink to this headline">#</a></h2>
<ol class="arabic simple">
<li><p>independent variables: m² of each land use category, m of roads, m of rivers that intersect, m to river intersection point</p></li>
<li><p>outcome variable: binary, wether or not the threshold was exceeded at a survey</p></li>
<li><p>success: the threshold was exceeded = 1 else 0</p></li>
</ol>
<p><strong>We assume that the land-use adjacent to the survey location and magnitudes of local river inputs are predictor varaibles for the amount of trash found on the shore line</strong>.</p>
</div>
<div class="section" id="data">
<h2><span class="section-number">7.4. </span>Data<a class="headerlink" href="#data" title="Permalink to this headline">#</a></h2>
<div class="section" id="survey-data">
<h3><span class="section-number">7.4.1. </span>Survey data<a class="headerlink" href="#survey-data" title="Permalink to this headline">#</a></h3>
<p>The samples from the period 2020-2021 (IQAASL) for the following lakes are considered:</p>
<ul class="simple">
<li><p>Zurichsee</p></li>
<li><p>Bielersee</p></li>
<li><p>Neuenburgersee</p></li>
<li><p>Walensee</p></li>
<li><p>Vierwaldstattersee</p></li>
<li><p>Brienzersee</p></li>
<li><p>Thunersee</p></li>
<li><p>Lac Léman</p></li>
<li><p>Lago Maggiore</p></li>
<li><p>Lago di Lugano</p></li>
<li><p>Zugersee</p></li>
</ul>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_2e769 tr:nth-child(even) {
  background-color: rgba(139, 69, 19, 0.08);
}
#T_2e769 tr:nth-child(odd) {
  background: #FFF;
}
#T_2e769 tr {
  font-size: 12px;
}
#T_2e769 th:nth-child(1) {
  background-color: #FFF;
  text-align: right;
}
</style>
<table id="T_2e769">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_2e769_level0_col0" class="col_heading level0 col0" >0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_2e769_level0_row0" class="row_heading level0 row0" >n locations</th>
      <td id="T_2e769_row0_col0" class="data row0 col0" >93</td>
    </tr>
    <tr>
      <th id="T_2e769_level0_row1" class="row_heading level0 row1" >n samples</th>
      <td id="T_2e769_row1_col0" class="data row1 col0" >331</td>
    </tr>
    <tr>
      <th id="T_2e769_level0_row2" class="row_heading level0 row2" >n lake samples</th>
      <td id="T_2e769_row2_col0" class="data row2 col0" >331</td>
    </tr>
    <tr>
      <th id="T_2e769_level0_row3" class="row_heading level0 row3" >n identified object types</th>
      <td id="T_2e769_row3_col0" class="data row3 col0" >205</td>
    </tr>
    <tr>
      <th id="T_2e769_level0_row4" class="row_heading level0 row4" >n possible object types</th>
      <td id="T_2e769_row4_col0" class="data row4 col0" >230</td>
    </tr>
    <tr>
      <th id="T_2e769_level0_row5" class="row_heading level0 row5" >total number of objects</th>
      <td id="T_2e769_row5_col0" class="data row5 col0" >52269</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Each row of the survey data accounts for the quantity identified of a particular group of objects at a location on a given date. For example, there are 230 entries for each survey, representing the 230 possible groups an item can be placed in. Objects that were not identified are given the default quantity of zero. The unique indentifier for a survey is the combination of location and date (loc_date). For example consider the survey results from mullermatte on March 31, 2021:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_22f2b tr:nth-child(even) {
  background-color: rgba(139, 69, 19, 0.08);
}
#T_22f2b tr:nth-child(odd) {
  background: #FFF;
}
#T_22f2b tr {
  font-size: 12px;
}
#T_22f2b th:nth-child(1) {
  background-color: #FFF;
  text-align: right;
}
</style>
<table id="T_22f2b">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_22f2b_level0_col0" class="col_heading level0 col0" >loc_date</th>
      <th id="T_22f2b_level0_col1" class="col_heading level0 col1" >date</th>
      <th id="T_22f2b_level0_col2" class="col_heading level0 col2" >location</th>
      <th id="T_22f2b_level0_col3" class="col_heading level0 col3" >river_bassin</th>
      <th id="T_22f2b_level0_col4" class="col_heading level0 col4" >feature</th>
      <th id="T_22f2b_level0_col5" class="col_heading level0 col5" >city</th>
      <th id="T_22f2b_level0_col6" class="col_heading level0 col6" >code</th>
      <th id="T_22f2b_level0_col7" class="col_heading level0 col7" >pcs_m</th>
      <th id="T_22f2b_level0_col8" class="col_heading level0 col8" >quantity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_22f2b_level0_row0" class="row_heading level0 row0" >3013</th>
      <td id="T_22f2b_row0_col0" class="data row0 col0" >('mullermatte', '2021-03-31')</td>
      <td id="T_22f2b_row0_col1" class="data row0 col1" >2021-03-31</td>
      <td id="T_22f2b_row0_col2" class="data row0 col2" >mullermatte</td>
      <td id="T_22f2b_row0_col3" class="data row0 col3" >aare</td>
      <td id="T_22f2b_row0_col4" class="data row0 col4" >bielersee</td>
      <td id="T_22f2b_row0_col5" class="data row0 col5" >Biel/Bienne</td>
      <td id="T_22f2b_row0_col6" class="data row0 col6" >G167</td>
      <td id="T_22f2b_row0_col7" class="data row0 col7" >0.070000</td>
      <td id="T_22f2b_row0_col8" class="data row0 col8" >3</td>
    </tr>
    <tr>
      <th id="T_22f2b_level0_row1" class="row_heading level0 row1" >3014</th>
      <td id="T_22f2b_row1_col0" class="data row1 col0" >('mullermatte', '2021-03-31')</td>
      <td id="T_22f2b_row1_col1" class="data row1 col1" >2021-03-31</td>
      <td id="T_22f2b_row1_col2" class="data row1 col2" >mullermatte</td>
      <td id="T_22f2b_row1_col3" class="data row1 col3" >aare</td>
      <td id="T_22f2b_row1_col4" class="data row1 col4" >bielersee</td>
      <td id="T_22f2b_row1_col5" class="data row1 col5" >Biel/Bienne</td>
      <td id="T_22f2b_row1_col6" class="data row1 col6" >G31</td>
      <td id="T_22f2b_row1_col7" class="data row1 col7" >0.020000</td>
      <td id="T_22f2b_row1_col8" class="data row1 col8" >1</td>
    </tr>
    <tr>
      <th id="T_22f2b_level0_row2" class="row_heading level0 row2" >3015</th>
      <td id="T_22f2b_row2_col0" class="data row2 col0" >('mullermatte', '2021-03-31')</td>
      <td id="T_22f2b_row2_col1" class="data row2 col1" >2021-03-31</td>
      <td id="T_22f2b_row2_col2" class="data row2 col2" >mullermatte</td>
      <td id="T_22f2b_row2_col3" class="data row2 col3" >aare</td>
      <td id="T_22f2b_row2_col4" class="data row2 col4" >bielersee</td>
      <td id="T_22f2b_row2_col5" class="data row2 col5" >Biel/Bienne</td>
      <td id="T_22f2b_row2_col6" class="data row2 col6" >G100</td>
      <td id="T_22f2b_row2_col7" class="data row2 col7" >0.020000</td>
      <td id="T_22f2b_row2_col8" class="data row2 col8" >1</td>
    </tr>
    <tr>
      <th id="T_22f2b_level0_row3" class="row_heading level0 row3" >3016</th>
      <td id="T_22f2b_row3_col0" class="data row3 col0" >('mullermatte', '2021-03-31')</td>
      <td id="T_22f2b_row3_col1" class="data row3 col1" >2021-03-31</td>
      <td id="T_22f2b_row3_col2" class="data row3 col2" >mullermatte</td>
      <td id="T_22f2b_row3_col3" class="data row3 col3" >aare</td>
      <td id="T_22f2b_row3_col4" class="data row3 col4" >bielersee</td>
      <td id="T_22f2b_row3_col5" class="data row3 col5" >Biel/Bienne</td>
      <td id="T_22f2b_row3_col6" class="data row3 col6" >G177</td>
      <td id="T_22f2b_row3_col7" class="data row3 col7" >0.120000</td>
      <td id="T_22f2b_row3_col8" class="data row3 col8" >5</td>
    </tr>
    <tr>
      <th id="T_22f2b_level0_row4" class="row_heading level0 row4" >3017</th>
      <td id="T_22f2b_row4_col0" class="data row4 col0" >('mullermatte', '2021-03-31')</td>
      <td id="T_22f2b_row4_col1" class="data row4 col1" >2021-03-31</td>
      <td id="T_22f2b_row4_col2" class="data row4 col2" >mullermatte</td>
      <td id="T_22f2b_row4_col3" class="data row4 col3" >aare</td>
      <td id="T_22f2b_row4_col4" class="data row4 col4" >bielersee</td>
      <td id="T_22f2b_row4_col5" class="data row4 col5" >Biel/Bienne</td>
      <td id="T_22f2b_row4_col6" class="data row4 col6" >G35</td>
      <td id="T_22f2b_row4_col7" class="data row4 col7" >0.020000</td>
      <td id="T_22f2b_row4_col8" class="data row4 col8" >1</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="the-land-use-data">
<h3><span class="section-number">7.4.2. </span>The land use data<a class="headerlink" href="#the-land-use-data" title="Permalink to this headline">#</a></h3>
<p>How the land use is extracted from the map layers and schematic was demonstrated in the sections New Map data and River and Lake intersections.</p>
<div class="section" id="aggregating-scaling-and-binning">
<h4><span class="section-number">7.4.2.1. </span>Aggregating, scaling and binning<a class="headerlink" href="#aggregating-scaling-and-binning" title="Permalink to this headline">#</a></h4>
<p><strong>Aggregating the land use values:</strong> For <strong>land-cover objects</strong> the surface area of the polygon that defines each land use attribute that is bounded by the location hexagon is summed. For example their may be two different polygons that represent forest utilization within a hex, the sum of the two polygons is returned. Land cover objects include:</p>
<ol class="arabic simple">
<li><p>Buildings</p></li>
<li><p>Woods</p></li>
<li><p>Orchards</p></li>
<li><p>Wetlands</p></li>
<li><p>City center</p></li>
<li><p>Cliffs</p></li>
<li><p>Vineyards</p></li>
<li><p>Undefined</p></li>
</ol>
<p>Land-use objects concern much smaller portions of the hex and represent specific land-use cases such as schools, hospitals or camping grounds. They have been aggregated in two categories for each hex:</p>
<ol class="arabic simple">
<li><p>Recreation</p></li>
<li><p>Infrastructure</p></li>
<li><p>Streets</p></li>
<li><p>Distance to river intersections</p></li>
<li><p>Length of river network in hex</p></li>
</ol>
<p><strong>Scaling the land use values:</strong> The land-use and land-cover objects are scaled according to the proportion of the amount of land in the hex that is not covered by water. The land-use objects <em>Streets</em>, <em>Distance to river intersections</em> and <em>Length of river network in hex</em> are scaled separately.</p>
<p><strong>Binning the land use values:</strong> The scaled values were binned by quantile (.05) from zero to one. In other words there are twenty bins that group the land use and land cover values. Consider the land-use for Mullermatte below. The surface area 2’362’780 m² or 2.4 km². Scaled it is .51 or around the 50th percentile of all locations. It is in bin 11, this can be used to find other locations that have similar land-use values for city (next table).</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># these are the land use values for each hex</span>
<span class="c1"># nutuzungsareal and freizeit areal are totaled</span>
<span class="c1"># the surface area of these two use cases gets added</span>
<span class="c1"># to the total of the land cover surface area</span>
<span class="n">dfln</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/hex-3000m-cleaned/lake-locations-nutuzungsareal.csv&quot;</span><span class="p">)</span>
<span class="n">dflf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/hex-3000m-cleaned/lake-locations-freizeitareal.csv&quot;</span><span class="p">)</span>

<span class="c1"># rename the columns and total the surface are for each component</span>
<span class="n">dflf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;OBJEKTART&quot;</span><span class="p">:</span><span class="s2">&quot;use&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dflf</span> <span class="o">=</span> <span class="n">dflf</span><span class="p">[</span><span class="o">~</span><span class="n">dflf</span><span class="o">.</span><span class="n">use</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;Reben&#39;</span><span class="p">,</span> <span class="s1">&#39;Obstanlage&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">dflf_t</span> <span class="o">=</span> <span class="n">dflf</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;river_bass&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;feature&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">dflf_t</span><span class="p">[</span><span class="s2">&quot;use&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;recreation&quot;</span>

<span class="n">dfln</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;OBJEKTART&quot;</span><span class="p">:</span><span class="s2">&quot;use&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dfln</span> <span class="o">=</span> <span class="n">dfln</span><span class="p">[</span><span class="o">~</span><span class="n">dfln</span><span class="o">.</span><span class="n">use</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;Reben&#39;</span><span class="p">,</span> <span class="s1">&#39;Obstanlage&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">dfln_t</span> <span class="o">=</span> <span class="n">dfln</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;river_bass&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;feature&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">dfln_t</span><span class="p">[</span><span class="s2">&quot;use&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;infrastructure&quot;</span>

<span class="c1"># combine the data frames</span>
<span class="n">rec_inf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dfln_t</span><span class="p">,</span> <span class="n">dflf_t</span><span class="p">])</span>
<span class="n">rec_inf</span> <span class="o">=</span> <span class="n">rec_inf</span><span class="p">[</span><span class="n">rec_inf</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">locations</span><span class="p">)]</span>

<span class="c1"># this is the land cover, the total surface area of the hex is accounted for here</span>
<span class="c1"># this includes the surface area of the lake within the hex</span>
<span class="c1"># there are portions of the map layer that have no land-use attribute</span>
<span class="c1"># to account for this, the total surface area of all labeled sections is </span>
<span class="c1"># substracted from the area of a hex 5845672 m². This attribute is labled </span>
<span class="c1"># undefined</span>
<span class="n">dflc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/hex-3000m-cleaned/lake-locations-landcover.csv&quot;</span><span class="p">)</span>

<span class="c1"># sum the unique land cover values for each location</span>
<span class="n">area_of_a_hex</span> <span class="o">=</span> <span class="mi">5845672</span>
<span class="n">xgr</span> <span class="o">=</span> <span class="n">dflc</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;river_bass&quot;</span><span class="p">,</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="s2">&quot;OBJVAL&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># the sum of all the land cover values for a location</span>
<span class="n">xgrt</span> <span class="o">=</span> <span class="n">xgr</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;river_bass&quot;</span><span class="p">,</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;feature&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># the amount of surface area that is not accounted for </span>
<span class="n">xgrt</span><span class="p">[</span><span class="s2">&quot;undefined&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">area_of_a_hex</span> <span class="o">-</span> <span class="n">xgrt</span><span class="o">.</span><span class="n">surface</span>

<span class="c1"># format data frame to join to the other land cover totals</span>
<span class="n">xgrt</span><span class="p">[</span><span class="s2">&quot;OBJVAL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;undefined&quot;</span>
<span class="n">xgrt</span><span class="p">[</span><span class="s2">&quot;surface&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xgrt</span><span class="p">[</span><span class="s2">&quot;undefined&quot;</span><span class="p">]</span>
<span class="n">xgrt</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;undefined&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># add to other totals</span>
<span class="n">dflcx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">xgr</span><span class="p">,</span> <span class="n">xgrt</span><span class="p">])</span>

<span class="c1"># remove the value of See from the surface area of a hex.</span>
<span class="c1"># We are considering the magnitude of land use type in relation</span>
<span class="c1"># to the amount of land that is available to be used, not including </span>
<span class="c1"># amount of land that is covered by the lake itself</span>
<span class="n">xsee</span> <span class="o">=</span> <span class="n">xgr</span><span class="p">[</span><span class="n">xgr</span><span class="o">.</span><span class="n">OBJVAL</span> <span class="o">==</span> <span class="s2">&quot;See&quot;</span><span class="p">][[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;surface&quot;</span><span class="p">]]</span>
<span class="n">xsee</span><span class="p">[</span><span class="s2">&quot;hex minus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">area_of_a_hex</span> <span class="o">-</span> <span class="n">xsee</span><span class="o">.</span><span class="n">surface</span>
<span class="n">hex_minus</span> <span class="o">=</span> <span class="n">xsee</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;hex minus&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># map the adjusted surface area to to the land use</span>
<span class="c1"># totals and scale the surface column to the adjusted surface area</span>
<span class="n">dflcx</span><span class="p">[</span><span class="s2">&quot;hex minus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dflcx</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">hex_minus</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;hex minus&quot;</span><span class="p">])</span>
<span class="c1"># change column name</span>
<span class="n">dflcx</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;OBJVAL&quot;</span><span class="p">:</span><span class="s2">&quot;use&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># add the land use attributes to the land-cover data</span>
<span class="n">rec_inf</span><span class="p">[</span><span class="s2">&quot;hex minus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec_inf</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">hex_minus</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;hex minus&quot;</span><span class="p">])</span>

<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;river_bass&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="s2">&quot;surface&quot;</span><span class="p">,</span> <span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="s2">&quot;hex minus&quot;</span><span class="p">]</span>

<span class="n">agg_land_use</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dflcx</span><span class="p">[</span><span class="n">columns</span><span class="p">],</span> <span class="n">rec_inf</span><span class="p">[</span><span class="n">columns</span><span class="p">]])</span>

<span class="n">agg_land_use</span><span class="p">[</span><span class="s2">&quot;scaled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">agg_land_use</span><span class="o">.</span><span class="n">surface</span><span class="o">/</span><span class="n">agg_land_use</span><span class="p">[</span><span class="s2">&quot;hex minus&quot;</span><span class="p">]</span>

<span class="c1"># remove See from the data frame</span>
<span class="n">agg_land_use</span> <span class="o">=</span> <span class="n">agg_land_use</span><span class="p">[</span><span class="n">agg_land_use</span><span class="o">.</span><span class="n">use</span> <span class="o">!=</span> <span class="s2">&quot;See&quot;</span><span class="p">]</span>

<span class="n">bind</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">IntervalIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">([(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.00000001</span><span class="p">,</span> <span class="mf">.049999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.05000</span><span class="p">,</span> <span class="mf">.099999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.10000</span><span class="p">,</span> <span class="mf">.149999</span><span class="p">),(</span><span class="mf">.15000</span><span class="p">,</span> <span class="mf">.199999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.2</span><span class="p">,</span> <span class="mf">.2499</span><span class="p">),</span> <span class="p">(</span><span class="mf">.25</span><span class="p">,</span> <span class="mf">.2999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.3000</span><span class="p">,</span> <span class="mf">.3499</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">.35</span><span class="p">,</span> <span class="mf">.3999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.4000</span><span class="p">,</span> <span class="mf">.449999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.45</span><span class="p">,</span> <span class="mf">.499999</span><span class="p">),(</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">.549999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.55</span><span class="p">,</span> <span class="mf">.5999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.6000</span><span class="p">,</span> <span class="mf">.6499</span><span class="p">),</span> <span class="p">(</span><span class="mf">.65</span><span class="p">,</span> <span class="mf">.6999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.7</span><span class="p">,</span> <span class="mf">.7499</span><span class="p">),</span> <span class="p">(</span><span class="mf">.75</span><span class="p">,</span> <span class="mf">.7999</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">.8</span><span class="p">,</span> <span class="mf">.8499</span><span class="p">),</span> <span class="p">(</span><span class="mf">.85</span><span class="p">,</span> <span class="mf">.8999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.9</span><span class="p">,</span> <span class="mf">.9499</span><span class="p">),</span> <span class="p">(</span><span class="mf">.95</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>

<span class="c1"># bin the scaled column</span>
<span class="n">sbins</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">agg_land_use</span><span class="o">.</span><span class="n">scaled</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bind</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">21</span><span class="p">),</span> <span class="n">include_lowest</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">retbins</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">sbins</span><span class="o">=</span><span class="n">sbins</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">rename_categories</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">21</span><span class="p">))</span>

<span class="n">agg_land_use</span><span class="p">[</span><span class="s2">&quot;binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sbins</span>

<span class="c1"># land use features that get laid on top of the land-cover features</span>
<span class="c1"># the distance ot the river intersections and the length of the river</span>
<span class="c1"># features in the hexgon</span>
<span class="n">dist_ct</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/hex-3000m-cleaned/river-intersect-length.csv&quot;</span><span class="p">)</span>
<span class="n">dist_dt</span> <span class="o">=</span> <span class="n">dist_ct</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;distance&quot;</span><span class="p">:</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;length&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">})</span>
<span class="n">dist_dt</span> <span class="o">=</span> <span class="n">dist_dt</span><span class="p">[</span><span class="n">dist_dt</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">())]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">dist_dt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">dist_dt</span><span class="p">,</span> <span class="n">id_vars</span> <span class="o">=</span> <span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">,</span> <span class="s2">&quot;distance&quot;</span><span class="p">])</span>

<span class="c1"># min max scale</span>
<span class="n">dist_dt</span><span class="p">[</span><span class="s2">&quot;scaled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dist_dt</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">dist_dt</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">dist_dt</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">dist_dt</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="c1"># bin in groups of 0.05 plus one bin for zero</span>
<span class="n">sbinsr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">dist_dt</span><span class="o">.</span><span class="n">scaled</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bind</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">21</span><span class="p">),</span> <span class="n">include_lowest</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">retbins</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">sbinsr</span><span class="o">=</span><span class="n">sbinsr</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">rename_categories</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">21</span><span class="p">))</span>
<span class="n">dist_dt</span><span class="p">[</span><span class="s2">&quot;binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sbinsr</span>

<span class="c1"># add the survey area and feature name to the data</span>
<span class="n">rbas_map</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;river_bassin&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;river_bassin&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span>
<span class="n">rbas_map</span> <span class="o">=</span> <span class="n">rbas_map</span><span class="p">[</span><span class="s2">&quot;river_bassin&quot;</span><span class="p">]</span>
<span class="n">dist_dt</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist_dt</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">wn_map</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
<span class="n">dist_dt</span><span class="p">[</span><span class="s2">&quot;river_bass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dist_dt</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">rbas_map</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>

<span class="c1"># the length of the road network in the hex</span>
<span class="n">strasse</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/hex-3000m-cleaned/lake-locations-strasse.csv&quot;</span><span class="p">)</span>
<span class="n">strasse</span> <span class="o">=</span> <span class="n">strasse</span><span class="p">[</span><span class="n">strasse</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">())]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">stras</span> <span class="o">=</span> <span class="n">strasse</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;location&quot;</span><span class="p">,</span><span class="s2">&quot;river_bass&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;feature&quot;</span><span class="p">,</span>  <span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># min max scale</span>
<span class="n">stras</span><span class="p">[</span><span class="s2">&quot;scaled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">stras</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">stras</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">stras</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">stras</span><span class="p">[</span><span class="s2">&quot;length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="c1"># bin</span>
<span class="n">sbinsras</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">stras</span><span class="o">.</span><span class="n">scaled</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bind</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">21</span><span class="p">),</span> <span class="n">include_lowest</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">retbins</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">sbinsras</span><span class="o">=</span><span class="n">sbinsras</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">rename_categories</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">21</span><span class="p">))</span>
<span class="n">stras</span><span class="p">[</span><span class="s2">&quot;binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sbinsras</span>
<span class="n">stras</span><span class="p">[</span><span class="s2">&quot;use&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Strasse&quot;</span>

<span class="n">mix_agg</span> <span class="o">=</span> <span class="n">agg_land_use</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">mix_agg</span><span class="p">[</span><span class="s2">&quot;binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mix_agg</span><span class="o">.</span><span class="n">binned</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
<span class="n">mix_agg</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;use&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mix_agg_scale_key</span> <span class="o">=</span> <span class="n">mix_agg</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;river_bass&quot;</span><span class="p">,</span> <span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="s2">&quot;surface&quot;</span><span class="p">,</span> <span class="s2">&quot;scaled&quot;</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span>
<span class="n">mix_agg_scale_key</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;surface&quot;</span><span class="p">:</span><span class="s2">&quot;magnitude&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mix_agg_scale_key</span>

<span class="n">mix_dt</span> <span class="o">=</span> <span class="n">dist_dt</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">mix_dt</span><span class="p">[</span><span class="s2">&quot;binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mix_dt</span><span class="o">.</span><span class="n">binned</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
<span class="n">mix_dt</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;variable&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mix_dt_scale_key</span> <span class="o">=</span> <span class="n">mix_dt</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;river_bass&quot;</span><span class="p">,</span> <span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;scaled&quot;</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span>
<span class="n">mix_dt_scale_key</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;variable&quot;</span><span class="p">:</span><span class="s2">&quot;use&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mix_dt_scale_key</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span><span class="s2">&quot;magnitude&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">mix_dt_scale_key</span>

<span class="n">strass_dt_scale_key</span> <span class="o">=</span> <span class="n">stras</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;river_bass&quot;</span><span class="p">,</span> <span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="s2">&quot;length&quot;</span><span class="p">,</span> <span class="s2">&quot;scaled&quot;</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">strass_dt_scale_key</span><span class="p">[</span><span class="s2">&quot;binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">strass_dt_scale_key</span><span class="o">.</span><span class="n">binned</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">strass_dt_scale_key</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;length&quot;</span><span class="p">:</span><span class="s2">&quot;magnitude&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">strass_dt_scale_key</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">land_use_keys</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">strass_dt_scale_key</span><span class="p">,</span> <span class="n">mix_dt_scale_key</span><span class="p">,</span> <span class="n">mix_agg_scale_key</span><span class="p">])</span>
<span class="n">land_use_keys</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">land_use_keys</span> <span class="o">=</span> <span class="n">land_use_keys</span><span class="p">[</span><span class="n">land_use_keys</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">())]</span>
<span class="n">lusek_copy</span> <span class="o">=</span> <span class="n">land_use_keys</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">sample_data</span> <span class="o">=</span> <span class="n">land_use_keys</span><span class="p">[</span><span class="n">land_use_keys</span><span class="o">.</span><span class="n">location</span> <span class="o">==</span> <span class="n">beach</span><span class="p">][[</span><span class="s2">&quot;use&quot;</span><span class="p">,</span><span class="s2">&quot;magnitude&quot;</span><span class="p">,</span> <span class="s2">&quot;scaled&quot;</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="n">drop</span> <span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sample_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">sample_data</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">set_table_styles</span><span class="p">(</span><span class="n">table_css_styles</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_9be48 tr:nth-child(even) {
  background-color: rgba(139, 69, 19, 0.08);
}
#T_9be48 tr:nth-child(odd) {
  background: #FFF;
}
#T_9be48 tr {
  font-size: 12px;
}
#T_9be48 th:nth-child(1) {
  background-color: #FFF;
  text-align: right;
}
</style>
<table id="T_9be48">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_9be48_level0_col0" class="col_heading level0 col0" >magnitude</th>
      <th id="T_9be48_level0_col1" class="col_heading level0 col1" >scaled</th>
      <th id="T_9be48_level0_col2" class="col_heading level0 col2" >binned</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_9be48_level0_row0" class="row_heading level0 row0" >Strasse</th>
      <td id="T_9be48_row0_col0" class="data row0 col0" >89216.000000</td>
      <td id="T_9be48_row0_col1" class="data row0 col1" >0.639085</td>
      <td id="T_9be48_row0_col2" class="data row0 col2" >13</td>
    </tr>
    <tr>
      <th id="T_9be48_level0_row1" class="row_heading level0 row1" >length</th>
      <td id="T_9be48_row1_col0" class="data row1 col0" >2812.716882</td>
      <td id="T_9be48_row1_col1" class="data row1 col1" >0.386030</td>
      <td id="T_9be48_row1_col2" class="data row1 col2" >8</td>
    </tr>
    <tr>
      <th id="T_9be48_level0_row2" class="row_heading level0 row2" >distance</th>
      <td id="T_9be48_row2_col0" class="data row2 col0" >744.163060</td>
      <td id="T_9be48_row2_col1" class="data row2 col1" >0.102132</td>
      <td id="T_9be48_row2_col2" class="data row2 col2" >3</td>
    </tr>
    <tr>
      <th id="T_9be48_level0_row3" class="row_heading level0 row3" >Siedl</th>
      <td id="T_9be48_row3_col0" class="data row3 col0" >2362780.000000</td>
      <td id="T_9be48_row3_col1" class="data row3 col1" >0.513395</td>
      <td id="T_9be48_row3_col2" class="data row3 col2" >11</td>
    </tr>
    <tr>
      <th id="T_9be48_level0_row4" class="row_heading level0 row4" >Stadtzentr</th>
      <td id="T_9be48_row4_col0" class="data row4 col0" >34237.000000</td>
      <td id="T_9be48_row4_col1" class="data row4 col1" >0.007439</td>
      <td id="T_9be48_row4_col2" class="data row4 col2" >1</td>
    </tr>
    <tr>
      <th id="T_9be48_level0_row5" class="row_heading level0 row5" >Wald</th>
      <td id="T_9be48_row5_col0" class="data row5 col0" >1928607.000000</td>
      <td id="T_9be48_row5_col1" class="data row5 col1" >0.419056</td>
      <td id="T_9be48_row5_col2" class="data row5 col2" >9</td>
    </tr>
    <tr>
      <th id="T_9be48_level0_row6" class="row_heading level0 row6" >Fels</th>
      <td id="T_9be48_row6_col0" class="data row6 col0" >0.000000</td>
      <td id="T_9be48_row6_col1" class="data row6 col1" >0.000000</td>
      <td id="T_9be48_row6_col2" class="data row6 col2" >0</td>
    </tr>
    <tr>
      <th id="T_9be48_level0_row7" class="row_heading level0 row7" >Obstanlage</th>
      <td id="T_9be48_row7_col0" class="data row7 col0" >0.000000</td>
      <td id="T_9be48_row7_col1" class="data row7 col1" >0.000000</td>
      <td id="T_9be48_row7_col2" class="data row7 col2" >0</td>
    </tr>
    <tr>
      <th id="T_9be48_level0_row8" class="row_heading level0 row8" >Reben</th>
      <td id="T_9be48_row8_col0" class="data row8 col0" >0.000000</td>
      <td id="T_9be48_row8_col1" class="data row8 col1" >0.000000</td>
      <td id="T_9be48_row8_col2" class="data row8 col2" >0</td>
    </tr>
    <tr>
      <th id="T_9be48_level0_row9" class="row_heading level0 row9" >Sumpf</th>
      <td id="T_9be48_row9_col0" class="data row9 col0" >0.000000</td>
      <td id="T_9be48_row9_col1" class="data row9 col1" >0.000000</td>
      <td id="T_9be48_row9_col2" class="data row9 col2" >0</td>
    </tr>
    <tr>
      <th id="T_9be48_level0_row10" class="row_heading level0 row10" >undefined</th>
      <td id="T_9be48_row10_col0" class="data row10 col0" >276641.000000</td>
      <td id="T_9be48_row10_col1" class="data row10 col1" >0.060110</td>
      <td id="T_9be48_row10_col2" class="data row10 col2" >2</td>
    </tr>
    <tr>
      <th id="T_9be48_level0_row11" class="row_heading level0 row11" >infrastructure</th>
      <td id="T_9be48_row11_col0" class="data row11 col0" >186185.000000</td>
      <td id="T_9be48_row11_col1" class="data row11 col1" >0.040455</td>
      <td id="T_9be48_row11_col2" class="data row11 col2" >1</td>
    </tr>
    <tr>
      <th id="T_9be48_level0_row12" class="row_heading level0 row12" >recreation</th>
      <td id="T_9be48_row12_col0" class="data row12 col0" >138729.000000</td>
      <td id="T_9be48_row12_col1" class="data row12 col1" >0.030144</td>
      <td id="T_9be48_row12_col2" class="data row12 col2" >1</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p><em>Survey locations that have similar amounts of <strong>Urban</strong> land use within location hex</em></p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_10b97 tr:nth-child(even) {
  background-color: rgba(139, 69, 19, 0.08);
}
#T_10b97 tr:nth-child(odd) {
  background: #FFF;
}
#T_10b97 tr {
  font-size: 12px;
}
#T_10b97 th:nth-child(1) {
  background-color: #FFF;
  text-align: right;
}
</style>
<table id="T_10b97">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_10b97_level0_col0" class="col_heading level0 col0" >location</th>
      <th id="T_10b97_level0_col1" class="col_heading level0 col1" >river_bass</th>
      <th id="T_10b97_level0_col2" class="col_heading level0 col2" >feature</th>
      <th id="T_10b97_level0_col3" class="col_heading level0 col3" >use</th>
      <th id="T_10b97_level0_col4" class="col_heading level0 col4" >magnitude</th>
      <th id="T_10b97_level0_col5" class="col_heading level0 col5" >scaled</th>
      <th id="T_10b97_level0_col6" class="col_heading level0 col6" >binned</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_10b97_level0_row0" class="row_heading level0 row0" >795</th>
      <td id="T_10b97_row0_col0" class="data row0 col0" >mullermatte</td>
      <td id="T_10b97_row0_col1" class="data row0 col1" >aare</td>
      <td id="T_10b97_row0_col2" class="data row0 col2" >bielersee</td>
      <td id="T_10b97_row0_col3" class="data row0 col3" >Siedl</td>
      <td id="T_10b97_row0_col4" class="data row0 col4" >2362780.000000</td>
      <td id="T_10b97_row0_col5" class="data row0 col5" >0.513395</td>
      <td id="T_10b97_row0_col6" class="data row0 col6" >11</td>
    </tr>
    <tr>
      <th id="T_10b97_level0_row1" class="row_heading level0 row1" >816</th>
      <td id="T_10b97_row1_col0" class="data row1 col0" >nouvelle-plage</td>
      <td id="T_10b97_row1_col1" class="data row1 col1" >aare</td>
      <td id="T_10b97_row1_col2" class="data row1 col2" >neuenburgersee</td>
      <td id="T_10b97_row1_col3" class="data row1 col3" >Siedl</td>
      <td id="T_10b97_row1_col4" class="data row1 col4" >1517551.000000</td>
      <td id="T_10b97_row1_col5" class="data row1 col5" >0.530442</td>
      <td id="T_10b97_row1_col6" class="data row1 col6" >11</td>
    </tr>
    <tr>
      <th id="T_10b97_level0_row2" class="row_heading level0 row2" >1119</th>
      <td id="T_10b97_row2_col0" class="data row2 col0" >tolochenaz</td>
      <td id="T_10b97_row2_col1" class="data row2 col1" >rhone</td>
      <td id="T_10b97_row2_col2" class="data row2 col2" >lac-leman</td>
      <td id="T_10b97_row2_col3" class="data row2 col3" >Siedl</td>
      <td id="T_10b97_row2_col4" class="data row2 col4" >1733621.000000</td>
      <td id="T_10b97_row2_col5" class="data row2 col5" >0.538944</td>
      <td id="T_10b97_row2_col6" class="data row2 col6" >11</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p><em>Survey locations that have similar amounts of <strong>Forest</strong> land use within location hex</em></p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_eab14 tr:nth-child(even) {
  background-color: rgba(139, 69, 19, 0.08);
}
#T_eab14 tr:nth-child(odd) {
  background: #FFF;
}
#T_eab14 tr {
  font-size: 12px;
}
#T_eab14 th:nth-child(1) {
  background-color: #FFF;
  text-align: right;
}
</style>
<table id="T_eab14">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_eab14_level0_col0" class="col_heading level0 col0" >location</th>
      <th id="T_eab14_level0_col1" class="col_heading level0 col1" >river_bass</th>
      <th id="T_eab14_level0_col2" class="col_heading level0 col2" >feature</th>
      <th id="T_eab14_level0_col3" class="col_heading level0 col3" >use</th>
      <th id="T_eab14_level0_col4" class="col_heading level0 col4" >magnitude</th>
      <th id="T_eab14_level0_col5" class="col_heading level0 col5" >scaled</th>
      <th id="T_eab14_level0_col6" class="col_heading level0 col6" >binned</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_eab14_level0_row0" class="row_heading level0 row0" >517</th>
      <td id="T_eab14_row0_col0" class="data row0 col0" >gasi-strand</td>
      <td id="T_eab14_row0_col1" class="data row0 col1" >linth</td>
      <td id="T_eab14_row0_col2" class="data row0 col2" >walensee</td>
      <td id="T_eab14_row0_col3" class="data row0 col3" >Wald</td>
      <td id="T_eab14_row0_col4" class="data row0 col4" >1628315.000000</td>
      <td id="T_eab14_row0_col5" class="data row0 col5" >0.428435</td>
      <td id="T_eab14_row0_col6" class="data row0 col6" >9</td>
    </tr>
    <tr>
      <th id="T_eab14_level0_row1" class="row_heading level0 row1" >614</th>
      <td id="T_eab14_row1_col0" class="data row1 col0" >lacleman_gland_lecoanets</td>
      <td id="T_eab14_row1_col1" class="data row1 col1" >rhone</td>
      <td id="T_eab14_row1_col2" class="data row1 col2" >lac-leman</td>
      <td id="T_eab14_row1_col3" class="data row1 col3" >Wald</td>
      <td id="T_eab14_row1_col4" class="data row1 col4" >1259466.000000</td>
      <td id="T_eab14_row1_col5" class="data row1 col5" >0.407440</td>
      <td id="T_eab14_row1_col6" class="data row1 col6" >9</td>
    </tr>
    <tr>
      <th id="T_eab14_level0_row2" class="row_heading level0 row2" >763</th>
      <td id="T_eab14_row2_col0" class="data row2 col0" >magadino-lido</td>
      <td id="T_eab14_row2_col1" class="data row2 col1" >ticino</td>
      <td id="T_eab14_row2_col2" class="data row2 col2" >lago-maggiore</td>
      <td id="T_eab14_row2_col3" class="data row2 col3" >Wald</td>
      <td id="T_eab14_row2_col4" class="data row2 col4" >1491775.000000</td>
      <td id="T_eab14_row2_col5" class="data row2 col5" >0.414460</td>
      <td id="T_eab14_row2_col6" class="data row2 col6" >9</td>
    </tr>
    <tr>
      <th id="T_eab14_level0_row3" class="row_heading level0 row3" >783</th>
      <td id="T_eab14_row3_col0" class="data row3 col0" >mols-rocks</td>
      <td id="T_eab14_row3_col1" class="data row3 col1" >linth</td>
      <td id="T_eab14_row3_col2" class="data row3 col2" >walensee</td>
      <td id="T_eab14_row3_col3" class="data row3 col3" >Wald</td>
      <td id="T_eab14_row3_col4" class="data row3 col4" >1460847.000000</td>
      <td id="T_eab14_row3_col5" class="data row3 col5" >0.415611</td>
      <td id="T_eab14_row3_col6" class="data row3 col6" >9</td>
    </tr>
    <tr>
      <th id="T_eab14_level0_row4" class="row_heading level0 row4" >789</th>
      <td id="T_eab14_row4_col0" class="data row4 col0" >muhlehorn-dorf</td>
      <td id="T_eab14_row4_col1" class="data row4 col1" >linth</td>
      <td id="T_eab14_row4_col2" class="data row4 col2" >walensee</td>
      <td id="T_eab14_row4_col3" class="data row4 col3" >Wald</td>
      <td id="T_eab14_row4_col4" class="data row4 col4" >1302522.000000</td>
      <td id="T_eab14_row4_col5" class="data row4 col5" >0.412370</td>
      <td id="T_eab14_row4_col6" class="data row4 col6" >9</td>
    </tr>
    <tr>
      <th id="T_eab14_level0_row5" class="row_heading level0 row5" >797</th>
      <td id="T_eab14_row5_col0" class="data row5 col0" >mullermatte</td>
      <td id="T_eab14_row5_col1" class="data row5 col1" >aare</td>
      <td id="T_eab14_row5_col2" class="data row5 col2" >bielersee</td>
      <td id="T_eab14_row5_col3" class="data row5 col3" >Wald</td>
      <td id="T_eab14_row5_col4" class="data row5 col4" >1928607.000000</td>
      <td id="T_eab14_row5_col5" class="data row5 col5" >0.419056</td>
      <td id="T_eab14_row5_col6" class="data row5 col6" >9</td>
    </tr>
    <tr>
      <th id="T_eab14_level0_row6" class="row_heading level0 row6" >803</th>
      <td id="T_eab14_row6_col0" class="data row6 col0" >murg-bad</td>
      <td id="T_eab14_row6_col1" class="data row6 col1" >linth</td>
      <td id="T_eab14_row6_col2" class="data row6 col2" >walensee</td>
      <td id="T_eab14_row6_col3" class="data row6 col3" >Wald</td>
      <td id="T_eab14_row6_col4" class="data row6 col4" >1029136.000000</td>
      <td id="T_eab14_row6_col5" class="data row6 col5" >0.408084</td>
      <td id="T_eab14_row6_col6" class="data row6 col6" >9</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Note that the only common element of the two preceeding tables is the location in question.</p>
<div class="cell tag_remove-input docutils container">
</div>
</div>
</div>
</div>
<div class="section" id="testing-the-threshold-one-object-cigarette-ends">
<h2><span class="section-number">7.5. </span>Testing the threshold one object: cigarette ends<a class="headerlink" href="#testing-the-threshold-one-object-cigarette-ends" title="Permalink to this headline">#</a></h2>
<p><em>survey area:</em> Aare
<em>lake:</em> Bielersee
<em>location:</em> mullermatte</p>
<p>To test a threshhold the survey results for the object of interest at each location are compared to the threshhold value. The number of times that the threshold value was exceeded (success) is counted for each location and sample. The number of samples for each location is also recorded. The result is an indexed data frame that contains the number of successes and samples for each location.</p>
<p>For example consider the results for locations with similar urban land-use characteristics (same bin number) as mullermatte:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_aa56a tr:nth-child(even) {
  background-color: rgba(139, 69, 19, 0.08);
}
#T_aa56a tr:nth-child(odd) {
  background: #FFF;
}
#T_aa56a tr {
  font-size: 12px;
}
#T_aa56a th:nth-child(1) {
  background-color: #FFF;
  text-align: right;
}
</style>
<table id="T_aa56a">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_aa56a_level0_col0" class="col_heading level0 col0" >k</th>
      <th id="T_aa56a_level0_col1" class="col_heading level0 col1" >n</th>
      <th id="T_aa56a_level0_col2" class="col_heading level0 col2" >n-k</th>
      <th id="T_aa56a_level0_col3" class="col_heading level0 col3" >k/n</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_aa56a_level0_row0" class="row_heading level0 row0" >mullermatte</th>
      <td id="T_aa56a_row0_col0" class="data row0 col0" >10</td>
      <td id="T_aa56a_row0_col1" class="data row0 col1" >12</td>
      <td id="T_aa56a_row0_col2" class="data row0 col2" >2</td>
      <td id="T_aa56a_row0_col3" class="data row0 col3" >0.833333</td>
    </tr>
    <tr>
      <th id="T_aa56a_level0_row1" class="row_heading level0 row1" >nouvelle-plage</th>
      <td id="T_aa56a_row1_col0" class="data row1 col0" >0</td>
      <td id="T_aa56a_row1_col1" class="data row1 col1" >1</td>
      <td id="T_aa56a_row1_col2" class="data row1 col2" >1</td>
      <td id="T_aa56a_row1_col3" class="data row1 col3" >0.000000</td>
    </tr>
    <tr>
      <th id="T_aa56a_level0_row2" class="row_heading level0 row2" >tolochenaz</th>
      <td id="T_aa56a_row2_col0" class="data row2 col0" >1</td>
      <td id="T_aa56a_row2_col1" class="data row2 col1" >1</td>
      <td id="T_aa56a_row2_col2" class="data row2 col2" >0</td>
      <td id="T_aa56a_row2_col3" class="data row2 col3" >1.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>These results reprsent the number of times that a threshold value was exceeded (k) and the number of samples (n) at each location. When the survey results are merged with the land-use values for each location the result is the number of times that threshhold value was exceeded for the range of land use values contained in the bin:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_202e1 tr:nth-child(even) {
  background-color: rgba(139, 69, 19, 0.08);
}
#T_202e1 tr:nth-child(odd) {
  background: #FFF;
}
#T_202e1 tr {
  font-size: 12px;
}
#T_202e1 th:nth-child(1) {
  background-color: #FFF;
  text-align: right;
}
</style>
<table id="T_202e1">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_202e1_level0_col0" class="col_heading level0 col0" >magnitude</th>
      <th id="T_202e1_level0_col1" class="col_heading level0 col1" >scaled</th>
      <th id="T_202e1_level0_col2" class="col_heading level0 col2" >binned</th>
      <th id="T_202e1_level0_col3" class="col_heading level0 col3" >k</th>
      <th id="T_202e1_level0_col4" class="col_heading level0 col4" >n</th>
      <th id="T_202e1_level0_col5" class="col_heading level0 col5" >n-k</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_202e1_level0_row0" class="row_heading level0 row0" >mullermatte</th>
      <td id="T_202e1_row0_col0" class="data row0 col0" >2362780.000000</td>
      <td id="T_202e1_row0_col1" class="data row0 col1" >0.513395</td>
      <td id="T_202e1_row0_col2" class="data row0 col2" >11</td>
      <td id="T_202e1_row0_col3" class="data row0 col3" >11</td>
      <td id="T_202e1_row0_col4" class="data row0 col4" >14</td>
      <td id="T_202e1_row0_col5" class="data row0 col5" >3</td>
    </tr>
    <tr>
      <th id="T_202e1_level0_row1" class="row_heading level0 row1" >nouvelle-plage</th>
      <td id="T_202e1_row1_col0" class="data row1 col0" >1517551.000000</td>
      <td id="T_202e1_row1_col1" class="data row1 col1" >0.530442</td>
      <td id="T_202e1_row1_col2" class="data row1 col2" >11</td>
      <td id="T_202e1_row1_col3" class="data row1 col3" >11</td>
      <td id="T_202e1_row1_col4" class="data row1 col4" >14</td>
      <td id="T_202e1_row1_col5" class="data row1 col5" >3</td>
    </tr>
    <tr>
      <th id="T_202e1_level0_row2" class="row_heading level0 row2" >tolochenaz</th>
      <td id="T_202e1_row2_col0" class="data row2 col0" >1733621.000000</td>
      <td id="T_202e1_row2_col1" class="data row2 col1" >0.538944</td>
      <td id="T_202e1_row2_col2" class="data row2 col2" >11</td>
      <td id="T_202e1_row2_col3" class="data row2 col3" >11</td>
      <td id="T_202e1_row2_col4" class="data row2 col4" >14</td>
      <td id="T_202e1_row2_col5" class="data row2 col5" >3</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p><strong>Interpretation:</strong> Locations where the scaled surface area classified as urban is between .5 and .55 (bin 11) exceeded the threshold value 10/14 times.</p>
<p>When this process is repeated for all locations and all land-use values, the record of success for each location can be considered in terms of the global record of success, given the land use characteristics:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_6abdd tr:nth-child(even) {
  background-color: rgba(139, 69, 19, 0.08);
}
#T_6abdd tr:nth-child(odd) {
  background: #FFF;
}
#T_6abdd tr {
  font-size: 12px;
}
#T_6abdd th:nth-child(1) {
  background-color: #FFF;
  text-align: right;
}
</style>
<table id="T_6abdd">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_6abdd_level0_col0" class="col_heading level0 col0" >magnitude</th>
      <th id="T_6abdd_level0_col1" class="col_heading level0 col1" >scaled</th>
      <th id="T_6abdd_level0_col2" class="col_heading level0 col2" >binned</th>
      <th id="T_6abdd_level0_col3" class="col_heading level0 col3" >k</th>
      <th id="T_6abdd_level0_col4" class="col_heading level0 col4" >n</th>
      <th id="T_6abdd_level0_col5" class="col_heading level0 col5" >n-k</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_6abdd_level0_row0" class="row_heading level0 row0" >Strasse</th>
      <td id="T_6abdd_row0_col0" class="data row0 col0" >89216.000000</td>
      <td id="T_6abdd_row0_col1" class="data row0 col1" >0.639085</td>
      <td id="T_6abdd_row0_col2" class="data row0 col2" >13</td>
      <td id="T_6abdd_row0_col3" class="data row0 col3" >10</td>
      <td id="T_6abdd_row0_col4" class="data row0 col4" >12</td>
      <td id="T_6abdd_row0_col5" class="data row0 col5" >2</td>
    </tr>
    <tr>
      <th id="T_6abdd_level0_row1" class="row_heading level0 row1" >length</th>
      <td id="T_6abdd_row1_col0" class="data row1 col0" >2812.716882</td>
      <td id="T_6abdd_row1_col1" class="data row1 col1" >0.386030</td>
      <td id="T_6abdd_row1_col2" class="data row1 col2" >8</td>
      <td id="T_6abdd_row1_col3" class="data row1 col3" >14</td>
      <td id="T_6abdd_row1_col4" class="data row1 col4" >18</td>
      <td id="T_6abdd_row1_col5" class="data row1 col5" >4</td>
    </tr>
    <tr>
      <th id="T_6abdd_level0_row2" class="row_heading level0 row2" >distance</th>
      <td id="T_6abdd_row2_col0" class="data row2 col0" >744.163060</td>
      <td id="T_6abdd_row2_col1" class="data row2 col1" >0.102132</td>
      <td id="T_6abdd_row2_col2" class="data row2 col2" >3</td>
      <td id="T_6abdd_row2_col3" class="data row2 col3" >47</td>
      <td id="T_6abdd_row2_col4" class="data row2 col4" >92</td>
      <td id="T_6abdd_row2_col5" class="data row2 col5" >45</td>
    </tr>
    <tr>
      <th id="T_6abdd_level0_row3" class="row_heading level0 row3" >Siedl</th>
      <td id="T_6abdd_row3_col0" class="data row3 col0" >2362780.000000</td>
      <td id="T_6abdd_row3_col1" class="data row3 col1" >0.513395</td>
      <td id="T_6abdd_row3_col2" class="data row3 col2" >11</td>
      <td id="T_6abdd_row3_col3" class="data row3 col3" >11</td>
      <td id="T_6abdd_row3_col4" class="data row3 col4" >14</td>
      <td id="T_6abdd_row3_col5" class="data row3 col5" >3</td>
    </tr>
    <tr>
      <th id="T_6abdd_level0_row4" class="row_heading level0 row4" >Stadtzentr</th>
      <td id="T_6abdd_row4_col0" class="data row4 col0" >34237.000000</td>
      <td id="T_6abdd_row4_col1" class="data row4 col1" >0.007439</td>
      <td id="T_6abdd_row4_col2" class="data row4 col2" >1</td>
      <td id="T_6abdd_row4_col3" class="data row4 col3" >13</td>
      <td id="T_6abdd_row4_col4" class="data row4 col4" >20</td>
      <td id="T_6abdd_row4_col5" class="data row4 col5" >7</td>
    </tr>
    <tr>
      <th id="T_6abdd_level0_row5" class="row_heading level0 row5" >Wald</th>
      <td id="T_6abdd_row5_col0" class="data row5 col0" >1928607.000000</td>
      <td id="T_6abdd_row5_col1" class="data row5 col1" >0.419056</td>
      <td id="T_6abdd_row5_col2" class="data row5 col2" >9</td>
      <td id="T_6abdd_row5_col3" class="data row5 col3" >14</td>
      <td id="T_6abdd_row5_col4" class="data row5 col4" >31</td>
      <td id="T_6abdd_row5_col5" class="data row5 col5" >17</td>
    </tr>
    <tr>
      <th id="T_6abdd_level0_row6" class="row_heading level0 row6" >Fels</th>
      <td id="T_6abdd_row6_col0" class="data row6 col0" >0.000000</td>
      <td id="T_6abdd_row6_col1" class="data row6 col1" >0.000000</td>
      <td id="T_6abdd_row6_col2" class="data row6 col2" >0</td>
      <td id="T_6abdd_row6_col3" class="data row6 col3" >143</td>
      <td id="T_6abdd_row6_col4" class="data row6 col4" >281</td>
      <td id="T_6abdd_row6_col5" class="data row6 col5" >138</td>
    </tr>
    <tr>
      <th id="T_6abdd_level0_row7" class="row_heading level0 row7" >Obstanlage</th>
      <td id="T_6abdd_row7_col0" class="data row7 col0" >0.000000</td>
      <td id="T_6abdd_row7_col1" class="data row7 col1" >0.000000</td>
      <td id="T_6abdd_row7_col2" class="data row7 col2" >0</td>
      <td id="T_6abdd_row7_col3" class="data row7 col3" >138</td>
      <td id="T_6abdd_row7_col4" class="data row7 col4" >273</td>
      <td id="T_6abdd_row7_col5" class="data row7 col5" >135</td>
    </tr>
    <tr>
      <th id="T_6abdd_level0_row8" class="row_heading level0 row8" >Reben</th>
      <td id="T_6abdd_row8_col0" class="data row8 col0" >0.000000</td>
      <td id="T_6abdd_row8_col1" class="data row8 col1" >0.000000</td>
      <td id="T_6abdd_row8_col2" class="data row8 col2" >0</td>
      <td id="T_6abdd_row8_col3" class="data row8 col3" >127</td>
      <td id="T_6abdd_row8_col4" class="data row8 col4" >257</td>
      <td id="T_6abdd_row8_col5" class="data row8 col5" >130</td>
    </tr>
    <tr>
      <th id="T_6abdd_level0_row9" class="row_heading level0 row9" >Sumpf</th>
      <td id="T_6abdd_row9_col0" class="data row9 col0" >0.000000</td>
      <td id="T_6abdd_row9_col1" class="data row9 col1" >0.000000</td>
      <td id="T_6abdd_row9_col2" class="data row9 col2" >0</td>
      <td id="T_6abdd_row9_col3" class="data row9 col3" >139</td>
      <td id="T_6abdd_row9_col4" class="data row9 col4" >247</td>
      <td id="T_6abdd_row9_col5" class="data row9 col5" >108</td>
    </tr>
    <tr>
      <th id="T_6abdd_level0_row10" class="row_heading level0 row10" >undefined</th>
      <td id="T_6abdd_row10_col0" class="data row10 col0" >276641.000000</td>
      <td id="T_6abdd_row10_col1" class="data row10 col1" >0.060110</td>
      <td id="T_6abdd_row10_col2" class="data row10 col2" >2</td>
      <td id="T_6abdd_row10_col3" class="data row10 col3" >11</td>
      <td id="T_6abdd_row10_col4" class="data row10 col4" >16</td>
      <td id="T_6abdd_row10_col5" class="data row10 col5" >5</td>
    </tr>
    <tr>
      <th id="T_6abdd_level0_row11" class="row_heading level0 row11" >infrastructure</th>
      <td id="T_6abdd_row11_col0" class="data row11 col0" >186185.000000</td>
      <td id="T_6abdd_row11_col1" class="data row11 col1" >0.040455</td>
      <td id="T_6abdd_row11_col2" class="data row11 col2" >1</td>
      <td id="T_6abdd_row11_col3" class="data row11 col3" >101</td>
      <td id="T_6abdd_row11_col4" class="data row11 col4" >216</td>
      <td id="T_6abdd_row11_col5" class="data row11 col5" >115</td>
    </tr>
    <tr>
      <th id="T_6abdd_level0_row12" class="row_heading level0 row12" >recreation</th>
      <td id="T_6abdd_row12_col0" class="data row12 col0" >138729.000000</td>
      <td id="T_6abdd_row12_col1" class="data row12 col1" >0.030144</td>
      <td id="T_6abdd_row12_col2" class="data row12 col2" >1</td>
      <td id="T_6abdd_row12_col3" class="data row12 col3" >127</td>
      <td id="T_6abdd_row12_col4" class="data row12 col4" >243</td>
      <td id="T_6abdd_row12_col5" class="data row12 col5" >116</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="section" id="the-frequency-of-exceeding-the-threshold-cigarette-ends">
<h3><span class="section-number">7.5.1. </span>The frequency of exceeding the threshold: cigarette ends<a class="headerlink" href="#the-frequency-of-exceeding-the-threshold-cigarette-ends" title="Permalink to this headline">#</a></h3>
<p>Given the values in the preceeding table an initial assesment of the frequency (k/n) and the odds (k/(n-k)) of exceeding the threshold can be made.</p>
<p><strong>The expected frequency</strong> (k/n) that a survey result will exceed the threshhold value for a particular land use group is given in the table below.</p>
<ol class="arabic simple">
<li><p>all data = all the results and all land use values, the median of all data</p></li>
<li><p>survey area = the survey results from the survey area, given the land use conditions of the survey area</p></li>
<li><p>lake = the survey results from the lake, given the land use conditions of the lake</p></li>
<li><p>location = the survey results from the locations with similar land-use features as mullermatte (including mullermatte)</p></li>
</ol>
<p><strong>Remarks</strong>: If the median is &gt; 0 we expect the value to be exceeded 50% of the time when all data is considered. For the survey area the rate is very close to all the data.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">collect_odds_frequency</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;odds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;k&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;n-k&quot;</span><span class="p">]</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;k&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">data</span>

<span class="k">def</span> <span class="nf">land_use_odds_frequency</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">rb</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">use</span><span class="o">=</span><span class="s2">&quot;use&quot;</span><span class="p">):</span>
    <span class="n">agg_cols</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;k&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;n-k&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">}</span>
    
    <span class="n">dall</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="n">use</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">])</span>
    <span class="n">dall</span> <span class="o">=</span> <span class="n">dall</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">use</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_cols</span><span class="p">)</span>
    <span class="n">dall</span> <span class="o">=</span> <span class="n">collect_odds_frequency</span><span class="p">(</span><span class="n">dall</span><span class="p">)</span>
    
    <span class="n">drb</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">river_bass</span> <span class="o">==</span> <span class="n">rb</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="n">use</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">])</span>
    <span class="n">drb</span> <span class="o">=</span> <span class="n">drb</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">use</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_cols</span><span class="p">)</span>
    <span class="n">drb</span> <span class="o">=</span> <span class="n">collect_odds_frequency</span><span class="p">(</span><span class="n">drb</span><span class="p">)</span>
    
    <span class="n">dfeat</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">feature</span> <span class="o">==</span> <span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="n">use</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">])</span>
    <span class="n">dfeat</span> <span class="o">=</span> <span class="n">dfeat</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">use</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_cols</span><span class="p">)</span>
    <span class="n">dfeat</span> <span class="o">=</span> <span class="n">collect_odds_frequency</span><span class="p">(</span><span class="n">dfeat</span><span class="p">)</span>
    
    <span class="n">dloc</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">location</span> <span class="o">==</span> <span class="n">location</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="n">use</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">])</span>
    <span class="n">dloc</span> <span class="o">=</span> <span class="n">dloc</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">use</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_cols</span><span class="p">)</span>
    <span class="n">dloc</span> <span class="o">=</span> <span class="n">collect_odds_frequency</span><span class="p">(</span><span class="n">dloc</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">dall</span><span class="p">,</span> <span class="n">drb</span><span class="p">,</span> <span class="n">dfeat</span><span class="p">,</span> <span class="n">dloc</span>

<span class="k">def</span> <span class="nf">summary_table_odds_frequency</span><span class="p">(</span><span class="n">dall</span><span class="p">,</span> <span class="n">drb</span><span class="p">,</span> <span class="n">dfeat</span><span class="p">,</span> <span class="n">dloc</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s2">&quot;odds&quot;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;all data&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">,</span> <span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">]):</span>    
    
    <span class="n">dall</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">column</span><span class="p">:</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">drb</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">column</span><span class="p">:</span><span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">]},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dfeat</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">column</span><span class="p">:</span><span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">]},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dloc</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">column</span><span class="p">:</span><span class="n">labels</span><span class="p">[</span><span class="mi">3</span><span class="p">]},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dall</span><span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">drb</span><span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">dfeat</span><span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">location</span><span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="mi">3</span><span class="p">]]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">summary</span>

<span class="n">all_data</span><span class="p">,</span> <span class="n">r_bas</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">location</span> <span class="o">=</span> <span class="n">land_use_odds_frequency</span><span class="p">(</span><span class="n">land_use_keys</span><span class="p">,</span> <span class="n">survey_area</span><span class="p">,</span> <span class="n">a_feature</span><span class="p">,</span> <span class="n">beach</span><span class="p">)</span>
<span class="n">summary_odds</span> <span class="o">=</span> <span class="n">summary_table_odds_frequency</span><span class="p">(</span><span class="n">all_data</span><span class="p">,</span> <span class="n">r_bas</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;all data&quot;</span><span class="p">,</span> <span class="s2">&quot;survey area&quot;</span><span class="p">,</span><span class="s2">&quot;lake&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">])</span>
<span class="n">summary_odds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">all_data</span><span class="p">,</span> <span class="n">r_bas</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">location</span> <span class="o">=</span> <span class="n">land_use_odds_frequency</span><span class="p">(</span><span class="n">land_use_keys</span><span class="p">,</span> <span class="n">survey_area</span><span class="p">,</span> <span class="n">a_feature</span><span class="p">,</span> <span class="n">beach</span><span class="p">)</span>
<span class="n">summary_frequency</span> <span class="o">=</span> <span class="n">summary_table_odds_frequency</span><span class="p">(</span><span class="n">all_data</span><span class="p">,</span> <span class="n">r_bas</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;all data&quot;</span><span class="p">,</span> <span class="s2">&quot;survey area&quot;</span><span class="p">,</span><span class="s2">&quot;lake&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">])</span>
<span class="n">summary_frequency</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">style_odds</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">props</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mf">.5</span>  <span class="k">else</span> <span class="kc">None</span>

<span class="n">sodds</span> <span class="o">=</span> <span class="n">summary_frequency</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="n">style_odds</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="s1">&#39;color:red;&#39;</span><span class="p">)</span>
<span class="n">sodds</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="s1">&#39;opacity: 40%;&#39;</span> <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&lt;</span> <span class="mf">0.50</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_78799_row0_col0, #T_78799_row0_col1, #T_78799_row1_col0, #T_78799_row1_col1, #T_78799_row1_col2, #T_78799_row2_col0, #T_78799_row2_col1, #T_78799_row2_col2, #T_78799_row2_col3, #T_78799_row3_col0, #T_78799_row3_col1, #T_78799_row3_col2, #T_78799_row4_col0, #T_78799_row4_col1, #T_78799_row4_col2, #T_78799_row5_col0, #T_78799_row5_col1, #T_78799_row5_col2, #T_78799_row6_col0, #T_78799_row6_col1, #T_78799_row7_col0, #T_78799_row7_col1, #T_78799_row7_col2, #T_78799_row7_col3, #T_78799_row8_col0, #T_78799_row8_col1, #T_78799_row8_col2, #T_78799_row9_col0, #T_78799_row9_col1, #T_78799_row9_col2, #T_78799_row9_col3, #T_78799_row10_col0, #T_78799_row10_col1, #T_78799_row10_col2, #T_78799_row11_col0, #T_78799_row11_col1, #T_78799_row12_col0, #T_78799_row12_col1, #T_78799_row12_col2 {
  opacity: 40%;
}
#T_78799_row0_col2, #T_78799_row0_col3, #T_78799_row1_col3, #T_78799_row3_col3, #T_78799_row4_col3, #T_78799_row5_col3, #T_78799_row6_col2, #T_78799_row6_col3, #T_78799_row8_col3, #T_78799_row10_col3, #T_78799_row11_col2, #T_78799_row11_col3, #T_78799_row12_col3 {
  color: red;
}
</style>
<table id="T_78799">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_78799_level0_col0" class="col_heading level0 col0" >all data</th>
      <th id="T_78799_level0_col1" class="col_heading level0 col1" >survey area</th>
      <th id="T_78799_level0_col2" class="col_heading level0 col2" >lake</th>
      <th id="T_78799_level0_col3" class="col_heading level0 col3" >location</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_78799_level0_row0" class="row_heading level0 row0" >Fels</th>
      <td id="T_78799_row0_col0" class="data row0 col0" >0.49</td>
      <td id="T_78799_row0_col1" class="data row0 col1" >0.50</td>
      <td id="T_78799_row0_col2" class="data row0 col2" >0.51</td>
      <td id="T_78799_row0_col3" class="data row0 col3" >0.51</td>
    </tr>
    <tr>
      <th id="T_78799_level0_row1" class="row_heading level0 row1" >Obstanlage</th>
      <td id="T_78799_row1_col0" class="data row1 col0" >0.49</td>
      <td id="T_78799_row1_col1" class="data row1 col1" >0.48</td>
      <td id="T_78799_row1_col2" class="data row1 col2" >0.50</td>
      <td id="T_78799_row1_col3" class="data row1 col3" >0.51</td>
    </tr>
    <tr>
      <th id="T_78799_level0_row2" class="row_heading level0 row2" >Reben</th>
      <td id="T_78799_row2_col0" class="data row2 col0" >0.49</td>
      <td id="T_78799_row2_col1" class="data row2 col1" >0.50</td>
      <td id="T_78799_row2_col2" class="data row2 col2" >0.50</td>
      <td id="T_78799_row2_col3" class="data row2 col3" >0.49</td>
    </tr>
    <tr>
      <th id="T_78799_level0_row3" class="row_heading level0 row3" >Siedl</th>
      <td id="T_78799_row3_col0" class="data row3 col0" >0.49</td>
      <td id="T_78799_row3_col1" class="data row3 col1" >0.47</td>
      <td id="T_78799_row3_col2" class="data row3 col2" >0.37</td>
      <td id="T_78799_row3_col3" class="data row3 col3" >0.79</td>
    </tr>
    <tr>
      <th id="T_78799_level0_row4" class="row_heading level0 row4" >Stadtzentr</th>
      <td id="T_78799_row4_col0" class="data row4 col0" >0.49</td>
      <td id="T_78799_row4_col1" class="data row4 col1" >0.49</td>
      <td id="T_78799_row4_col2" class="data row4 col2" >0.48</td>
      <td id="T_78799_row4_col3" class="data row4 col3" >0.65</td>
    </tr>
    <tr>
      <th id="T_78799_level0_row5" class="row_heading level0 row5" >Strasse</th>
      <td id="T_78799_row5_col0" class="data row5 col0" >0.49</td>
      <td id="T_78799_row5_col1" class="data row5 col1" >0.49</td>
      <td id="T_78799_row5_col2" class="data row5 col2" >0.39</td>
      <td id="T_78799_row5_col3" class="data row5 col3" >0.83</td>
    </tr>
    <tr>
      <th id="T_78799_level0_row6" class="row_heading level0 row6" >Sumpf</th>
      <td id="T_78799_row6_col0" class="data row6 col0" >0.49</td>
      <td id="T_78799_row6_col1" class="data row6 col1" >0.50</td>
      <td id="T_78799_row6_col2" class="data row6 col2" >0.53</td>
      <td id="T_78799_row6_col3" class="data row6 col3" >0.56</td>
    </tr>
    <tr>
      <th id="T_78799_level0_row7" class="row_heading level0 row7" >Wald</th>
      <td id="T_78799_row7_col0" class="data row7 col0" >0.49</td>
      <td id="T_78799_row7_col1" class="data row7 col1" >0.44</td>
      <td id="T_78799_row7_col2" class="data row7 col2" >0.34</td>
      <td id="T_78799_row7_col3" class="data row7 col3" >0.45</td>
    </tr>
    <tr>
      <th id="T_78799_level0_row8" class="row_heading level0 row8" >distance</th>
      <td id="T_78799_row8_col0" class="data row8 col0" >0.49</td>
      <td id="T_78799_row8_col1" class="data row8 col1" >0.49</td>
      <td id="T_78799_row8_col2" class="data row8 col2" >0.44</td>
      <td id="T_78799_row8_col3" class="data row8 col3" >0.51</td>
    </tr>
    <tr>
      <th id="T_78799_level0_row9" class="row_heading level0 row9" >infrastructure</th>
      <td id="T_78799_row9_col0" class="data row9 col0" >0.49</td>
      <td id="T_78799_row9_col1" class="data row9 col1" >0.48</td>
      <td id="T_78799_row9_col2" class="data row9 col2" >0.48</td>
      <td id="T_78799_row9_col3" class="data row9 col3" >0.47</td>
    </tr>
    <tr>
      <th id="T_78799_level0_row10" class="row_heading level0 row10" >length</th>
      <td id="T_78799_row10_col0" class="data row10 col0" >0.49</td>
      <td id="T_78799_row10_col1" class="data row10 col1" >0.49</td>
      <td id="T_78799_row10_col2" class="data row10 col2" >0.46</td>
      <td id="T_78799_row10_col3" class="data row10 col3" >0.78</td>
    </tr>
    <tr>
      <th id="T_78799_level0_row11" class="row_heading level0 row11" >recreation</th>
      <td id="T_78799_row11_col0" class="data row11 col0" >0.49</td>
      <td id="T_78799_row11_col1" class="data row11 col1" >0.49</td>
      <td id="T_78799_row11_col2" class="data row11 col2" >0.52</td>
      <td id="T_78799_row11_col3" class="data row11 col3" >0.52</td>
    </tr>
    <tr>
      <th id="T_78799_level0_row12" class="row_heading level0 row12" >undefined</th>
      <td id="T_78799_row12_col0" class="data row12 col0" >0.49</td>
      <td id="T_78799_row12_col1" class="data row12 col1" >0.50</td>
      <td id="T_78799_row12_col2" class="data row12 col2" >0.47</td>
      <td id="T_78799_row12_col3" class="data row12 col3" >0.69</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p><strong>Interpretation: frequency</strong></p>
<p>Compared to the reported median of the lakes and rivers in the Aare survey area (<a class="reference external" href="https://hammerdirt-analyst.github.io/IQAASL-End-0f-Sampling-2021/aare_sa.html">Results Aare Survey area</a>), we would expect the frequency that the threshhold is exceeded to be less than all-data in the Aare survey area given that the reported median for the same object is less in the Aare survey area.</p>
<p>With respect to all the data, and the results from locations with similar land use attributes the Aare survey area exceeded the median less often. At the lake level it happened rarely. Given the results from other locations it appears that the median was exceeded under a variety of conditions at locations similar to mullermatte.</p>
<ol class="arabic simple">
<li><p>We do not expect to exceed the national median in the Aare survey area</p></li>
<li><p>We do not expect to exceed the national median at Bielersee</p></li>
<li><p>We do expect to exceed the national median at mullermatte</p></li>
</ol>
</div>
<div class="section" id="the-probability-of-exceeding-the-threshold-cigarette-ends">
<h3><span class="section-number">7.5.2. </span>The probability of exceeding the threshold: cigarette ends<a class="headerlink" href="#the-probability-of-exceeding-the-threshold-cigarette-ends" title="Permalink to this headline">#</a></h3>
<p>The probability of exceeding the threshhold can be written as a conditional probability statement. Substituting our variables in to Bayes’ Theorem we get:</p>
<div class="math notranslate nohighlight">
\[p(\theta | landuse) = \frac{p(landuse|\theta)*p(\theta)}{p(landuse)}\]</div>
<p>This is read as:</p>
<blockquote>
<div><p>the probability of exceeding the threshold given the land-use conditions <span class="math notranslate nohighlight">\(p(\theta | landuse)\)</span> is equal to the product of  the probability that the threshold was exceeded for a land-use condition given the proabability of exceeding the threshold <span class="math notranslate nohighlight">\(p(landuse|\theta)\)</span> and the probability of exceeding the threshhold <span class="math notranslate nohighlight">\(p(\theta)\)</span>, divided by the probability of exceeding the threshold under all land-use condtions <span class="math notranslate nohighlight">\(p(landuse)\)</span>. (<a class="reference external" href="https://en.wikipedia.org/wiki/Bayes%27_theorem">Bayes’ theorem</a>) (<a class="reference external" href="https://en.wikipedia.org/wiki/Conditional_probability">conditional proabability</a>)</p>
</div></blockquote>
<p>The terms of this relationship can be labled in the following way:</p>
<ol class="arabic simple">
<li><p>Conditional probability of interest (posterior) = <span class="math notranslate nohighlight">\(p(\theta | landuse)\)</span></p></li>
<li><p>Likelihood = <span class="math notranslate nohighlight">\(p(landuse|\theta)\)</span></p></li>
<li><p>Prior = <span class="math notranslate nohighlight">\(p(\theta)\)</span></p></li>
<li><p>Marginal probability of the data = <span class="math notranslate nohighlight">\(p(landuse)\)</span></p></li>
</ol>
<div class="section" id="the-prior">
<h4><span class="section-number">7.5.2.1. </span>The prior<a class="headerlink" href="#the-prior" title="Permalink to this headline">#</a></h4>
<p>The prior is <span class="math notranslate nohighlight">\(p(\theta)\)</span> which we define as <strong>the probability of exceeding the threshhold at the parent aggregation level</strong>. That is we consider the the probability of exceeding the threshhold in the survey area by considering the results at the survey area and taking the results of all the data as prior knowledge.</p>
<div class="math notranslate nohighlight">
\[p(\theta_{survey area} | landuse_{surveyarea}) = \frac{p(landuse_{surveyarea}|\theta_{surveyarea})*p(\theta_{alldata})}{p(landuse_{surveyarea})}\]</div>
<p><strong>Scaling the prior</strong> means optimizing the parameters of the Beta function in such away that the <em>prior</em> results do not overwhelm the survey results or the inverse. For example at the lake level k=1’220 and n=2’524 but the results for mullermatte are k=10 and n=12. The known values (our prior lake data) is two orders of magnitude greater than our sample results.</p>
<div class="math notranslate nohighlight">
\[ E[Beta(1'220, (2'524-1'220))] \approx 0.483359746 \approx E[Beta(11.587249777917547, 12.385060418239757)] \]</div>
<p>In other words we can use different values of n and k to get the same expected results from the Beta distribution. The orginal values are optimized by finding the minimum values for k and (n-k) that satisfy the above requirements. (<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/optimize.html#root-finding">Optimization and Roots</a>) (<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/optimize.root-hybr.html#optimize-root-hybr">Root method</a>) (<a class="reference external" href="https://en.wikipedia.org/wiki/Powell%27s_method">Powell’s method</a>)</p>
<p><strong>Recall:</strong> The process was defined in detail here: <a class="reference external" href="https://hammerdirt-analyst.github.io/finding-one-object/titlepage.html">finding one object</a></p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculating the probability of exceeding the threshold</span>

<span class="k">def</span> <span class="nf">minimize_alpha_beta_beta</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
    
    <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
    <span class="c1"># define the mean and variance in terms of the parameters</span>
    <span class="c1"># mean or mu</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">/</span><span class="p">(</span><span class="n">alpha</span><span class="o">+</span><span class="n">beta</span><span class="p">)</span>    
    
    <span class="c1"># standard deviation</span>
    <span class="n">v</span> <span class="o">=</span>  <span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span><span class="o">/</span><span class="p">(((</span><span class="n">alpha</span><span class="o">+</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">alpha</span><span class="o">+</span><span class="n">beta</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="p">[</span><span class="n">m</span> <span class="o">-</span> <span class="n">mu</span><span class="p">,</span> <span class="n">v</span> <span class="o">-</span> <span class="n">var</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">getAlphaBeta</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">mu</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">mu</span><span class="p">)</span>

    <span class="n">beta</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span>

<span class="k">def</span> <span class="nf">update_alpha_beta_for_a_code</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">start_scale</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
    
    <span class="n">k</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">data</span>    
    <span class="n">mu</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">mu</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="mf">0.0001</span>
    <span class="n">var</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">/</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">var</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>
        <span class="n">var</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">getAlphaBeta</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span> 
    
    <span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">minimize_alpha_beta_beta</span><span class="p">,</span> <span class="n">start_scale</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">var</span><span class="p">))</span><span class="o">.</span><span class="n">x</span>
    
    <span class="k">return</span> <span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">,</span> <span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span>

<span class="k">def</span> <span class="nf">make_beta</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n_minus_k</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Makes a beta object.&quot;&quot;&quot;</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">beta</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n_minus_k</span><span class="p">)</span>
    <span class="n">dist</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">k</span>
    <span class="n">dist</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">n_minus_k</span>
    <span class="k">return</span> <span class="n">dist</span>

<span class="k">def</span> <span class="nf">update_beta</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update a beta distribution.&quot;&quot;&quot;</span>
    <span class="n">k</span><span class="p">,</span> <span class="n">n_minus_k</span> <span class="o">=</span> <span class="n">data</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">k</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">beta</span> <span class="o">+</span> <span class="n">n_minus_k</span>
    <span class="k">return</span> <span class="n">make_beta</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">y_prior</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">,</span> <span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">update_alpha_beta_for_a_code</span><span class="p">((</span><span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span><span class="p">))</span>
    <span class="n">prior_beta</span> <span class="o">=</span> <span class="n">make_beta</span><span class="p">(</span><span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">prior_beta</span>

<span class="k">def</span> <span class="nf">updated_prior</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">scaled</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
    <span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">,</span> <span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">update_alpha_beta_for_a_code</span><span class="p">((</span><span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">scaled</span><span class="p">:</span>
        <span class="n">updated_prior</span> <span class="o">=</span> <span class="n">update_beta</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="p">(</span><span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">updated_prior</span> <span class="o">=</span> <span class="n">update_beta</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">k</span><span class="p">))</span>
        
    <span class="n">yupdated</span> <span class="o">=</span> <span class="p">[</span><span class="n">updated_prior</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">updated_prior</span><span class="p">,</span> <span class="n">yupdated</span>

<span class="c1"># probability of exceeding the threshold for all data</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># a prior, jefferies</span>
<span class="n">a_prior</span> <span class="o">=</span> <span class="n">make_beta</span><span class="p">(</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">.5</span><span class="p">)</span>

<span class="c1"># the results for all the data</span>
<span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span> <span class="o">=</span> <span class="n">all_data</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">all_data</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">,</span> <span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">update_alpha_beta_for_a_code</span><span class="p">((</span><span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span><span class="p">))</span>
<span class="n">prior_beta</span> <span class="o">=</span> <span class="n">update_beta</span><span class="p">(</span><span class="n">a_prior</span><span class="p">,</span> <span class="p">(</span><span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">))</span>
<span class="n">yprior</span> <span class="o">=</span> <span class="p">[</span><span class="n">prior_beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>

<span class="c1"># probability of exceeding the threshold for the survey area</span>
<span class="c1"># the results from all similar locations with the same land use values</span>
<span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span> <span class="o">=</span> <span class="n">r_bas</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">r_bas</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">,</span> <span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">update_alpha_beta_for_a_code</span><span class="p">((</span><span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span><span class="p">))</span>
<span class="n">rbass_probs</span> <span class="o">=</span> <span class="n">update_beta</span><span class="p">(</span><span class="n">prior_beta</span><span class="p">,</span> <span class="p">(</span><span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">))</span>

<span class="c1"># the observed samples</span>
<span class="n">locations</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">river_bassin</span> <span class="o">==</span> <span class="n">survey_area</span><span class="p">]</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span> <span class="o">=</span> <span class="n">tested</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">locations</span><span class="p">]</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">tested</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">locations</span><span class="p">]</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">,</span> <span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">update_alpha_beta_for_a_code</span><span class="p">((</span><span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span><span class="p">))</span>
<span class="n">rbass_probs</span> <span class="o">=</span> <span class="n">update_beta</span><span class="p">(</span><span class="n">rbass_probs</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="n">k</span><span class="p">))</span>
<span class="n">yrbass</span> <span class="o">=</span> <span class="p">[</span><span class="n">rbass_probs</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>

<span class="c1"># probability of exceeding the threshhold for the lake</span>
<span class="c1"># the results from all similar location with the same land use value</span>
<span class="c1"># the prior we are using here is jefferies prior</span>
<span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">feature</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">,</span> <span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">update_alpha_beta_for_a_code</span><span class="p">((</span><span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span><span class="p">))</span>
<span class="n">lake_probs</span> <span class="o">=</span> <span class="n">update_beta</span><span class="p">(</span><span class="n">a_prior</span><span class="p">,</span> <span class="p">(</span><span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">))</span>

<span class="c1"># the observed samples</span>
<span class="n">locations</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">feature</span> <span class="o">==</span> <span class="n">a_feature</span><span class="p">]</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span> <span class="o">=</span> <span class="n">tested</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">locations</span><span class="p">]</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">tested</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">locations</span><span class="p">]</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">,</span> <span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">update_alpha_beta_for_a_code</span><span class="p">((</span><span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span><span class="p">))</span>
<span class="n">lake_probs</span> <span class="o">=</span> <span class="n">update_beta</span><span class="p">(</span><span class="n">lake_probs</span><span class="p">,</span> <span class="p">(</span><span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">))</span>
<span class="n">y1</span> <span class="o">=</span> <span class="p">[</span><span class="n">lake_probs</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>

<span class="c1"># probability of exceeding the threshhold for similar locations</span>
<span class="c1"># the results from all similar location with the same land use value</span>
<span class="c1"># the prior is the results from the lake </span>
<span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">location</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">,</span> <span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">update_alpha_beta_for_a_code</span><span class="p">((</span><span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span><span class="p">))</span>
<span class="n">location_probs</span> <span class="o">=</span> <span class="n">update_beta</span><span class="p">(</span><span class="n">lake_probs</span><span class="p">,</span> <span class="p">(</span><span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">))</span>
<span class="n">y2</span> <span class="o">=</span> <span class="p">[</span><span class="n">location_probs</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>

<span class="c1"># probability of exceeding the threshhold for mullermatte</span>
<span class="c1"># the prior is the location probabilities</span>
<span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span> <span class="o">=</span> <span class="n">tested</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">beach</span><span class="p">]</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">tested</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">beach</span><span class="p">]</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">,</span> <span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">update_alpha_beta_for_a_code</span><span class="p">((</span><span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span><span class="p">))</span>
<span class="n">expected_probs</span> <span class="o">=</span> <span class="n">update_beta</span><span class="p">(</span><span class="n">location_probs</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="n">k</span><span class="p">))</span>
<span class="n">y3</span> <span class="o">=</span> <span class="p">[</span><span class="n">expected_probs</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">yprior_e</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">prior_beta</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="mf">.9</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">rbas_prior</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">rbass_probs</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="mf">.9</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">lake_prior</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">lake_probs</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="mf">.9</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">location_prior</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">location_probs</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="mf">.9</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">expected</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">expected_probs</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="mf">.9</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Cigarette ends: probability of exceeding the national median</span><span class="se">\n</span><span class="s2">in the Aare survey area and Bielersee&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">yprior</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">yprior</span><span class="p">),</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;National median, 90% = </span><span class="si">{</span><span class="n">yprior_e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">yrbass</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">yrbass</span><span class="p">),</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Aare survey area, 90% = </span><span class="si">{</span><span class="n">rbas_prior</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">y1</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">y1</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Bielersee, 90% = </span><span class="si">{</span><span class="n">lake_prior</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">y2</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">y2</span><span class="p">),</span> <span class="s1">&#39;y-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Locations similar to mullermatte, 90% = </span><span class="si">{</span><span class="n">location_prior</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">y3</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">y3</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">beach</span><span class="si">}</span><span class="s1">, 90% = </span><span class="si">{</span><span class="n">expected</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/1e5fa0d2468b7ded3b95a54c998d379d225a5879d52736f9f153932bed7977b1.png" src="_images/1e5fa0d2468b7ded3b95a54c998d379d225a5879d52736f9f153932bed7977b1.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_beta</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n_minus_k</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Makes a beta object.&quot;&quot;&quot;</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">beta</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n_minus_k</span><span class="p">)</span>
    <span class="n">dist</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">k</span>
    <span class="n">dist</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">n_minus_k</span>
    <span class="k">return</span> <span class="n">dist</span>

<span class="k">def</span> <span class="nf">update_beta</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update a beta distribution.&quot;&quot;&quot;</span>
    <span class="n">k</span><span class="p">,</span> <span class="n">n_minus_k</span> <span class="o">=</span> <span class="n">data</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">k</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">beta</span> <span class="o">+</span> <span class="n">n_minus_k</span>
    <span class="k">return</span> <span class="n">make_beta</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">y_prior</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">,</span> <span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">update_alpha_beta_for_a_code</span><span class="p">((</span><span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span><span class="p">))</span>
    <span class="n">prior_beta</span> <span class="o">=</span> <span class="n">make_beta</span><span class="p">(</span><span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">prior_beta</span>

<span class="k">def</span> <span class="nf">updated_prior</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">scaled</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
    <span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">,</span> <span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">update_alpha_beta_for_a_code</span><span class="p">((</span><span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">scaled</span><span class="p">:</span>
        <span class="n">updated_prior</span> <span class="o">=</span> <span class="n">update_beta</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="p">(</span><span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">updated_prior</span> <span class="o">=</span> <span class="n">update_beta</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">k</span><span class="p">))</span>
        
    <span class="n">yupdated</span> <span class="o">=</span> <span class="p">[</span><span class="n">updated_prior</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">updated_prior</span><span class="p">,</span> <span class="n">yupdated</span>


<span class="k">def</span> <span class="nf">make_distribution</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">prior</span><span class="p">,</span> <span class="n">scaled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    
    <span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">,</span> <span class="n">ascaled</span><span class="p">,</span> <span class="n">bscaled</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">update_alpha_beta_for_a_code</span><span class="p">((</span><span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">scaled</span><span class="p">:</span>
        <span class="c1"># recall optimizing returns the paramaters for </span>
        <span class="c1"># the beta distribution</span>
        <span class="c1"># a_beta = update_beta(prior, (ascaled, bscaled))</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">ascaled</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">beta</span> <span class="o">+</span> <span class="n">bscaled</span>
        <span class="n">a_beta</span> <span class="o">=</span> <span class="n">make_beta</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># a_beta = update_beta(prior, (k, n-k))</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">k</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">beta</span> <span class="o">+</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span>
        <span class="n">a_beta</span> <span class="o">=</span> <span class="n">make_beta</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">a_beta</span>

<span class="k">def</span> <span class="nf">disributions_for_one_code</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">prior</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">tested</span><span class="p">,</span> <span class="n">survey_area</span><span class="p">,</span> <span class="n">a_feature</span><span class="p">,</span> <span class="n">beach</span><span class="p">):</span>
    <span class="n">prior_beta</span> <span class="o">=</span> <span class="n">make_distribution</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">prior</span><span class="p">)</span>

    <span class="c1"># probability of exceeding the threshold for the survey area</span>
    <span class="c1"># the results from all similar locations with the same land use values</span>
    <span class="n">rbass_probs</span> <span class="o">=</span> <span class="n">make_distribution</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">prior_beta</span><span class="p">)</span>

    <span class="c1"># the observed samples</span>
    <span class="n">locations</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">river_bassin</span> <span class="o">==</span> <span class="n">survey_area</span><span class="p">]</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">rbass_probs</span> <span class="o">=</span> <span class="n">make_distribution</span><span class="p">(</span><span class="n">tested</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">locations</span><span class="p">],</span> <span class="n">rbass_probs</span><span class="p">,</span> <span class="n">scaled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="c1"># probability of exceeding the threshhold for the lake</span>
    <span class="c1"># the results from all similar location with the same land use value</span>
    <span class="c1"># the prior we are using here is jefferies prior</span>
    <span class="n">lake_probs</span> <span class="o">=</span> <span class="n">make_distribution</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">prior</span><span class="p">)</span>

    <span class="c1"># the observed samples</span>
    <span class="n">locations</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">feature</span> <span class="o">==</span> <span class="n">a_feature</span><span class="p">]</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">lake_probs</span> <span class="o">=</span> <span class="n">make_distribution</span><span class="p">(</span><span class="n">tested</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">locations</span><span class="p">],</span> <span class="n">lake_probs</span><span class="p">,</span> <span class="n">scaled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># probability of exceeding the threshhold for similar locations</span>
    <span class="c1"># the results from all similar location with the same land use value</span>
    <span class="c1"># the prior is the results from the lake </span>
    <span class="n">location_probs</span> <span class="o">=</span> <span class="n">make_distribution</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">lake_probs</span><span class="p">,</span> <span class="n">scaled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># probability of exceeding the threshhold for mullermatte</span>
    <span class="c1"># the prior is the location probabilities</span>
    <span class="n">expected_probs</span> <span class="o">=</span> <span class="n">make_distribution</span><span class="p">(</span><span class="n">tested</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">beach</span><span class="p">],</span> <span class="n">location_probs</span><span class="p">,</span> <span class="n">scaled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">prior_beta</span><span class="p">,</span> <span class="n">rbass_probs</span><span class="p">,</span> <span class="n">lake_probs</span><span class="p">,</span> <span class="n">location_probs</span><span class="p">,</span> <span class="n">expected_probs</span>  

<span class="k">def</span> <span class="nf">collect_bin_data</span><span class="p">(</span><span class="n">tested</span><span class="p">,</span> <span class="n">xtest</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;use&quot;</span><span class="p">):</span>
    <span class="n">use</span> <span class="o">=</span> <span class="n">xtest</span><span class="p">[</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">binned</span> <span class="o">=</span> <span class="n">xtest</span><span class="o">.</span><span class="n">binned</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">locations</span> <span class="o">=</span> <span class="n">xtest</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">values</span>
    
    <span class="n">bins</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">anarray</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">locations</span><span class="p">):</span>
        
        <span class="n">a_count</span> <span class="o">=</span> <span class="n">count_nk_bin</span><span class="p">(</span><span class="n">tested</span><span class="p">,</span> <span class="n">anarray</span><span class="p">)</span>
        <span class="n">a_count</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">use</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">a_count</span><span class="p">[</span><span class="s2">&quot;binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">binned</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">bins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a_count</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bins</span>

<span class="k">def</span> <span class="nf">n_and_k_for_a_set_of_landuse_data</span><span class="p">(</span><span class="n">tested</span><span class="p">,</span> <span class="n">binned_land_use_data</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">]):</span>
    
    <span class="n">binned</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">use</span> <span class="ow">in</span> <span class="n">binned_land_use_data</span><span class="p">[</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="n">locations_by_bin</span> <span class="o">=</span> <span class="n">retrieve_locations_by_bin</span><span class="p">(</span><span class="n">binned_land_use_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">value_vars</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">use</span><span class="o">=</span><span class="n">use</span><span class="p">)</span>
        <span class="n">bin_totals</span> <span class="o">=</span> <span class="n">collect_bin_data</span><span class="p">(</span><span class="n">tested</span><span class="p">,</span> <span class="n">locations_by_bin</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
        
        <span class="n">binned</span> <span class="o">+=</span> <span class="n">bin_totals</span>
        
        
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">binned</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">value_vars</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;k&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span><span class="s2">&quot;n&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;n-k&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">assign_k_and_n</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">land_use_keys</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="n">t_test</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">code</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">threshhold</span> <span class="o">=</span> <span class="n">t_test</span><span class="o">.</span><span class="n">pcs_m</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">threshhold</span> <span class="o">=</span> <span class="n">limit</span>

    <span class="n">tested</span> <span class="o">=</span> <span class="n">luse</span><span class="o">.</span><span class="n">test_one_object</span><span class="p">(</span><span class="n">t_test</span><span class="p">,</span> <span class="n">threshhold</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">)</span>
    
    <span class="n">fi</span> <span class="o">=</span> <span class="n">n_and_k_for_a_set_of_landuse_data</span><span class="p">(</span><span class="n">tested</span><span class="p">,</span> <span class="n">land_use_keys</span><span class="p">)</span>
    <span class="n">id_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;river_bass&quot;</span><span class="p">,</span> <span class="s2">&quot;feature&quot;</span><span class="p">]</span>
    <span class="n">mag_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;scaled&quot;</span><span class="p">]</span>
    <span class="n">merge_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">]</span>

    <span class="n">test_nk</span> <span class="o">=</span> <span class="n">land_use_keys</span><span class="p">[[</span><span class="o">*</span><span class="n">id_columns</span><span class="p">,</span><span class="o">*</span><span class="n">mag_cols</span><span class="p">,</span> <span class="o">*</span><span class="n">merge_columns</span><span class="p">]]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">fi</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">merge_columns</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">test_nk</span><span class="p">,</span> <span class="n">tested</span><span class="p">,</span> <span class="n">threshhold</span>
    

<span class="k">def</span> <span class="nf">make_hierarcical_distributions</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">land_use_keys</span><span class="p">,</span> <span class="n">tested</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">beach</span><span class="p">,</span> <span class="n">a_feature</span><span class="p">,</span> <span class="n">survey_area</span><span class="p">):</span>
    
    <span class="c1"># land_use_keys, tested = assign_k_and_n(df, land_use_keys, code)</span>

    <span class="n">tester</span> <span class="o">=</span> <span class="n">land_use_odds_frequency</span><span class="p">(</span><span class="n">land_use_keys</span><span class="p">,</span> <span class="n">survey_area</span><span class="p">,</span> <span class="n">a_feature</span><span class="p">,</span> <span class="n">beach</span><span class="p">)</span>

    <span class="n">a_prior</span> <span class="o">=</span> <span class="n">make_beta</span><span class="p">(</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">.5</span><span class="p">)</span>

    <span class="n">prior_beta</span><span class="p">,</span> <span class="n">rbass_probs</span><span class="p">,</span> <span class="n">lake_probs</span><span class="p">,</span> <span class="n">location_probs</span><span class="p">,</span> <span class="n">expected_probs</span> <span class="o">=</span> <span class="n">disributions_for_one_code</span><span class="p">(</span><span class="n">tester</span><span class="p">,</span> <span class="n">a_prior</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">tested</span><span class="p">,</span> <span class="n">survey_area</span><span class="p">,</span> <span class="n">a_feature</span><span class="p">,</span> <span class="n">beach</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">prior_beta</span><span class="p">,</span> <span class="n">rbass_probs</span><span class="p">,</span> <span class="n">lake_probs</span><span class="p">,</span> <span class="n">location_probs</span><span class="p">,</span> <span class="n">expected_probs</span>

<span class="k">def</span> <span class="nf">make_expected_probs</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">prior_data</span><span class="p">,</span> <span class="n">a_prior</span><span class="p">,</span> <span class="n">scaled_prior</span><span class="p">,</span> <span class="n">scaled_expected</span><span class="p">):</span>
    
    <span class="c1"># the prior is the beta distriution of</span>
    <span class="c1"># the results for for all locations/regions whose</span>
    <span class="c1"># land-use magnitude is in the same quantile as the</span>
    <span class="c1"># location/rgeion in questions</span>
    <span class="n">prior_probs</span> <span class="o">=</span> <span class="n">make_distribution</span><span class="p">(</span><span class="n">prior_data</span><span class="p">,</span> <span class="n">a_prior</span><span class="p">,</span> <span class="n">scaled</span><span class="o">=</span><span class="n">scaled_prior</span><span class="p">)</span>
    
    <span class="c1"># the poeterior </span>
    <span class="c1"># probability of exceeding the threshhold for the location in question</span>
    <span class="c1"># the prior is the location probabilities</span>
    <span class="n">expected_probs</span> <span class="o">=</span> <span class="n">make_distribution</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">prior_probs</span><span class="p">,</span> <span class="n">scaled</span><span class="o">=</span><span class="n">scaled_expected</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">expected_probs</span>

<span class="k">class</span> <span class="nc">TestedCodeAndLandUseValues</span><span class="p">:</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">land_use_keys</span><span class="p">,</span> <span class="n">tested</span><span class="p">,</span> <span class="n">survey_area</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">prior</span><span class="p">,</span> <span class="n">threshhold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">land_use</span> <span class="o">=</span> <span class="n">land_use_keys</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">survey_area</span> <span class="o">=</span> <span class="n">survey_area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prior</span> <span class="o">=</span> <span class="n">prior</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshhold</span> <span class="o">=</span> <span class="n">threshhold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tested</span> <span class="o">=</span> <span class="n">tested</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">land_use_tested</span> <span class="o">=</span> <span class="n">land_use_keys</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">river_bassin</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">survey_area</span><span class="p">]</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_probs</span> <span class="o">=</span> <span class="kc">None</span>
        
    
<span class="c1">#     def k_and_n(self):</span>
        
<span class="c1">#         land_use_keys, tested, threshhold = assign_k_and_n(self.df, self.land_use, self.code, limit=self.threshhold)</span>
        
<span class="c1">#         self.land_use_tested = land_use_keys</span>
<span class="c1">#         self.tested = tested</span>
<span class="c1">#         self.threshhold = threshhold</span>
        
    <span class="k">def</span> <span class="nf">make_expected_probs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">prior_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">a_prior</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">scaled_prior</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">scaled_expected</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>        
    
        <span class="c1"># the prior is a beta distribution</span>
        <span class="c1"># prior data is the record of n and k for all similar land-use </span>
        <span class="c1"># values for the region and code, this is the prior</span>
        <span class="c1"># for the expected probabilities</span>
        <span class="n">prior_probs</span> <span class="o">=</span> <span class="n">make_distribution</span><span class="p">(</span><span class="n">prior_data</span><span class="p">,</span> <span class="n">a_prior</span><span class="p">,</span> <span class="n">scaled</span><span class="o">=</span><span class="n">scaled_prior</span><span class="p">)</span>

        <span class="c1"># the posterior is a beta distribution</span>
        <span class="c1"># data is the actual results for the code and region</span>
        <span class="n">expected_probs</span> <span class="o">=</span> <span class="n">make_distribution</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">prior_probs</span><span class="p">,</span> <span class="n">scaled</span><span class="o">=</span><span class="n">scaled_expected</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">expected_probs</span>
    
    <span class="k">def</span> <span class="nf">make_feature_probs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scaled_prior</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scaled_expected</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        
        <span class="c1"># returns the beta distribution for each feature in the survey area</span>
        <span class="c1"># includes the cumulative results for comparable land-use features        </span>
        
        <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">river_bassin</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">survey_area</span><span class="p">]</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        
        <span class="n">feature_probs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
                        
            <span class="n">locations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">feature</span> <span class="o">==</span> <span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">land_use_tested</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span>            
            
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">tested</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">locations</span><span class="p">],</span>
                <span class="s2">&quot;prior_data&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">land_use_tested</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">]),</span>
                <span class="s2">&quot;a_prior&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">prior</span><span class="p">,</span>
                <span class="s2">&quot;scaled_prior&quot;</span><span class="p">:</span><span class="n">scaled_prior</span><span class="p">,</span>
                <span class="s2">&quot;scaled_expected&quot;</span><span class="p">:</span><span class="n">scaled_expected</span>
            <span class="p">}</span>
            
            <span class="n">a_beta_dist</span> <span class="o">=</span> <span class="n">make_expected_probs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">feature_probs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">feature</span><span class="p">:</span> <span class="n">a_beta_dist</span><span class="p">})</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">feature_probs</span> <span class="o">=</span> <span class="n">feature_probs</span>
            
            
<span class="k">class</span> <span class="nc">LocationCodeAndLandUseValues</span><span class="p">:</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prior</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">lake_probs</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">land_use_tested</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tested</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">feature</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prior</span> <span class="o">=</span> <span class="n">prior</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lake_probs</span> <span class="o">=</span> <span class="n">lake_probs</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">land_use_tested</span> <span class="o">=</span> <span class="n">land_use_tested</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feature</span> <span class="o">=</span> <span class="n">feature</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">feature</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tested</span> <span class="o">=</span> <span class="n">tested</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">section_probs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">section_priors</span> <span class="o">=</span> <span class="kc">None</span>
        
        
    <span class="k">def</span> <span class="nf">make_expected_probs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">prior_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">a_prior</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">scaled_prior</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">scaled_expected</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>        
    
        <span class="c1"># the prior is a beta distribution</span>
        <span class="c1"># prior data is the record of n and k for all similar land-use </span>
        <span class="c1"># values for the region and code, this is the prior</span>
        <span class="c1"># for the expected probabilities</span>
        <span class="n">prior_probs</span> <span class="o">=</span> <span class="n">make_distribution</span><span class="p">(</span><span class="n">prior_data</span><span class="p">,</span> <span class="n">a_prior</span><span class="p">,</span> <span class="n">scaled</span><span class="o">=</span><span class="n">scaled_prior</span><span class="p">)</span>
        

        <span class="c1"># the posterior is a beta distribution</span>
        <span class="c1"># data is the actual results for the code and region</span>
        <span class="n">expected_probs</span> <span class="o">=</span> <span class="n">make_distribution</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">prior_probs</span><span class="p">,</span> <span class="n">scaled</span><span class="o">=</span><span class="n">scaled_expected</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">expected_probs</span><span class="p">,</span> <span class="n">prior_probs</span>
    
    <span class="k">def</span> <span class="nf">make_section_probs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scaled_prior</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">scaled_expected</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">section</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;location&quot;</span><span class="p">):</span>
        
        <span class="c1"># returns the beta distribution for each feature in the survey area</span>
        <span class="c1"># includes the cumulative results for comparable land-use features</span>
        <span class="c1"># probability of exceeding the threshhold for similar locations</span>
        <span class="c1"># the results from all similar location with the same land use value</span>
        <span class="c1"># the prior is the results from the lake </span>
                
        <span class="n">sections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">feature</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature</span><span class="p">][</span><span class="n">section</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        
        <span class="n">section_probs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">section_priors</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">a_section</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
                        
            <span class="n">locations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">section</span><span class="p">]</span> <span class="o">==</span> <span class="n">a_section</span><span class="p">]</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">land_use_tested</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span>            
            
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">tested</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">locations</span><span class="p">],</span>
                <span class="s2">&quot;prior_data&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">land_use_tested</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">]),</span>
                <span class="s2">&quot;a_prior&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">prior</span><span class="p">,</span>
                <span class="s2">&quot;scaled_prior&quot;</span><span class="p">:</span><span class="n">scaled_prior</span><span class="p">,</span>
                <span class="s2">&quot;scaled_expected&quot;</span><span class="p">:</span><span class="n">scaled_expected</span>
            <span class="p">}</span>
            <span class="c1"># expected_probs = make_distribution(data, prior_probs, scaled=scaled_expected)</span>
            <span class="n">a_beta_dist</span><span class="p">,</span> <span class="n">prior_beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_expected_probs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">section_probs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">a_section</span><span class="p">:</span> <span class="n">a_beta_dist</span><span class="p">})</span>
            <span class="n">section_priors</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">a_section</span><span class="p">:</span> <span class="n">prior_beta</span><span class="p">})</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">section_probs</span> <span class="o">=</span> <span class="n">section_probs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">section_priors</span> <span class="o">=</span> <span class="n">section_priors</span>
        
    <span class="k">def</span> <span class="nf">make_section_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">section_probs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">section_int_90</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">section_probs</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="mf">.9</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">}</span>
        <span class="n">section_samples</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">tested</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">}</span>
        <span class="n">section_exceed</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">tested</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">}</span>
        <span class="n">section_mean</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">section_probs</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">}</span>
        <span class="n">section_priors</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">section_priors</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">}</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="s2">&quot;prior&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a_column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">section_samples</span><span class="p">,</span> <span class="n">section_exceed</span><span class="p">,</span> <span class="n">section_mean</span><span class="p">,</span> <span class="n">section_priors</span><span class="p">]):</span>
            <span class="n">adf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">a_column</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">data</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">a_column</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf</span><span class="p">)</span>

        <span class="n">section_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">summary</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">section_summary</span><span class="p">,</span> <span class="n">section_int_90</span>

<span class="k">def</span> <span class="nf">probability_of_survey_area</span><span class="p">(</span><span class="n">codes</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">land_use_keys</span><span class="p">,</span> <span class="n">survey_area</span><span class="p">,</span> <span class="n">threshhold</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">dists</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">codes</span><span class="p">:</span>
        <span class="c1"># the distribution for each code is separate</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="n">land_use_keys</span><span class="p">,</span> <span class="n">tested</span><span class="p">,</span> <span class="n">threshhold</span> <span class="o">=</span> <span class="n">assign_k_and_n</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">land_use_keys</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
        <span class="c1"># a prior, jefferies</span>
        <span class="n">prior</span> <span class="o">=</span> <span class="n">make_beta</span><span class="p">(</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">.5</span><span class="p">)</span>
        
        <span class="c1"># p for all features in the survey area</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">TestedCodeAndLandUseValues</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">land_use_keys</span><span class="p">,</span> <span class="n">tested</span><span class="p">,</span> <span class="n">survey_area</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">prior</span><span class="p">,</span> <span class="n">threshhold</span><span class="o">=</span><span class="n">threshhold</span><span class="p">)</span>
        <span class="n">y</span><span class="o">.</span><span class="n">make_feature_probs</span><span class="p">(</span><span class="n">scaled_expected</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># hold results for survey area</span>
        <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">survey_area</span><span class="p">:</span><span class="n">y</span><span class="p">})</span>
        
        <span class="c1"># p for each feature in the survey area</span>
        <span class="k">for</span> <span class="n">a_feature</span> <span class="ow">in</span> <span class="n">y</span><span class="o">.</span><span class="n">feature_probs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;prior&quot;</span><span class="p">:</span> <span class="n">prior</span><span class="p">,</span>
                <span class="s2">&quot;lake_probs&quot;</span><span class="p">:</span> <span class="n">y</span><span class="o">.</span><span class="n">feature_probs</span><span class="p">[</span><span class="n">a_feature</span><span class="p">],</span>
                <span class="s2">&quot;land_use_tested&quot;</span><span class="p">:</span> <span class="n">y</span><span class="o">.</span><span class="n">land_use_tested</span><span class="p">,</span>
                <span class="s2">&quot;feature&quot;</span><span class="p">:</span><span class="n">a_feature</span><span class="p">,</span>
                <span class="s2">&quot;df&quot;</span><span class="p">:</span><span class="n">df</span><span class="p">,</span>
                <span class="s2">&quot;tested&quot;</span><span class="p">:</span> <span class="n">y</span><span class="o">.</span><span class="n">tested</span><span class="p">,</span>
                <span class="s2">&quot;code&quot;</span><span class="p">:</span><span class="n">code</span>
                <span class="p">}</span>

            <span class="n">yi</span> <span class="o">=</span> <span class="n">LocationCodeAndLandUseValues</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">yi</span><span class="o">.</span><span class="n">make_section_probs</span><span class="p">()</span>
            <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">a_feature</span><span class="p">:</span><span class="n">yi</span><span class="p">})</span>

        <span class="n">dists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dists</span>

<span class="k">def</span> <span class="nf">feature_summary</span><span class="p">(</span><span class="n">sa_x</span><span class="p">,</span> <span class="n">survey_area</span><span class="p">):</span>
    
    <span class="n">sa_y</span> <span class="o">=</span> <span class="n">sa_x</span><span class="p">[</span><span class="n">survey_area</span><span class="p">]</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">sa_y</span><span class="o">.</span><span class="n">feature_probs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">sa_y_probs</span> <span class="o">=</span> <span class="n">sa_y</span><span class="o">.</span><span class="n">feature_probs</span>
    <span class="n">row</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="n">sa_y_probs</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fs</span><span class="p">}</span>
    <span class="n">row</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;code&#39;</span><span class="p">:</span><span class="n">sa_y</span><span class="o">.</span><span class="n">code</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">row</span>

<span class="k">def</span> <span class="nf">survey_area_summary</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">survey_area</span><span class="p">):</span>
    
    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sa</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="n">survey_area</span><span class="p">]</span><span class="o">.</span><span class="n">land_use_tested</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="n">survey_area</span><span class="p">]</span><span class="o">.</span><span class="n">locations</span><span class="p">)]</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">])</span>
        <span class="n">prior</span> <span class="o">=</span> <span class="n">beta</span><span class="p">(</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">.5</span><span class="p">)</span>
        <span class="n">prior</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">.5</span>
        <span class="n">prior</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="mf">.5</span>
        <span class="n">x</span> <span class="o">=</span>  <span class="n">make_distribution</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">prior</span><span class="p">)</span>
        
        <span class="n">obs</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="n">survey_area</span><span class="p">]</span><span class="o">.</span><span class="n">tested</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="n">survey_area</span><span class="p">]</span><span class="o">.</span><span class="n">locations</span><span class="p">]</span>
        
        <span class="n">y</span> <span class="o">=</span> <span class="n">make_distribution</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        
        <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">n</span><span class="p">[</span><span class="n">survey_area</span><span class="p">]</span><span class="o">.</span><span class="n">code</span><span class="p">:</span><span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">()})</span>
    <span class="k">return</span> <span class="n">results</span>
    
        
<span class="k">def</span> <span class="nf">collect_feature_summary</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">survey_area</span><span class="p">):</span>
    
    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">a_result</span> <span class="ow">in</span> <span class="n">sa</span><span class="p">:</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">feature_summary</span><span class="p">(</span><span class="n">a_result</span><span class="p">,</span> <span class="n">survey_area</span><span class="p">)</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rows</span>
<span class="k">def</span> <span class="nf">collect_section_probs</span><span class="p">(</span><span class="n">yi</span><span class="p">,</span> <span class="n">lake</span><span class="p">):</span>
    <span class="n">yii_section_probs</span> <span class="o">=</span> <span class="n">yi</span><span class="p">[</span><span class="n">lake</span><span class="p">]</span><span class="o">.</span><span class="n">section_probs</span>
    <span class="n">mean_prob</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">yii_section_probs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="k">return</span> <span class="n">mean_prob</span>

<span class="k">def</span> <span class="nf">collect_section_priors</span><span class="p">(</span><span class="n">yi</span><span class="p">,</span> <span class="n">lake</span><span class="p">):</span>
    <span class="n">yii_section_probs</span> <span class="o">=</span> <span class="n">yi</span><span class="p">[</span><span class="n">lake</span><span class="p">]</span><span class="o">.</span><span class="n">section_priors</span>
    <span class="n">mean_prob</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">yii_section_probs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="k">return</span> <span class="n">mean_prob</span>

<span class="k">def</span> <span class="nf">section_summary</span><span class="p">(</span><span class="n">yi</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    
    <span class="n">lakes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">yi</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">aLake</span> <span class="ow">in</span> <span class="n">lakes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">code</span><span class="p">:</span><span class="n">collect_section_probs</span><span class="p">(</span><span class="n">yi</span><span class="p">,</span> <span class="n">aLake</span><span class="p">)})</span>
    <span class="n">dfy</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="p">])</span>
    <span class="n">dfy</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="n">code</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dfy</span> <span class="o">=</span> <span class="n">dfy</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">.001</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dfy</span>

<span class="k">def</span> <span class="nf">section_priors</span><span class="p">(</span><span class="n">yi</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    
    <span class="n">lakes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">yi</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">aLake</span> <span class="ow">in</span> <span class="n">lakes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">code</span><span class="p">:</span><span class="n">collect_section_priors</span><span class="p">(</span><span class="n">yi</span><span class="p">,</span> <span class="n">aLake</span><span class="p">)})</span>
    <span class="n">dfy</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="p">])</span>
    <span class="n">dfy</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="n">code</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dfy</span> <span class="o">=</span> <span class="n">dfy</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">.001</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dfy</span>
        

<span class="k">def</span> <span class="nf">section_results</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">survey_area</span><span class="p">):</span>
    <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dfs_p</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">code_result</span> <span class="ow">in</span> <span class="n">y</span><span class="p">:</span>
        <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section_summary</span><span class="p">(</span><span class="n">code_result</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="n">code_result</span><span class="p">[</span><span class="n">survey_area</span><span class="p">]</span><span class="o">.</span><span class="n">code</span><span class="p">))</span>
        <span class="n">dfs_p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">section_priors</span><span class="p">(</span><span class="n">code_result</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="n">code_result</span><span class="p">[</span><span class="n">survey_area</span><span class="p">]</span><span class="o">.</span><span class="n">code</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">dfs</span><span class="p">,</span> <span class="n">dfs_p</span>
</pre></div>
</div>
</div>
</details>
</div>
</div>
</div>
</div>
<div class="section" id="testing-a-threshold-survey-area">
<h2><span class="section-number">7.6. </span>Testing a threshold: Survey area<a class="headerlink" href="#testing-a-threshold-survey-area" title="Permalink to this headline">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># test the survey results of an object of interest</span>
<span class="c1"># against a threshhold</span>

<span class="n">survey_area</span> <span class="o">=</span> <span class="s1">&#39;aare&#39;</span>
<span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;G27&quot;</span><span class="p">,</span> <span class="s2">&quot;G30&quot;</span><span class="p">,</span> <span class="s2">&quot;Gfrags&quot;</span><span class="p">,</span> <span class="s2">&quot;Gfoam&quot;</span><span class="p">,</span> <span class="s2">&quot;G89&quot;</span><span class="p">,</span> <span class="s2">&quot;G112&quot;</span><span class="p">,</span> <span class="s2">&quot;G67&quot;</span><span class="p">,</span> <span class="s2">&quot;G70&quot;</span><span class="p">,</span> <span class="s2">&quot;G95&quot;</span><span class="p">,</span> <span class="s2">&quot;G96&quot;</span><span class="p">,</span> <span class="s2">&quot;G100&quot;</span><span class="p">,</span> <span class="s2">&quot;G98&quot;</span><span class="p">]</span>
<span class="n">aare</span> <span class="o">=</span> <span class="n">probability_of_survey_area</span><span class="p">(</span><span class="n">codes</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">lusek_copy</span><span class="p">,</span> <span class="n">survey_area</span><span class="p">)</span>

<span class="n">threshholds</span><span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">codes</span><span class="p">)]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pcs_m</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<p><strong>Theshhold equals the median survey results of all data</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">threshholds</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>code</th>
      <th>G100</th>
      <th>G112</th>
      <th>G27</th>
      <th>G30</th>
      <th>G67</th>
      <th>G70</th>
      <th>G89</th>
      <th>G95</th>
      <th>G96</th>
      <th>G98</th>
      <th>Gfoam</th>
      <th>Gfrags</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>pcs_m</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.25</td>
      <td>0.11</td>
      <td>0.05</td>
      <td>0.0</td>
      <td>0.02</td>
      <td>0.02</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.07</td>
      <td>0.23</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="section" id="the-chance-of-exceeding-the-threshold-at-each-lake">
<h3><span class="section-number">7.6.1. </span>The chance of exceeding the threshold at each lake<a class="headerlink" href="#the-chance-of-exceeding-the-threshold-at-each-lake" title="Permalink to this headline">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sa</span> <span class="o">=</span> <span class="n">aare</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>        
<span class="n">survey_area</span> <span class="o">=</span> <span class="s1">&#39;aare&#39;</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">survey_area_summary</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">survey_area</span><span class="p">)</span>
<span class="n">sarea</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">data</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;aare&#39;</span><span class="p">])</span>

<span class="n">summary</span> <span class="o">=</span> <span class="n">collect_feature_summary</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">survey_area</span><span class="p">)</span>
<span class="n">lakes_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">ls</span> <span class="o">=</span> <span class="n">lakes_summary</span><span class="p">[[</span><span class="n">lakes_summary</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">*</span><span class="n">lakes_summary</span><span class="o">.</span><span class="n">columns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]]</span>
<span class="n">ls</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ls</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ls</span><span class="p">,</span> <span class="n">sarea</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">ls</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">ls</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">ls</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">low</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">high</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlOrBr&#39;</span><span class="p">)</span>   
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_1c956_row0_col0 {
  background-color: #f27d1b;
  color: #f1f1f1;
}
#T_1c956_row0_col1, #T_1c956_row2_col1 {
  background-color: #f78921;
  color: #f1f1f1;
}
#T_1c956_row0_col2, #T_1c956_row5_col3 {
  background-color: #fb9225;
  color: #000000;
}
#T_1c956_row0_col3 {
  background-color: #da5c0a;
  color: #f1f1f1;
}
#T_1c956_row0_col4, #T_1c956_row2_col0 {
  background-color: #f5851f;
  color: #f1f1f1;
}
#T_1c956_row1_col0 {
  background-color: #fe9f2e;
  color: #000000;
}
#T_1c956_row1_col1 {
  background-color: #fea231;
  color: #000000;
}
#T_1c956_row1_col2 {
  background-color: #862e05;
  color: #f1f1f1;
}
#T_1c956_row1_col3 {
  background-color: #c34802;
  color: #f1f1f1;
}
#T_1c956_row1_col4 {
  background-color: #eb6f14;
  color: #f1f1f1;
}
#T_1c956_row2_col2 {
  background-color: #662506;
  color: #f1f1f1;
}
#T_1c956_row2_col3 {
  background-color: #cf5004;
  color: #f1f1f1;
}
#T_1c956_row2_col4 {
  background-color: #ce4f03;
  color: #f1f1f1;
}
#T_1c956_row3_col0, #T_1c956_row7_col3, #T_1c956_row8_col0 {
  background-color: #fea433;
  color: #000000;
}
#T_1c956_row3_col1 {
  background-color: #b13f03;
  color: #f1f1f1;
}
#T_1c956_row3_col2, #T_1c956_row5_col2 {
  background-color: #d85a09;
  color: #f1f1f1;
}
#T_1c956_row3_col3 {
  background-color: #993404;
  color: #f1f1f1;
}
#T_1c956_row3_col4, #T_1c956_row8_col2 {
  background-color: #e56910;
  color: #f1f1f1;
}
#T_1c956_row4_col0 {
  background-color: #fea736;
  color: #000000;
}
#T_1c956_row4_col1 {
  background-color: #fea634;
  color: #000000;
}
#T_1c956_row4_col2 {
  background-color: #ac3d03;
  color: #f1f1f1;
}
#T_1c956_row4_col3 {
  background-color: #cc4c02;
  color: #f1f1f1;
}
#T_1c956_row4_col4 {
  background-color: #f3801c;
  color: #f1f1f1;
}
#T_1c956_row5_col0, #T_1c956_row11_col0 {
  background-color: #feae3b;
  color: #000000;
}
#T_1c956_row5_col1 {
  background-color: #fed471;
  color: #000000;
}
#T_1c956_row5_col4 {
  background-color: #feb541;
  color: #000000;
}
#T_1c956_row6_col0 {
  background-color: #fe9a2a;
  color: #000000;
}
#T_1c956_row6_col1 {
  background-color: #dc5e0b;
  color: #f1f1f1;
}
#T_1c956_row6_col2 {
  background-color: #732905;
  color: #f1f1f1;
}
#T_1c956_row6_col3 {
  background-color: #c84a02;
  color: #f1f1f1;
}
#T_1c956_row6_col4 {
  background-color: #d05104;
  color: #f1f1f1;
}
#T_1c956_row7_col0 {
  background-color: #ffface;
  color: #000000;
}
#T_1c956_row7_col1 {
  background-color: #fffacd;
  color: #000000;
}
#T_1c956_row7_col2 {
  background-color: #fff8c4;
  color: #000000;
}
#T_1c956_row7_col4, #T_1c956_row9_col3 {
  background-color: #fff8c2;
  color: #000000;
}
#T_1c956_row8_col1 {
  background-color: #febe4a;
  color: #000000;
}
#T_1c956_row8_col3 {
  background-color: #ef7718;
  color: #f1f1f1;
}
#T_1c956_row8_col4 {
  background-color: #fa9125;
  color: #f1f1f1;
}
#T_1c956_row9_col0 {
  background-color: #fff8c1;
  color: #000000;
}
#T_1c956_row9_col1 {
  background-color: #ffffe5;
  color: #000000;
}
#T_1c956_row9_col2 {
  background-color: #fffddc;
  color: #000000;
}
#T_1c956_row9_col4 {
  background-color: #fffcd6;
  color: #000000;
}
#T_1c956_row10_col0 {
  background-color: #fec857;
  color: #000000;
}
#T_1c956_row10_col1 {
  background-color: #ffeea9;
  color: #000000;
}
#T_1c956_row10_col2 {
  background-color: #fee08a;
  color: #000000;
}
#T_1c956_row10_col3 {
  background-color: #fec652;
  color: #000000;
}
#T_1c956_row10_col4 {
  background-color: #fedd84;
  color: #000000;
}
#T_1c956_row11_col1 {
  background-color: #ffefaa;
  color: #000000;
}
#T_1c956_row11_col2 {
  background-color: #feeda6;
  color: #000000;
}
#T_1c956_row11_col3 {
  background-color: #fedf88;
  color: #000000;
}
#T_1c956_row11_col4 {
  background-color: #fee18c;
  color: #000000;
}
</style>
<table id="T_1c956">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_1c956_level0_col0" class="col_heading level0 col0" >neuenburgersee</th>
      <th id="T_1c956_level0_col1" class="col_heading level0 col1" >thunersee</th>
      <th id="T_1c956_level0_col2" class="col_heading level0 col2" >bielersee</th>
      <th id="T_1c956_level0_col3" class="col_heading level0 col3" >brienzersee</th>
      <th id="T_1c956_level0_col4" class="col_heading level0 col4" >aare</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_1c956_level0_row0" class="row_heading level0 row0" >G27</th>
      <td id="T_1c956_row0_col0" class="data row0 col0" >0.43</td>
      <td id="T_1c956_row0_col1" class="data row0 col1" >0.41</td>
      <td id="T_1c956_row0_col2" class="data row0 col2" >0.40</td>
      <td id="T_1c956_row0_col3" class="data row0 col3" >0.48</td>
      <td id="T_1c956_row0_col4" class="data row0 col4" >0.42</td>
    </tr>
    <tr>
      <th id="T_1c956_level0_row1" class="row_heading level0 row1" >G30</th>
      <td id="T_1c956_row1_col0" class="data row1 col0" >0.39</td>
      <td id="T_1c956_row1_col1" class="data row1 col1" >0.38</td>
      <td id="T_1c956_row1_col2" class="data row1 col2" >0.57</td>
      <td id="T_1c956_row1_col3" class="data row1 col3" >0.51</td>
      <td id="T_1c956_row1_col4" class="data row1 col4" >0.45</td>
    </tr>
    <tr>
      <th id="T_1c956_level0_row2" class="row_heading level0 row2" >Gfrags</th>
      <td id="T_1c956_row2_col0" class="data row2 col0" >0.42</td>
      <td id="T_1c956_row2_col1" class="data row2 col1" >0.41</td>
      <td id="T_1c956_row2_col2" class="data row2 col2" >0.61</td>
      <td id="T_1c956_row2_col3" class="data row2 col3" >0.50</td>
      <td id="T_1c956_row2_col4" class="data row2 col4" >0.50</td>
    </tr>
    <tr>
      <th id="T_1c956_level0_row3" class="row_heading level0 row3" >Gfoam</th>
      <td id="T_1c956_row3_col0" class="data row3 col0" >0.38</td>
      <td id="T_1c956_row3_col1" class="data row3 col1" >0.53</td>
      <td id="T_1c956_row3_col2" class="data row3 col2" >0.48</td>
      <td id="T_1c956_row3_col3" class="data row3 col3" >0.55</td>
      <td id="T_1c956_row3_col4" class="data row3 col4" >0.46</td>
    </tr>
    <tr>
      <th id="T_1c956_level0_row4" class="row_heading level0 row4" >G89</th>
      <td id="T_1c956_row4_col0" class="data row4 col0" >0.37</td>
      <td id="T_1c956_row4_col1" class="data row4 col1" >0.38</td>
      <td id="T_1c956_row4_col2" class="data row4 col2" >0.53</td>
      <td id="T_1c956_row4_col3" class="data row4 col3" >0.50</td>
      <td id="T_1c956_row4_col4" class="data row4 col4" >0.43</td>
    </tr>
    <tr>
      <th id="T_1c956_level0_row5" class="row_heading level0 row5" >G112</th>
      <td id="T_1c956_row5_col0" class="data row5 col0" >0.37</td>
      <td id="T_1c956_row5_col1" class="data row5 col1" >0.31</td>
      <td id="T_1c956_row5_col2" class="data row5 col2" >0.48</td>
      <td id="T_1c956_row5_col3" class="data row5 col3" >0.40</td>
      <td id="T_1c956_row5_col4" class="data row5 col4" >0.36</td>
    </tr>
    <tr>
      <th id="T_1c956_level0_row6" class="row_heading level0 row6" >G67</th>
      <td id="T_1c956_row6_col0" class="data row6 col0" >0.39</td>
      <td id="T_1c956_row6_col1" class="data row6 col1" >0.47</td>
      <td id="T_1c956_row6_col2" class="data row6 col2" >0.59</td>
      <td id="T_1c956_row6_col3" class="data row6 col3" >0.51</td>
      <td id="T_1c956_row6_col4" class="data row6 col4" >0.49</td>
    </tr>
    <tr>
      <th id="T_1c956_level0_row7" class="row_heading level0 row7" >G70</th>
      <td id="T_1c956_row7_col0" class="data row7 col0" >0.21</td>
      <td id="T_1c956_row7_col1" class="data row7 col1" >0.21</td>
      <td id="T_1c956_row7_col2" class="data row7 col2" >0.22</td>
      <td id="T_1c956_row7_col3" class="data row7 col3" >0.38</td>
      <td id="T_1c956_row7_col4" class="data row7 col4" >0.22</td>
    </tr>
    <tr>
      <th id="T_1c956_level0_row8" class="row_heading level0 row8" >G95</th>
      <td id="T_1c956_row8_col0" class="data row8 col0" >0.38</td>
      <td id="T_1c956_row8_col1" class="data row8 col1" >0.35</td>
      <td id="T_1c956_row8_col2" class="data row8 col2" >0.46</td>
      <td id="T_1c956_row8_col3" class="data row8 col3" >0.44</td>
      <td id="T_1c956_row8_col4" class="data row8 col4" >0.40</td>
    </tr>
    <tr>
      <th id="T_1c956_level0_row9" class="row_heading level0 row9" >G96</th>
      <td id="T_1c956_row9_col0" class="data row9 col0" >0.22</td>
      <td id="T_1c956_row9_col1" class="data row9 col1" >0.18</td>
      <td id="T_1c956_row9_col2" class="data row9 col2" >0.19</td>
      <td id="T_1c956_row9_col3" class="data row9 col3" >0.22</td>
      <td id="T_1c956_row9_col4" class="data row9 col4" >0.20</td>
    </tr>
    <tr>
      <th id="T_1c956_level0_row10" class="row_heading level0 row10" >G100</th>
      <td id="T_1c956_row10_col0" class="data row10 col0" >0.33</td>
      <td id="T_1c956_row10_col1" class="data row10 col1" >0.25</td>
      <td id="T_1c956_row10_col2" class="data row10 col2" >0.29</td>
      <td id="T_1c956_row10_col3" class="data row10 col3" >0.34</td>
      <td id="T_1c956_row10_col4" class="data row10 col4" >0.29</td>
    </tr>
    <tr>
      <th id="T_1c956_level0_row11" class="row_heading level0 row11" >G98</th>
      <td id="T_1c956_row11_col0" class="data row11 col0" >0.37</td>
      <td id="T_1c956_row11_col1" class="data row11 col1" >0.25</td>
      <td id="T_1c956_row11_col2" class="data row11 col2" >0.26</td>
      <td id="T_1c956_row11_col3" class="data row11 col3" >0.29</td>
      <td id="T_1c956_row11_col4" class="data row11 col4" >0.29</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="the-chance-of-exceeding-the-threshold-at-each-location-on-a-lake">
<h3><span class="section-number">7.6.2. </span>The chance of exceeding the threshold at each location on a lake<a class="headerlink" href="#the-chance-of-exceeding-the-threshold-at-each-location-on-a-lake" title="Permalink to this headline">#</a></h3>
<div class="section" id="the-lake-that-has-the-highest-probability-of-exceeding-the-threshhold">
<h4><span class="section-number">7.6.2.1. </span>The lake that has the highest probability of exceeding the threshhold<a class="headerlink" href="#the-lake-that-has-the-highest-probability-of-exceeding-the-threshhold" title="Permalink to this headline">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lake_locations</span><span class="p">,</span> <span class="n">lake_priors</span> <span class="o">=</span> <span class="n">section_results</span><span class="p">(</span><span class="n">sa</span><span class="p">,</span> <span class="n">survey_area</span><span class="p">)</span>
<span class="n">lake_locations</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">lake_locations</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">lake_priors</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">lake_priors</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">alake</span> <span class="o">=</span> <span class="n">lake_locations</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">feature</span> <span class="o">==</span> <span class="s1">&#39;bielersee&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">()]</span>
<span class="c1"># threshholds= df[df.code.isin(codes)].groupby(&quot;code&quot;).pcs_m.median()</span>
<span class="n">alake</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">alake</span> <span class="o">=</span> <span class="n">alake</span><span class="p">[</span><span class="n">codes</span><span class="p">]</span>
<span class="n">row_start</span> <span class="o">=</span> <span class="n">alake</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;mullermatte&quot;</span><span class="p">]</span>
<span class="n">row_start</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;expected&quot;</span>
<span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">alake</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">alake</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">alake</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">low</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">high</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlOrBr&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_0ccb0_row0_col0, #T_0ccb0_row3_col5 {
  background-color: #feca5d;
  color: #000000;
}
#T_0ccb0_row0_col1 {
  background-color: #ac3d03;
  color: #f1f1f1;
}
#T_0ccb0_row0_col2 {
  background-color: #732905;
  color: #f1f1f1;
}
#T_0ccb0_row0_col3, #T_0ccb0_row6_col4 {
  background-color: #f5851f;
  color: #f1f1f1;
}
#T_0ccb0_row0_col4 {
  background-color: #9b3504;
  color: #f1f1f1;
}
#T_0ccb0_row0_col5 {
  background-color: #dd5f0c;
  color: #f1f1f1;
}
#T_0ccb0_row0_col6 {
  background-color: #8c3004;
  color: #f1f1f1;
}
#T_0ccb0_row0_col7 {
  background-color: #fff8c2;
  color: #000000;
}
#T_0ccb0_row0_col8 {
  background-color: #fb9225;
  color: #000000;
}
#T_0ccb0_row0_col9, #T_0ccb0_row1_col10 {
  background-color: #fecd63;
  color: #000000;
}
#T_0ccb0_row0_col10 {
  background-color: #fed676;
  color: #000000;
}
#T_0ccb0_row0_col11, #T_0ccb0_row2_col7 {
  background-color: #feeca4;
  color: #000000;
}
#T_0ccb0_row1_col0, #T_0ccb0_row2_col6 {
  background-color: #ea6e13;
  color: #f1f1f1;
}
#T_0ccb0_row1_col1, #T_0ccb0_row8_col1 {
  background-color: #d45507;
  color: #f1f1f1;
}
#T_0ccb0_row1_col2 {
  background-color: #e0630d;
  color: #f1f1f1;
}
#T_0ccb0_row1_col3 {
  background-color: #d15205;
  color: #f1f1f1;
}
#T_0ccb0_row1_col4, #T_0ccb0_row9_col6 {
  background-color: #d95b09;
  color: #f1f1f1;
}
#T_0ccb0_row1_col5 {
  background-color: #fec34f;
  color: #000000;
}
#T_0ccb0_row1_col6 {
  background-color: #c84a02;
  color: #f1f1f1;
}
#T_0ccb0_row1_col7 {
  background-color: #fee596;
  color: #000000;
}
#T_0ccb0_row1_col8 {
  background-color: #f3801c;
  color: #f1f1f1;
}
#T_0ccb0_row1_col9, #T_0ccb0_row8_col9 {
  background-color: #fff1b0;
  color: #000000;
}
#T_0ccb0_row1_col11 {
  background-color: #fee08a;
  color: #000000;
}
#T_0ccb0_row2_col0, #T_0ccb0_row4_col3, #T_0ccb0_row4_col6 {
  background-color: #e3660f;
  color: #f1f1f1;
}
#T_0ccb0_row2_col1, #T_0ccb0_row2_col4, #T_0ccb0_row6_col3 {
  background-color: #f17c1a;
  color: #f1f1f1;
}
#T_0ccb0_row2_col2 {
  background-color: #d85a09;
  color: #f1f1f1;
}
#T_0ccb0_row2_col3, #T_0ccb0_row3_col6 {
  background-color: #ed7316;
  color: #f1f1f1;
}
#T_0ccb0_row2_col5, #T_0ccb0_row8_col10 {
  background-color: #fec859;
  color: #000000;
}
#T_0ccb0_row2_col8, #T_0ccb0_row9_col8 {
  background-color: #ee7617;
  color: #f1f1f1;
}
#T_0ccb0_row2_col9 {
  background-color: #fff4b5;
  color: #000000;
}
#T_0ccb0_row2_col10, #T_0ccb0_row7_col7 {
  background-color: #fed778;
  color: #000000;
}
#T_0ccb0_row2_col11, #T_0ccb0_row6_col11 {
  background-color: #fee493;
  color: #000000;
}
#T_0ccb0_row3_col0 {
  background-color: #f6861f;
  color: #f1f1f1;
}
#T_0ccb0_row3_col1 {
  background-color: #e46710;
  color: #f1f1f1;
}
#T_0ccb0_row3_col2, #T_0ccb0_row8_col4 {
  background-color: #db5d0b;
  color: #f1f1f1;
}
#T_0ccb0_row3_col3, #T_0ccb0_row5_col2 {
  background-color: #f27d1b;
  color: #f1f1f1;
}
#T_0ccb0_row3_col4 {
  background-color: #f4821d;
  color: #f1f1f1;
}
#T_0ccb0_row3_col7, #T_0ccb0_row4_col7 {
  background-color: #feeda6;
  color: #000000;
}
#T_0ccb0_row3_col8 {
  background-color: #f07919;
  color: #f1f1f1;
}
#T_0ccb0_row3_col9 {
  background-color: #fff5b8;
  color: #000000;
}
#T_0ccb0_row3_col10 {
  background-color: #fed97c;
  color: #000000;
}
#T_0ccb0_row3_col11, #T_0ccb0_row6_col10 {
  background-color: #fed573;
  color: #000000;
}
#T_0ccb0_row4_col0, #T_0ccb0_row9_col4 {
  background-color: #e76b11;
  color: #f1f1f1;
}
#T_0ccb0_row4_col1 {
  background-color: #dc5e0b;
  color: #f1f1f1;
}
#T_0ccb0_row4_col2 {
  background-color: #cf5004;
  color: #f1f1f1;
}
#T_0ccb0_row4_col4 {
  background-color: #f88b22;
  color: #f1f1f1;
}
#T_0ccb0_row4_col5 {
  background-color: #fed26d;
  color: #000000;
}
#T_0ccb0_row4_col8 {
  background-color: #f4811d;
  color: #f1f1f1;
}
#T_0ccb0_row4_col9 {
  background-color: #fff7be;
  color: #000000;
}
#T_0ccb0_row4_col10 {
  background-color: #fec652;
  color: #000000;
}
#T_0ccb0_row4_col11 {
  background-color: #fee89d;
  color: #000000;
}
#T_0ccb0_row5_col0 {
  background-color: #fd9728;
  color: #000000;
}
#T_0ccb0_row5_col1 {
  background-color: #fe9f2e;
  color: #000000;
}
#T_0ccb0_row5_col3 {
  background-color: #fe9829;
  color: #000000;
}
#T_0ccb0_row5_col4 {
  background-color: #ef7718;
  color: #f1f1f1;
}
#T_0ccb0_row5_col5, #T_0ccb0_row7_col11 {
  background-color: #feab39;
  color: #000000;
}
#T_0ccb0_row5_col6 {
  background-color: #e56910;
  color: #f1f1f1;
}
#T_0ccb0_row5_col7 {
  background-color: #fee799;
  color: #000000;
}
#T_0ccb0_row5_col8 {
  background-color: #feaf3d;
  color: #000000;
}
#T_0ccb0_row5_col9 {
  background-color: #fffacd;
  color: #000000;
}
#T_0ccb0_row5_col10, #T_0ccb0_row9_col10 {
  background-color: #fed36f;
  color: #000000;
}
#T_0ccb0_row5_col11 {
  background-color: #ffeea8;
  color: #000000;
}
#T_0ccb0_row6_col0 {
  background-color: #f17b1a;
  color: #f1f1f1;
}
#T_0ccb0_row6_col1 {
  background-color: #f5841e;
  color: #f1f1f1;
}
#T_0ccb0_row6_col2, #T_0ccb0_row6_col6 {
  background-color: #ee7416;
  color: #f1f1f1;
}
#T_0ccb0_row6_col5 {
  background-color: #fec24d;
  color: #000000;
}
#T_0ccb0_row6_col7 {
  background-color: #feeaa1;
  color: #000000;
}
#T_0ccb0_row6_col8 {
  background-color: #fc9427;
  color: #000000;
}
#T_0ccb0_row6_col9 {
  background-color: #fff6ba;
  color: #000000;
}
#T_0ccb0_row7_col0 {
  background-color: #913204;
  color: #f1f1f1;
}
#T_0ccb0_row7_col1 {
  background-color: #943304;
  color: #f1f1f1;
}
#T_0ccb0_row7_col2 {
  background-color: #662506;
  color: #f1f1f1;
}
#T_0ccb0_row7_col3 {
  background-color: #7c2c05;
  color: #f1f1f1;
}
#T_0ccb0_row7_col4 {
  background-color: #c94b02;
  color: #f1f1f1;
}
#T_0ccb0_row7_col5 {
  background-color: #df620d;
  color: #f1f1f1;
}
#T_0ccb0_row7_col6 {
  background-color: #742905;
  color: #f1f1f1;
}
#T_0ccb0_row7_col8 {
  background-color: #a93c03;
  color: #f1f1f1;
}
#T_0ccb0_row7_col9 {
  background-color: #ffffe5;
  color: #000000;
}
#T_0ccb0_row7_col10 {
  background-color: #feb23f;
  color: #000000;
}
#T_0ccb0_row8_col0 {
  background-color: #de610c;
  color: #f1f1f1;
}
#T_0ccb0_row8_col2 {
  background-color: #ce4f03;
  color: #f1f1f1;
}
#T_0ccb0_row8_col3 {
  background-color: #f07818;
  color: #f1f1f1;
}
#T_0ccb0_row8_col5 {
  background-color: #fea634;
  color: #000000;
}
#T_0ccb0_row8_col6 {
  background-color: #d55607;
  color: #f1f1f1;
}
#T_0ccb0_row8_col7 {
  background-color: #fee79a;
  color: #000000;
}
#T_0ccb0_row8_col8 {
  background-color: #f27f1b;
  color: #f1f1f1;
}
#T_0ccb0_row8_col11 {
  background-color: #fedc82;
  color: #000000;
}
#T_0ccb0_row9_col0, #T_0ccb0_row9_col2 {
  background-color: #e96d13;
  color: #f1f1f1;
}
#T_0ccb0_row9_col1 {
  background-color: #cb4b02;
  color: #f1f1f1;
}
#T_0ccb0_row9_col3 {
  background-color: #e2650f;
  color: #f1f1f1;
}
#T_0ccb0_row9_col5 {
  background-color: #fb9326;
  color: #000000;
}
#T_0ccb0_row9_col7 {
  background-color: #fedd84;
  color: #000000;
}
#T_0ccb0_row9_col9 {
  background-color: #fee595;
  color: #000000;
}
#T_0ccb0_row9_col11 {
  background-color: #fee18c;
  color: #000000;
}
</style>
<table id="T_0ccb0">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_0ccb0_level0_col0" class="col_heading level0 col0" >G27</th>
      <th id="T_0ccb0_level0_col1" class="col_heading level0 col1" >G30</th>
      <th id="T_0ccb0_level0_col2" class="col_heading level0 col2" >Gfrags</th>
      <th id="T_0ccb0_level0_col3" class="col_heading level0 col3" >Gfoam</th>
      <th id="T_0ccb0_level0_col4" class="col_heading level0 col4" >G89</th>
      <th id="T_0ccb0_level0_col5" class="col_heading level0 col5" >G112</th>
      <th id="T_0ccb0_level0_col6" class="col_heading level0 col6" >G67</th>
      <th id="T_0ccb0_level0_col7" class="col_heading level0 col7" >G70</th>
      <th id="T_0ccb0_level0_col8" class="col_heading level0 col8" >G95</th>
      <th id="T_0ccb0_level0_col9" class="col_heading level0 col9" >G96</th>
      <th id="T_0ccb0_level0_col10" class="col_heading level0 col10" >G100</th>
      <th id="T_0ccb0_level0_col11" class="col_heading level0 col11" >G98</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_0ccb0_level0_row0" class="row_heading level0 row0" >bielersee_vinelz_fankhausers</th>
      <td id="T_0ccb0_row0_col0" class="data row0 col0" >0.32</td>
      <td id="T_0ccb0_row0_col1" class="data row0 col1" >0.59</td>
      <td id="T_0ccb0_row0_col2" class="data row0 col2" >0.66</td>
      <td id="T_0ccb0_row0_col3" class="data row0 col3" >0.44</td>
      <td id="T_0ccb0_row0_col4" class="data row0 col4" >0.61</td>
      <td id="T_0ccb0_row0_col5" class="data row0 col5" >0.50</td>
      <td id="T_0ccb0_row0_col6" class="data row0 col6" >0.63</td>
      <td id="T_0ccb0_row0_col7" class="data row0 col7" >0.18</td>
      <td id="T_0ccb0_row0_col8" class="data row0 col8" >0.41</td>
      <td id="T_0ccb0_row0_col9" class="data row0 col9" >0.31</td>
      <td id="T_0ccb0_row0_col10" class="data row0 col10" >0.29</td>
      <td id="T_0ccb0_row0_col11" class="data row0 col11" >0.23</td>
    </tr>
    <tr>
      <th id="T_0ccb0_level0_row1" class="row_heading level0 row1" >camp-des-peches</th>
      <td id="T_0ccb0_row1_col0" class="data row1 col0" >0.48</td>
      <td id="T_0ccb0_row1_col1" class="data row1 col1" >0.52</td>
      <td id="T_0ccb0_row1_col2" class="data row1 col2" >0.50</td>
      <td id="T_0ccb0_row1_col3" class="data row1 col3" >0.53</td>
      <td id="T_0ccb0_row1_col4" class="data row1 col4" >0.51</td>
      <td id="T_0ccb0_row1_col5" class="data row1 col5" >0.33</td>
      <td id="T_0ccb0_row1_col6" class="data row1 col6" >0.55</td>
      <td id="T_0ccb0_row1_col7" class="data row1 col7" >0.26</td>
      <td id="T_0ccb0_row1_col8" class="data row1 col8" >0.44</td>
      <td id="T_0ccb0_row1_col9" class="data row1 col9" >0.21</td>
      <td id="T_0ccb0_row1_col10" class="data row1 col10" >0.31</td>
      <td id="T_0ccb0_row1_col11" class="data row1 col11" >0.27</td>
    </tr>
    <tr>
      <th id="T_0ccb0_level0_row2" class="row_heading level0 row2" >erlach-camping-strand</th>
      <td id="T_0ccb0_row2_col0" class="data row2 col0" >0.49</td>
      <td id="T_0ccb0_row2_col1" class="data row2 col1" >0.45</td>
      <td id="T_0ccb0_row2_col2" class="data row2 col2" >0.51</td>
      <td id="T_0ccb0_row2_col3" class="data row2 col3" >0.47</td>
      <td id="T_0ccb0_row2_col4" class="data row2 col4" >0.45</td>
      <td id="T_0ccb0_row2_col5" class="data row2 col5" >0.32</td>
      <td id="T_0ccb0_row2_col6" class="data row2 col6" >0.48</td>
      <td id="T_0ccb0_row2_col7" class="data row2 col7" >0.23</td>
      <td id="T_0ccb0_row2_col8" class="data row2 col8" >0.46</td>
      <td id="T_0ccb0_row2_col9" class="data row2 col9" >0.21</td>
      <td id="T_0ccb0_row2_col10" class="data row2 col10" >0.29</td>
      <td id="T_0ccb0_row2_col11" class="data row2 col11" >0.26</td>
    </tr>
    <tr>
      <th id="T_0ccb0_level0_row3" class="row_heading level0 row3" >gals-reserve</th>
      <td id="T_0ccb0_row3_col0" class="data row3 col0" >0.43</td>
      <td id="T_0ccb0_row3_col1" class="data row3 col1" >0.49</td>
      <td id="T_0ccb0_row3_col2" class="data row3 col2" >0.51</td>
      <td id="T_0ccb0_row3_col3" class="data row3 col3" >0.45</td>
      <td id="T_0ccb0_row3_col4" class="data row3 col4" >0.44</td>
      <td id="T_0ccb0_row3_col5" class="data row3 col5" >0.32</td>
      <td id="T_0ccb0_row3_col6" class="data row3 col6" >0.47</td>
      <td id="T_0ccb0_row3_col7" class="data row3 col7" >0.23</td>
      <td id="T_0ccb0_row3_col8" class="data row3 col8" >0.45</td>
      <td id="T_0ccb0_row3_col9" class="data row3 col9" >0.20</td>
      <td id="T_0ccb0_row3_col10" class="data row3 col10" >0.29</td>
      <td id="T_0ccb0_row3_col11" class="data row3 col11" >0.29</td>
    </tr>
    <tr>
      <th id="T_0ccb0_level0_row4" class="row_heading level0 row4" >ligerz-strand</th>
      <td id="T_0ccb0_row4_col0" class="data row4 col0" >0.48</td>
      <td id="T_0ccb0_row4_col1" class="data row4 col1" >0.51</td>
      <td id="T_0ccb0_row4_col2" class="data row4 col2" >0.53</td>
      <td id="T_0ccb0_row4_col3" class="data row4 col3" >0.49</td>
      <td id="T_0ccb0_row4_col4" class="data row4 col4" >0.43</td>
      <td id="T_0ccb0_row4_col5" class="data row4 col5" >0.30</td>
      <td id="T_0ccb0_row4_col6" class="data row4 col6" >0.49</td>
      <td id="T_0ccb0_row4_col7" class="data row4 col7" >0.23</td>
      <td id="T_0ccb0_row4_col8" class="data row4 col8" >0.44</td>
      <td id="T_0ccb0_row4_col9" class="data row4 col9" >0.19</td>
      <td id="T_0ccb0_row4_col10" class="data row4 col10" >0.33</td>
      <td id="T_0ccb0_row4_col11" class="data row4 col11" >0.24</td>
    </tr>
    <tr>
      <th id="T_0ccb0_level0_row5" class="row_heading level0 row5" >luscherz-plage</th>
      <td id="T_0ccb0_row5_col0" class="data row5 col0" >0.41</td>
      <td id="T_0ccb0_row5_col1" class="data row5 col1" >0.39</td>
      <td id="T_0ccb0_row5_col2" class="data row5 col2" >0.45</td>
      <td id="T_0ccb0_row5_col3" class="data row5 col3" >0.40</td>
      <td id="T_0ccb0_row5_col4" class="data row5 col4" >0.46</td>
      <td id="T_0ccb0_row5_col5" class="data row5 col5" >0.37</td>
      <td id="T_0ccb0_row5_col6" class="data row5 col6" >0.49</td>
      <td id="T_0ccb0_row5_col7" class="data row5 col7" >0.25</td>
      <td id="T_0ccb0_row5_col8" class="data row5 col8" >0.37</td>
      <td id="T_0ccb0_row5_col9" class="data row5 col9" >0.17</td>
      <td id="T_0ccb0_row5_col10" class="data row5 col10" >0.30</td>
      <td id="T_0ccb0_row5_col11" class="data row5 col11" >0.23</td>
    </tr>
    <tr>
      <th id="T_0ccb0_level0_row6" class="row_heading level0 row6" >luscherz-two</th>
      <td id="T_0ccb0_row6_col0" class="data row6 col0" >0.45</td>
      <td id="T_0ccb0_row6_col1" class="data row6 col1" >0.44</td>
      <td id="T_0ccb0_row6_col2" class="data row6 col2" >0.46</td>
      <td id="T_0ccb0_row6_col3" class="data row6 col3" >0.45</td>
      <td id="T_0ccb0_row6_col4" class="data row6 col4" >0.44</td>
      <td id="T_0ccb0_row6_col5" class="data row6 col5" >0.34</td>
      <td id="T_0ccb0_row6_col6" class="data row6 col6" >0.46</td>
      <td id="T_0ccb0_row6_col7" class="data row6 col7" >0.24</td>
      <td id="T_0ccb0_row6_col8" class="data row6 col8" >0.41</td>
      <td id="T_0ccb0_row6_col9" class="data row6 col9" >0.20</td>
      <td id="T_0ccb0_row6_col10" class="data row6 col10" >0.29</td>
      <td id="T_0ccb0_row6_col11" class="data row6 col11" >0.26</td>
    </tr>
    <tr>
      <th id="T_0ccb0_level0_row7" class="row_heading level0 row7" >mullermatte</th>
      <td id="T_0ccb0_row7_col0" class="data row7 col0" >0.62</td>
      <td id="T_0ccb0_row7_col1" class="data row7 col1" >0.62</td>
      <td id="T_0ccb0_row7_col2" class="data row7 col2" >0.68</td>
      <td id="T_0ccb0_row7_col3" class="data row7 col3" >0.65</td>
      <td id="T_0ccb0_row7_col4" class="data row7 col4" >0.54</td>
      <td id="T_0ccb0_row7_col5" class="data row7 col5" >0.50</td>
      <td id="T_0ccb0_row7_col6" class="data row7 col6" >0.66</td>
      <td id="T_0ccb0_row7_col7" class="data row7 col7" >0.29</td>
      <td id="T_0ccb0_row7_col8" class="data row7 col8" >0.59</td>
      <td id="T_0ccb0_row7_col9" class="data row7 col9" >0.12</td>
      <td id="T_0ccb0_row7_col10" class="data row7 col10" >0.36</td>
      <td id="T_0ccb0_row7_col11" class="data row7 col11" >0.37</td>
    </tr>
    <tr>
      <th id="T_0ccb0_level0_row8" class="row_heading level0 row8" >nidau-strand</th>
      <td id="T_0ccb0_row8_col0" class="data row8 col0" >0.50</td>
      <td id="T_0ccb0_row8_col1" class="data row8 col1" >0.52</td>
      <td id="T_0ccb0_row8_col2" class="data row8 col2" >0.54</td>
      <td id="T_0ccb0_row8_col3" class="data row8 col3" >0.46</td>
      <td id="T_0ccb0_row8_col4" class="data row8 col4" >0.51</td>
      <td id="T_0ccb0_row8_col5" class="data row8 col5" >0.38</td>
      <td id="T_0ccb0_row8_col6" class="data row8 col6" >0.52</td>
      <td id="T_0ccb0_row8_col7" class="data row8 col7" >0.25</td>
      <td id="T_0ccb0_row8_col8" class="data row8 col8" >0.45</td>
      <td id="T_0ccb0_row8_col9" class="data row8 col9" >0.21</td>
      <td id="T_0ccb0_row8_col10" class="data row8 col10" >0.32</td>
      <td id="T_0ccb0_row8_col11" class="data row8 col11" >0.28</td>
    </tr>
    <tr>
      <th id="T_0ccb0_level0_row9" class="row_heading level0 row9" >strandboden-biel</th>
      <td id="T_0ccb0_row9_col0" class="data row9 col0" >0.48</td>
      <td id="T_0ccb0_row9_col1" class="data row9 col1" >0.54</td>
      <td id="T_0ccb0_row9_col2" class="data row9 col2" >0.48</td>
      <td id="T_0ccb0_row9_col3" class="data row9 col3" >0.49</td>
      <td id="T_0ccb0_row9_col4" class="data row9 col4" >0.48</td>
      <td id="T_0ccb0_row9_col5" class="data row9 col5" >0.41</td>
      <td id="T_0ccb0_row9_col6" class="data row9 col6" >0.51</td>
      <td id="T_0ccb0_row9_col7" class="data row9 col7" >0.28</td>
      <td id="T_0ccb0_row9_col8" class="data row9 col8" >0.46</td>
      <td id="T_0ccb0_row9_col9" class="data row9 col9" >0.26</td>
      <td id="T_0ccb0_row9_col10" class="data row9 col10" >0.30</td>
      <td id="T_0ccb0_row9_col11" class="data row9 col11" >0.27</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
</div>
<div class="section" id="details-the-location-that-has-the-highest-probability">
<h3><span class="section-number">7.6.3. </span>Details: the location that has the highest probability<a class="headerlink" href="#details-the-location-that-has-the-highest-probability" title="Permalink to this headline">#</a></h3>
<p>How expectations change when you consider the results from similar locations.</p>
<ol class="arabic simple">
<li><p>Observed = n/k for the location only</p></li>
<li><p>Prior = the mean of the Beta distribution from all locations with similar land use</p></li>
<li><p>expected = The posterior distribution given the observed data and the prior</p></li>
</ol>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alakep</span> <span class="o">=</span> <span class="n">lake_priors</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">feature</span> <span class="o">==</span> <span class="s1">&#39;bielersee&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">()]</span>

<span class="n">alakep</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">alakep</span> <span class="o">=</span> <span class="n">alakep</span><span class="p">[</span><span class="n">codes</span><span class="p">]</span>
<span class="n">row_two</span> <span class="o">=</span> <span class="n">alakep</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;mullermatte&quot;</span><span class="p">]</span>
<span class="n">row_two</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;prior&quot;</span>

<span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">alake</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">alake</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="n">nks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">codes</span><span class="p">:</span>
    <span class="n">t_test</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">alake</span><span class="o">.</span><span class="n">index</span><span class="p">))</span><span class="o">&amp;</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">code</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">threshhold</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">code</span><span class="p">)]</span><span class="o">.</span><span class="n">pcs_m</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
    <span class="n">nk</span> <span class="o">=</span> <span class="n">luse</span><span class="o">.</span><span class="n">test_one_object</span><span class="p">(</span><span class="n">t_test</span><span class="p">,</span> <span class="n">threshhold</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">)</span>
    <span class="n">nk</span><span class="p">[</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">nk</span><span class="p">[</span><span class="s2">&quot;k/n&quot;</span><span class="p">]</span>
    <span class="n">nks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nk</span><span class="p">[</span><span class="n">code</span><span class="p">])</span>
<span class="n">n_k_s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">nks</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">row_one</span> <span class="o">=</span> <span class="n">n_k_s</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;mullermatte&quot;</span><span class="p">]</span>
<span class="n">row_one</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;observed&quot;</span>

<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">row_one</span><span class="p">,</span> <span class="n">row_two</span><span class="p">,</span> <span class="n">row_start</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">low</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">high</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlOrBr&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_24ef0_row0_col0, #T_24ef0_row0_col1, #T_24ef0_row0_col2, #T_24ef0_row0_col3, #T_24ef0_row0_col5, #T_24ef0_row0_col6, #T_24ef0_row0_col8, #T_24ef0_row2_col2 {
  background-color: #662506;
  color: #f1f1f1;
}
#T_24ef0_row0_col4 {
  background-color: #702806;
  color: #f1f1f1;
}
#T_24ef0_row0_col7 {
  background-color: #fec34f;
  color: #000000;
}
#T_24ef0_row0_col9, #T_24ef0_row2_col9 {
  background-color: #ffffe5;
  color: #000000;
}
#T_24ef0_row0_col10 {
  background-color: #fa9125;
  color: #f1f1f1;
}
#T_24ef0_row0_col11, #T_24ef0_row2_col5 {
  background-color: #df620d;
  color: #f1f1f1;
}
#T_24ef0_row1_col0 {
  background-color: #d65808;
  color: #f1f1f1;
}
#T_24ef0_row1_col1 {
  background-color: #d95b09;
  color: #f1f1f1;
}
#T_24ef0_row1_col2 {
  background-color: #d25306;
  color: #f1f1f1;
}
#T_24ef0_row1_col3 {
  background-color: #d55607;
  color: #f1f1f1;
}
#T_24ef0_row1_col4 {
  background-color: #e56910;
  color: #f1f1f1;
}
#T_24ef0_row1_col5 {
  background-color: #fead3a;
  color: #000000;
}
#T_24ef0_row1_col6 {
  background-color: #ce4f03;
  color: #f1f1f1;
}
#T_24ef0_row1_col7 {
  background-color: #fee390;
  color: #000000;
}
#T_24ef0_row1_col8 {
  background-color: #ec7014;
  color: #f1f1f1;
}
#T_24ef0_row1_col9 {
  background-color: #fff1ae;
  color: #000000;
}
#T_24ef0_row1_col10 {
  background-color: #fec550;
  color: #000000;
}
#T_24ef0_row1_col11 {
  background-color: #fed36f;
  color: #000000;
}
#T_24ef0_row2_col0 {
  background-color: #913204;
  color: #f1f1f1;
}
#T_24ef0_row2_col1 {
  background-color: #943304;
  color: #f1f1f1;
}
#T_24ef0_row2_col3 {
  background-color: #7c2c05;
  color: #f1f1f1;
}
#T_24ef0_row2_col4 {
  background-color: #c94b02;
  color: #f1f1f1;
}
#T_24ef0_row2_col6 {
  background-color: #742905;
  color: #f1f1f1;
}
#T_24ef0_row2_col7 {
  background-color: #fed778;
  color: #000000;
}
#T_24ef0_row2_col8 {
  background-color: #a93c03;
  color: #f1f1f1;
}
#T_24ef0_row2_col10 {
  background-color: #feb23f;
  color: #000000;
}
#T_24ef0_row2_col11 {
  background-color: #feab39;
  color: #000000;
}
</style>
<table id="T_24ef0">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_24ef0_level0_col0" class="col_heading level0 col0" >G27</th>
      <th id="T_24ef0_level0_col1" class="col_heading level0 col1" >G30</th>
      <th id="T_24ef0_level0_col2" class="col_heading level0 col2" >Gfrags</th>
      <th id="T_24ef0_level0_col3" class="col_heading level0 col3" >Gfoam</th>
      <th id="T_24ef0_level0_col4" class="col_heading level0 col4" >G89</th>
      <th id="T_24ef0_level0_col5" class="col_heading level0 col5" >G112</th>
      <th id="T_24ef0_level0_col6" class="col_heading level0 col6" >G67</th>
      <th id="T_24ef0_level0_col7" class="col_heading level0 col7" >G70</th>
      <th id="T_24ef0_level0_col8" class="col_heading level0 col8" >G95</th>
      <th id="T_24ef0_level0_col9" class="col_heading level0 col9" >G96</th>
      <th id="T_24ef0_level0_col10" class="col_heading level0 col10" >G100</th>
      <th id="T_24ef0_level0_col11" class="col_heading level0 col11" >G98</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_24ef0_level0_row0" class="row_heading level0 row0" >observed</th>
      <td id="T_24ef0_row0_col0" class="data row0 col0" >0.83</td>
      <td id="T_24ef0_row0_col1" class="data row0 col1" >0.83</td>
      <td id="T_24ef0_row0_col2" class="data row0 col2" >1.00</td>
      <td id="T_24ef0_row0_col3" class="data row0 col3" >0.92</td>
      <td id="T_24ef0_row0_col4" class="data row0 col4" >0.67</td>
      <td id="T_24ef0_row0_col5" class="data row0 col5" >0.75</td>
      <td id="T_24ef0_row0_col6" class="data row0 col6" >0.92</td>
      <td id="T_24ef0_row0_col7" class="data row0 col7" >0.33</td>
      <td id="T_24ef0_row0_col8" class="data row0 col8" >0.83</td>
      <td id="T_24ef0_row0_col9" class="data row0 col9" >0.00</td>
      <td id="T_24ef0_row0_col10" class="data row0 col10" >0.42</td>
      <td id="T_24ef0_row0_col11" class="data row0 col11" >0.50</td>
    </tr>
    <tr>
      <th id="T_24ef0_level0_row1" class="row_heading level0 row1" >prior</th>
      <td id="T_24ef0_row1_col0" class="data row1 col0" >0.52</td>
      <td id="T_24ef0_row1_col1" class="data row1 col1" >0.51</td>
      <td id="T_24ef0_row1_col2" class="data row1 col2" >0.53</td>
      <td id="T_24ef0_row1_col3" class="data row1 col3" >0.52</td>
      <td id="T_24ef0_row1_col4" class="data row1 col4" >0.49</td>
      <td id="T_24ef0_row1_col5" class="data row1 col5" >0.37</td>
      <td id="T_24ef0_row1_col6" class="data row1 col6" >0.54</td>
      <td id="T_24ef0_row1_col7" class="data row1 col7" >0.26</td>
      <td id="T_24ef0_row1_col8" class="data row1 col8" >0.47</td>
      <td id="T_24ef0_row1_col9" class="data row1 col9" >0.22</td>
      <td id="T_24ef0_row1_col10" class="data row1 col10" >0.33</td>
      <td id="T_24ef0_row1_col11" class="data row1 col11" >0.30</td>
    </tr>
    <tr>
      <th id="T_24ef0_level0_row2" class="row_heading level0 row2" >expected</th>
      <td id="T_24ef0_row2_col0" class="data row2 col0" >0.62</td>
      <td id="T_24ef0_row2_col1" class="data row2 col1" >0.62</td>
      <td id="T_24ef0_row2_col2" class="data row2 col2" >0.68</td>
      <td id="T_24ef0_row2_col3" class="data row2 col3" >0.65</td>
      <td id="T_24ef0_row2_col4" class="data row2 col4" >0.54</td>
      <td id="T_24ef0_row2_col5" class="data row2 col5" >0.50</td>
      <td id="T_24ef0_row2_col6" class="data row2 col6" >0.66</td>
      <td id="T_24ef0_row2_col7" class="data row2 col7" >0.29</td>
      <td id="T_24ef0_row2_col8" class="data row2 col8" >0.59</td>
      <td id="T_24ef0_row2_col9" class="data row2 col9" >0.12</td>
      <td id="T_24ef0_row2_col10" class="data row2 col10" >0.36</td>
      <td id="T_24ef0_row2_col11" class="data row2 col11" >0.37</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
</div>
<div class="section" id="effects-of-land-use-how-does-land-use-change-the-probability-of-exceeding-the-threshhold">
<h2><span class="section-number">7.7. </span>Effects of land use: How does land use change the probability of exceeding the threshhold?<a class="headerlink" href="#effects-of-land-use-how-does-land-use-change-the-probability-of-exceeding-the-threshhold" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lu_sa_g</span> <span class="o">=</span> <span class="n">sa</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;aare&quot;</span><span class="p">]</span>
<span class="n">locations</span> <span class="o">=</span> <span class="n">lu_sa_g</span><span class="o">.</span><span class="n">locations</span>
<span class="n">lusea</span> <span class="o">=</span> <span class="n">lu_sa_g</span><span class="o">.</span><span class="n">land_use_tested</span>

<span class="n">nklsa</span> <span class="o">=</span> <span class="n">lu_sa_g</span><span class="o">.</span><span class="n">tested</span>
<span class="n">G27</span> <span class="o">=</span> <span class="n">lake_locations</span><span class="p">[</span><span class="s2">&quot;G27&quot;</span><span class="p">]</span>
<span class="n">binmap</span> <span class="o">=</span> <span class="n">lusea</span><span class="p">[</span><span class="n">lusea</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">locations</span><span class="p">)][[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span><span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">binmap</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">binmap</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">G27</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-aare-survey-area">
<h3><span class="section-number">7.7.1. </span>The Aare survey area<a class="headerlink" href="#the-aare-survey-area" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">binmap</span><span class="p">[</span><span class="n">binmap</span><span class="o">.</span><span class="n">use</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;infrastucture&quot;</span><span class="p">,</span> <span class="s2">&quot;recreation&quot;</span><span class="p">,</span> <span class="s2">&quot;Reben&quot;</span><span class="p">])]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;binned&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;use&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;binned&#39;, ylabel=&#39;p&#39;&gt;
</pre></div>
</div>
<img alt="_images/93fe6e98694d83f671854f4a1970aee00814fc797671608f2063250cbc7342e3.png" src="_images/93fe6e98694d83f671854f4a1970aee00814fc797671608f2063250cbc7342e3.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">binmap</span><span class="p">[</span><span class="n">binmap</span><span class="o">.</span><span class="n">use</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;Strasse&quot;</span><span class="p">,</span> <span class="s2">&quot;distance&quot;</span><span class="p">,</span> <span class="s2">&quot;length&quot;</span><span class="p">])]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;binned&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;use&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: xlabel=&#39;binned&#39;, ylabel=&#39;p&#39;&gt;
</pre></div>
</div>
<img alt="_images/9aae0a2a07673c4ffedf866c3f1b2e88bfe6cdaae7f47bb91d35ee4518931332.png" src="_images/9aae0a2a07673c4ffedf866c3f1b2e88bfe6cdaae7f47bb91d35ee4518931332.png" />
</div>
</div>
<div class="cell tag_remove-input docutils container">
</div>
</div>
<div class="section" id="all-survey-results-logistic-regression">
<h3><span class="section-number">7.7.2. </span>All survey results: Logistic regression<a class="headerlink" href="#all-survey-results-logistic-regression" title="Permalink to this headline">#</a></h3>
</div>
<div class="section" id="infrastructure">
<h3><span class="section-number">7.7.3. </span>Infrastructure<a class="headerlink" href="#infrastructure" title="Permalink to this headline">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">expit</span>
<span class="n">aglu</span> <span class="o">=</span> <span class="n">lusek_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">log_of</span> <span class="o">=</span> <span class="n">to_test</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">log_of</span> <span class="o">=</span> <span class="n">log_of</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">]]</span>
<span class="n">ict</span> <span class="o">=</span> <span class="n">aglu</span><span class="p">[</span><span class="n">aglu</span><span class="o">.</span><span class="n">use</span> <span class="o">==</span> <span class="s2">&quot;infrastructure&quot;</span><span class="p">][[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;scaled&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span>
<span class="n">ict</span> <span class="o">=</span> <span class="n">ict</span><span class="p">[</span><span class="s2">&quot;scaled&quot;</span><span class="p">]</span>
<span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;infrastructure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ict</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>


<span class="n">obj_min</span><span class="p">,</span> <span class="n">obj_max</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">infrastructure</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">log_of</span><span class="o">.</span><span class="n">infrastructure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;failed ~ infrastructure&#39;</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">logit</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">log_of</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">inter</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Intercept&#39;</span><span class="p">]</span>
<span class="n">slope</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;infrastructure&#39;</span><span class="p">]</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">obj_min</span><span class="p">,</span> <span class="n">obj_max</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">.01</span><span class="p">)</span>

<span class="n">log_odds</span> <span class="o">=</span> <span class="n">inter</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">xs</span>
<span class="n">odds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_odds</span><span class="p">)</span>

<span class="n">ps_x</span> <span class="o">=</span> <span class="n">expit</span><span class="p">(</span><span class="n">inter</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">xs</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ps_x</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;infrastructure&quot;</span><span class="p">],</span> <span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Infrastructure&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Percent of land-use&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability of exceeding threshhold&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">.1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/999b23ee2fbe02ce14e65626c5b77f4c9d1590e76f077957950ceed9989141b7.png" src="_images/999b23ee2fbe02ce14e65626c5b77f4c9d1590e76f077957950ceed9989141b7.png" />
</div>
</div>
</div>
<div class="section" id="urbanization">
<h3><span class="section-number">7.7.4. </span>Urbanization<a class="headerlink" href="#urbanization" title="Permalink to this headline">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">log_of</span> <span class="o">=</span> <span class="n">to_test</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">log_of</span> <span class="o">=</span> <span class="n">log_of</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">]]</span>

<span class="n">ict</span> <span class="o">=</span> <span class="n">aglu</span><span class="p">[</span><span class="n">aglu</span><span class="o">.</span><span class="n">use</span> <span class="o">==</span> <span class="s2">&quot;Siedl&quot;</span><span class="p">][[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;scaled&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span>
<span class="n">ict</span> <span class="o">=</span> <span class="n">ict</span><span class="p">[</span><span class="s2">&quot;scaled&quot;</span><span class="p">]</span>
<span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;Siedl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ict</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>

<span class="n">obj_min</span><span class="p">,</span> <span class="n">obj_max</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">Siedl</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">log_of</span><span class="o">.</span><span class="n">Siedl</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;failed ~ Siedl&#39;</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">logit</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">log_of</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">inter</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Intercept&#39;</span><span class="p">]</span>
<span class="n">slope</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Siedl&#39;</span><span class="p">]</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">obj_min</span><span class="p">,</span> <span class="n">obj_max</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">.1</span><span class="p">)</span>

<span class="n">log_odds</span> <span class="o">=</span> <span class="n">inter</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">xs</span>
<span class="n">odds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_odds</span><span class="p">)</span>

<span class="n">ps_x</span> <span class="o">=</span> <span class="n">expit</span><span class="p">(</span><span class="n">inter</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">xs</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ps_x</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;Siedl&quot;</span><span class="p">],</span> <span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Buildings/urban&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Percent of land-use&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability of exceeding threshhold&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">.1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/c167877449f99ba47b00d75d16ac08d2c0208313dddad47858d75b13d3815f6a.png" src="_images/c167877449f99ba47b00d75d16ac08d2c0208313dddad47858d75b13d3815f6a.png" />
</div>
</div>
</div>
<div class="section" id="forest">
<h3><span class="section-number">7.7.5. </span>Forest<a class="headerlink" href="#forest" title="Permalink to this headline">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">log_of</span> <span class="o">=</span> <span class="n">to_test</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">log_of</span> <span class="o">=</span> <span class="n">log_of</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">]]</span>

<span class="n">ict</span> <span class="o">=</span> <span class="n">aglu</span><span class="p">[</span><span class="n">aglu</span><span class="o">.</span><span class="n">use</span> <span class="o">==</span> <span class="s2">&quot;Wald&quot;</span><span class="p">][[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;scaled&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span>
<span class="n">ict</span> <span class="o">=</span> <span class="n">ict</span><span class="p">[</span><span class="s2">&quot;scaled&quot;</span><span class="p">]</span>
<span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;Wald&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ict</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>

<span class="n">obj_min</span><span class="p">,</span> <span class="n">obj_max</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">Wald</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">log_of</span><span class="o">.</span><span class="n">Wald</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;failed ~ Wald&#39;</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">logit</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">log_of</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">inter</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Intercept&#39;</span><span class="p">]</span>
<span class="n">slope</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Wald&#39;</span><span class="p">]</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">obj_min</span><span class="p">,</span> <span class="n">obj_max</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">.1</span><span class="p">)</span>

<span class="n">log_odds</span> <span class="o">=</span> <span class="n">inter</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">xs</span>
<span class="n">odds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_odds</span><span class="p">)</span>

<span class="n">ps_x</span> <span class="o">=</span> <span class="n">expit</span><span class="p">(</span><span class="n">inter</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">xs</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ps_x</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;Wald&quot;</span><span class="p">],</span> <span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Forests/woods&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Percent of land-use&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability of exceeding threshhold&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">.1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/8d77a5983aa46d9201e8c1a69be0a8086aee0fd01f0906b919b50289d9c7d74e.png" src="_images/8d77a5983aa46d9201e8c1a69be0a8086aee0fd01f0906b919b50289d9c7d74e.png" />
</div>
</div>
</div>
<div class="section" id="undefined">
<h3><span class="section-number">7.7.6. </span>Undefined<a class="headerlink" href="#undefined" title="Permalink to this headline">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">log_of</span> <span class="o">=</span> <span class="n">to_test</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">log_of</span> <span class="o">=</span> <span class="n">log_of</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">]]</span>

<span class="n">ict</span> <span class="o">=</span> <span class="n">aglu</span><span class="p">[</span><span class="n">aglu</span><span class="o">.</span><span class="n">use</span> <span class="o">==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">][[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;scaled&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span>
<span class="n">ict</span> <span class="o">=</span> <span class="n">ict</span><span class="p">[</span><span class="s2">&quot;scaled&quot;</span><span class="p">]</span>
<span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;Undefined&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ict</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>

<span class="n">obj_min</span><span class="p">,</span> <span class="n">obj_max</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">Undefined</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">log_of</span><span class="o">.</span><span class="n">Undefined</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;failed ~ Undefined&#39;</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">logit</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">log_of</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">inter</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Intercept&#39;</span><span class="p">]</span>
<span class="n">slope</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Undefined&#39;</span><span class="p">]</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">obj_min</span><span class="p">,</span> <span class="n">obj_max</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">.1</span><span class="p">)</span>

<span class="n">log_odds</span> <span class="o">=</span> <span class="n">inter</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">xs</span>
<span class="n">odds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_odds</span><span class="p">)</span>

<span class="n">ps_x</span> <span class="o">=</span> <span class="n">expit</span><span class="p">(</span><span class="n">inter</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">xs</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ps_x</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;Undefined&quot;</span><span class="p">],</span> <span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Land use not defined in map&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Percent of land-use&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability of exceeding threshhold&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">.1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/1402d84620481b9a08d53fd7a9a2965b5dcdfa30b3aec7173203890b1f0e20f8.png" src="_images/1402d84620481b9a08d53fd7a9a2965b5dcdfa30b3aec7173203890b1f0e20f8.png" />
</div>
</div>
</div>
<div class="section" id="recreation">
<h3><span class="section-number">7.7.7. </span>Recreation<a class="headerlink" href="#recreation" title="Permalink to this headline">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">log_of</span> <span class="o">=</span> <span class="n">to_test</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">log_of</span> <span class="o">=</span> <span class="n">log_of</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">]]</span>

<span class="n">ict</span> <span class="o">=</span> <span class="n">aglu</span><span class="p">[</span><span class="n">aglu</span><span class="o">.</span><span class="n">use</span> <span class="o">==</span> <span class="s2">&quot;recreation&quot;</span><span class="p">][[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;scaled&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span>
<span class="n">ict</span> <span class="o">=</span> <span class="n">ict</span><span class="p">[</span><span class="s2">&quot;scaled&quot;</span><span class="p">]</span>
<span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;recreation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ict</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>

<span class="n">obj_min</span><span class="p">,</span> <span class="n">obj_max</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">recreation</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">log_of</span><span class="o">.</span><span class="n">recreation</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;failed ~ recreation&#39;</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">logit</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">log_of</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">inter</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Intercept&#39;</span><span class="p">]</span>
<span class="n">slope</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;recreation&#39;</span><span class="p">]</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">obj_min</span><span class="p">,</span> <span class="n">obj_max</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">.1</span><span class="p">)</span>

<span class="n">log_odds</span> <span class="o">=</span> <span class="n">inter</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">xs</span>
<span class="n">odds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_odds</span><span class="p">)</span>

<span class="n">ps_x</span> <span class="o">=</span> <span class="n">expit</span><span class="p">(</span><span class="n">inter</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">xs</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ps_x</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;recreation&quot;</span><span class="p">],</span> <span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Recreation/sports/camping&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Kilometers²&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability of exceeding threshhold&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">.1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/288ec5f2b6db4e79b694b350e443d439d11e1d534a6c4532d2ab6c5181b28a28.png" src="_images/288ec5f2b6db4e79b694b350e443d439d11e1d534a6c4532d2ab6c5181b28a28.png" />
</div>
</div>
</div>
<div class="section" id="distance-to-river-intersection">
<h3><span class="section-number">7.7.8. </span>Distance to river intersection<a class="headerlink" href="#distance-to-river-intersection" title="Permalink to this headline">#</a></h3>
<p><em>Currently being edited</em></p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/516bfb88b4d5a7de6fd01b1e791415df088df6d91cd8f00215989d98c19c094f.png" src="_images/516bfb88b4d5a7de6fd01b1e791415df088df6d91cd8f00215989d98c19c094f.png" />
</div>
</div>
</div>
<div class="section" id="length-of-river-intersects">
<h3><span class="section-number">7.7.9. </span>Length of river intersects<a class="headerlink" href="#length-of-river-intersects" title="Permalink to this headline">#</a></h3>
<p><em>Currently being edited</em></p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="_images/b80737177dbd3e1a427d285a3c1dae74542e96c7c3df331c0e9980b177d81517.png" src="_images/b80737177dbd3e1a427d285a3c1dae74542e96c7c3df331c0e9980b177d81517.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">threshhold</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<p>This script updated 30/05/2023 in Biel, CH</p>
<blockquote>
<div><p>❤️ what you do everyday</p>
</div></blockquote>
<p><em>analyst at hammerdirt</em></p>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Git repo: https://github.com/hammerdirt-analyst/landuse.git

Git branch: main

matplotlib : 3.7.1
json       : 2.0.9
IPython    : 8.12.0
statsmodels: 0.13.5
seaborn    : 0.12.2
numpy      : 1.24.2
PIL        : 9.5.0
pandas     : 2.0.0
scipy      : 1.10.1
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="hex-3000-m-rivers.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">6. </span>Rivers: new map data</p>
      </div>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation">7.1. Motivation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#proposition">7.1.1. Proposition</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methods-of-inference">7.2. Methods of inference</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#binomial-distribution">7.2.1. Binomial distribution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#odds-and-log-odds">7.2.2. Odds and log odds</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#variables">7.3. Variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data">7.4. Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#survey-data">7.4.1. Survey data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-land-use-data">7.4.2. The land use data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#aggregating-scaling-and-binning">7.4.2.1. Aggregating, scaling and binning</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-the-threshold-one-object-cigarette-ends">7.5. Testing the threshold one object: cigarette ends</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-frequency-of-exceeding-the-threshold-cigarette-ends">7.5.1. The frequency of exceeding the threshold: cigarette ends</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-probability-of-exceeding-the-threshold-cigarette-ends">7.5.2. The probability of exceeding the threshold: cigarette ends</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-prior">7.5.2.1. The prior</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-a-threshold-survey-area">7.6. Testing a threshold: Survey area</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-chance-of-exceeding-the-threshold-at-each-lake">7.6.1. The chance of exceeding the threshold at each lake</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-chance-of-exceeding-the-threshold-at-each-location-on-a-lake">7.6.2. The chance of exceeding the threshold at each location on a lake</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-lake-that-has-the-highest-probability-of-exceeding-the-threshhold">7.6.2.1. The lake that has the highest probability of exceeding the threshhold</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#details-the-location-that-has-the-highest-probability">7.6.3. Details: the location that has the highest probability</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#effects-of-land-use-how-does-land-use-change-the-probability-of-exceeding-the-threshhold">7.7. Effects of land use: How does land use change the probability of exceeding the threshhold?</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-aare-survey-area">7.7.1. The Aare survey area</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#all-survey-results-logistic-regression">7.7.2. All survey results: Logistic regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#infrastructure">7.7.3. Infrastructure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#urbanization">7.7.4. Urbanization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forest">7.7.5. Forest</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#undefined">7.7.6. Undefined</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#recreation">7.7.7. Recreation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distance-to-river-intersection">7.7.8. Distance to river intersection</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#length-of-river-intersects">7.7.9. Length of river intersects</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Schreyer et all
</p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <p>
   hammerdirt 2023
</p>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>