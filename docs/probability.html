

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>6. Probability and land-use &#8212; Near or far</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'probability';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="5. All Data – New map data" href="hex-3000-m.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="titlepage.html">
  
  
  
  
  
    <p class="title logo__title">Near or far</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="bielersee_results.html">1. Bielersee</a></li>
<li class="toctree-l1"><a class="reference internal" href="lac_leman.html">2. Lac Léman</a></li>
<li class="toctree-l1"><a class="reference internal" href="project_results.html">3. All Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="consider_distance_to_river.html">4. River and lake intersections</a></li>
<li class="toctree-l1"><a class="reference internal" href="hex-3000-m.html">5. All Data – New map data</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">6. Probability and land-use</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/hammerdirt-analyst/landuse" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/hammerdirt-analyst/landuse/issues/new?title=Issue%20on%20page%20%2Fprobability.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Probability and land-use</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation">6.1. Motivation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#proposition">6.1.1. Proposition</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methods-of-inference">6.2. Methods of inference</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#binomial-distribution">6.2.1. Binomial distribution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#odds-and-log-odds">6.2.2. Odds and log odds</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#variables">6.3. Variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data">6.4. Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#survey-data">6.4.1. Survey data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-land-use-data">6.4.2. The land use data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#aggregating-scaling-and-binning">6.4.2.1. Aggregating, scaling and binning</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-the-threshold">6.5. Testing the threshold</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-odds-and-frequency-of-exceeding-the-threshold">6.5.1. The odds and frequency of exceeding the threshold</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-probability-of-exceeding-the-threshold">6.5.2. The probability of exceeding the threshold</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-prior">6.5.2.1. The prior</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#logistic-regression">6.5.3. Logistic regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#infrastructure">6.5.4. Infrastructure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#urbanization">6.5.5. Urbanization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forest">6.5.6. Forest</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#undefined">6.5.7. Undefined</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#recreation">6.5.8. Recreation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distance-to-river-intersection">6.5.9. Distance to river intersection</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#length-of-river-intersects">6.5.10. Length of river intersects</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="tex2jax_ignore mathjax_ignore section" id="probability-and-land-use">
<h1><span class="section-number">6. </span>Probability and land-use<a class="headerlink" href="#probability-and-land-use" title="Permalink to this headline">#</a></h1>
<p><em>draft: need to add definition and method for logistic regression, revising river intersection and lenghts</em></p>
<p>The introduction of a threshhold value for beach-litter density by the EU and the reasons for the application of that threshhold mark a change in the importance and use of beach litter data. Prior to the establishment of a threshold the primary use of beach-litter data was to <em>educate</em> the public and in some instances define a link with mortality and mobidity of marine species. At present beach-litter survey results are also considered on the numerical distance from a stated goal. That goal is defined in <strong>pieces of trash for every 100 m</strong>. The goal is based on principal of precaution, that means we are unsure of the long term consequences and it would be best to minimize exposure if possible.<a class="reference external" href="https://mcc.jrc.ec.europa.eu/main/dev.py?N=41&amp;O=454">EU Threshold Value for Macro Litter on Coastlines</a></p>
<p>With the announcement of threshhold value <strong>there was no subsequent recomendation for changing the methods of sampling</strong>. Consequently, this environmental assessment relies on the recorded observations of volunteers following a standard protocol. According to the journal <a class="reference external" href="https://www.nature.com/articles/s41893-019-0390-3">Nature</a>, programs that include the involvement of citizens in scientific research and/or knowledge production, can complement and ultimately improve the Sustainale Development Goals (SDG) reporting process. Beach litter applies specifically to SDG 14, <strong>the target of achieving substantial reductions in marine pollution</strong>.</p>
<div class="section" id="motivation">
<h2><span class="section-number">6.1. </span>Motivation<a class="headerlink" href="#motivation" title="Permalink to this headline">#</a></h2>
<p>Each encounter is local by definition (the location can be defined by a GPS point) and the time/date is unique for each survey for each person, or group of people doing a survey. Often the people that conduct the survey are beach-users themselves and local to the region. The encounter is the result of the desire of the person to remove these objects from the environment. <strong>That is, the motivation to remove the object was present before the desire to record its existence</strong>.</p>
<div class="section" id="proposition">
<h3><span class="section-number">6.1.1. </span>Proposition<a class="headerlink" href="#proposition" title="Permalink to this headline">#</a></h3>
<ol class="arabic simple">
<li><p>Data from beach litter surveys can be used to estimate survey results at a local level.</p>
<ol class="arabic simple">
<li><p>The municipal level: assisst with local mitigation and reduction efforts</p></li>
<li><p>The method of inference should be adaptable to a a machine learning (ML) process</p></li>
</ol>
</li>
</ol>
<p><strong>assumptions</strong></p>
<ol class="arabic simple">
<li><p>reasonable people are collecting the data</p></li>
<li><p>protocols are followed</p></li>
<li><p>similar environmental conditions produce similar results</p></li>
<li><p>there is high varaibility in survey results</p></li>
<li><p>results represent the minimum number, the maximum is unknown</p></li>
<li><p>samples are independent</p></li>
<li><p>results are local</p></li>
</ol>
<p><strong>Results are local:</strong> This means that events that produce large amounts of trash on the shoreline are possible at all moments. This includes thunderstorms, accidental spills, high-winds, local flood events or any event that includes consumption as a revenue source. It is also possible that a beach litter survey can yield extremely low results. <strong>There is no immediate significance attached to the magnitude of a survey result. Extreme values are expected</strong>.</p>
</div>
</div>
<div class="section" id="methods-of-inference">
<h2><span class="section-number">6.2. </span>Methods of inference<a class="headerlink" href="#methods-of-inference" title="Permalink to this headline">#</a></h2>
<p>The method of data collection asuggests a mathematical method of interpretation and analysis that is appropriate to real systems, can be tested empirically and allows reasonbale people to arrive at reasonable conclusions. Fortunately we don’t need to invent a method, there are several appropriate techniques for arriving at a consensus estimate of a requested metric. (Maxwell, La Place, Bayes, Jaynes, Gelman, Savage).</p>
<div class="section" id="binomial-distribution">
<h3><span class="section-number">6.2.1. </span>Binomial distribution<a class="headerlink" href="#binomial-distribution" title="Permalink to this headline">#</a></h3>
<p>In the previous sections we were concerned with defining the relationship between the land use profile and the density of litter identified. This definition we limited to defining wether or not the quantity or magnitude of a type of land use was montotonic with litter density and if so what was the direction positive or negative. In this section, the question is more detailed and more specific:</p>
<ol class="arabic simple">
<li><p>How likely is a survey result to exceed a value given the land use profile of the survey location ?</p></li>
<li><p><strong>How likely is a survey result to exceed a threshold here and now ?</strong></p>
<ol class="arabic simple">
<li><p>The land use profile is the collection of land use attriutes within a 3’000 m hex with the survey location at the middle.</p></li>
<li><p><strong>Here</strong> can be any location with a land-use profile that would also make an appropriate survey location</p></li>
<li><p><strong>Now</strong> siginifies our expectations at the next survey.</p></li>
</ol>
</li>
</ol>
<p>This metric was introduced in the federal report as the fail-rate: <em>the number of times that at least one of an object was found at a survey</em>, all landuse values were consiered equal. This allowed us to select ojects of interest using frequency as a metric as well as quantity or density. Thus, it is easy to identify objects that are found frequently but not in large quantities. In this form the fail rate is also the most likely estimate (MLE) of the parameter <em>p</em> for the <a class="reference external" href="https://en.wikipedia.org/wiki/Binomial_distribution">binomial distribution</a> that describes the probability of finding at least one of a requested object at a survey. How the fail rate can be used to determine a range of probable values for any object at any location was defined in, <a class="reference external" href="https://hammerdirt-analyst.github.io/finding-one-object/titlepage.html">finding one object</a>, the example was feminine hygiene products.</p>
</div>
<div class="section" id="odds-and-log-odds">
<h3><span class="section-number">6.2.2. </span>Odds and log odds<a class="headerlink" href="#odds-and-log-odds" title="Permalink to this headline">#</a></h3>
<p>The odds of success are defined as the number of times that a test had a positive result v/s the number of times that the results were negative, or <em>k/(n-k)</em>. The probability of success can also be given as an <em>odds ratio:</em> the probability of success divided by the probability of failure or <span class="math notranslate nohighlight">\(\frac{p}{1-p}\)</span>, where <span class="math notranslate nohighlight">\(p\)</span> = the probability of success. Therefore, the log odds are <em>ln(</em><span class="math notranslate nohighlight">\(\frac{p}{1-p}\)</span><em>)</em> or <a class="reference external" href="https://en.wikipedia.org/wiki/Logit">Logit</a>.</p>
<p>The log odds are used in <a class="reference external" href="https://en.wikipedia.org/wiki/Logistic_regression">logistic regression</a>, a commonly used method to model binary variables with multiple independent variables. In the case of beach litter data we are modeling the binary variable: “Did the survey result exceed the threshold?. Commonly used in machine learning models, logistic regression is often part of classification or labeling processes.</p>
</div>
</div>
<div class="section" id="variables">
<h2><span class="section-number">6.3. </span>Variables<a class="headerlink" href="#variables" title="Permalink to this headline">#</a></h2>
<ol class="arabic simple">
<li><p>independent variables: m² of each land use category, m of roads, m of rivers that intersect, m to river intersection point</p></li>
<li><p>outcome variable: binary, wether or not the threshold was exceeded at a survey</p></li>
<li><p>success: the threshold was exceeded = 1 else 0</p></li>
</ol>
<p><strong>We assume that the land-use adjacent to the survey location and magnitudes of local river inputs are predictor varaibles for the amount of trash found on the shore line</strong>.</p>
</div>
<div class="section" id="data">
<h2><span class="section-number">6.4. </span>Data<a class="headerlink" href="#data" title="Permalink to this headline">#</a></h2>
<div class="section" id="survey-data">
<h3><span class="section-number">6.4.1. </span>Survey data<a class="headerlink" href="#survey-data" title="Permalink to this headline">#</a></h3>
<p>The samples from the period 2020-2021 (IQAASL) for the following lakes are considered:</p>
<ul class="simple">
<li><p>Zurichsee</p></li>
<li><p>Bielersee</p></li>
<li><p>Neuenburgersee</p></li>
<li><p>Walensee</p></li>
<li><p>Vierwaldstattersee</p></li>
<li><p>Brienzersee</p></li>
<li><p>Thunersee</p></li>
<li><p>Lac Léman</p></li>
<li><p>Lago Maggiore</p></li>
<li><p>Lago di Lugano</p></li>
<li><p>Zugersee</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> watermark
<span class="c1"># sys, file and nav packages:</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">listdir</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">isfile</span><span class="p">,</span> <span class="n">join</span>
<span class="kn">import</span> <span class="nn">typing</span>

<span class="c1"># math packages:</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">beta</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">binom</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">optimize</span>
<span class="kn">from</span> <span class="nn">statsmodels.distributions.empirical_distribution</span> <span class="kn">import</span> <span class="n">ECDF</span>

<span class="c1"># charting:</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="k">as</span> <span class="nn">mdates</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">ticker</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colors</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span>
<span class="kn">from</span> <span class="nn">matplotlib.gridspec</span> <span class="kn">import</span> <span class="n">GridSpec</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.inset_locator</span> <span class="kn">import</span> <span class="n">inset_axes</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="kn">import</span> <span class="nn">IPython</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span> <span class="k">as</span> <span class="n">PILImage</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Markdown</span> <span class="k">as</span> <span class="n">md</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>

<span class="kn">import</span> <span class="nn">resources.landuse_config</span> <span class="k">as</span> <span class="nn">luse</span>
<span class="kn">import</span> <span class="nn">resources.empiricaldist</span> <span class="k">as</span> <span class="nn">emp</span>

<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">retrieve_locations_by_bin</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">],</span> <span class="n">use</span><span class="o">=</span><span class="s2">&quot;Fels&quot;</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">use</span> <span class="o">==</span> <span class="n">use</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">count_nk_bin</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">locations</span><span class="p">,</span> <span class="n">agg</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;k&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span><span class="s2">&quot;n&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;n-k&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">}):</span>
    
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">locations</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">collect_bin_data</span><span class="p">(</span><span class="n">tested</span><span class="p">,</span> <span class="n">xtest</span><span class="p">):</span>
    <span class="n">use</span> <span class="o">=</span> <span class="n">xtest</span><span class="o">.</span><span class="n">use</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">binned</span> <span class="o">=</span> <span class="n">xtest</span><span class="o">.</span><span class="n">binned</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">locations</span> <span class="o">=</span> <span class="n">xtest</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">values</span>
    
    <span class="n">bins</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">anarray</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">locations</span><span class="p">):</span>
        
        <span class="n">a_count</span> <span class="o">=</span> <span class="n">count_nk_bin</span><span class="p">(</span><span class="n">tested</span><span class="p">,</span> <span class="n">anarray</span><span class="p">)</span>
        <span class="n">a_count</span><span class="p">[</span><span class="s2">&quot;use&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">use</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">a_count</span><span class="p">[</span><span class="s2">&quot;binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">binned</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">bins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a_count</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bins</span>

<span class="k">def</span> <span class="nf">n_and_k_for_a_set_of_landuse_data</span><span class="p">(</span><span class="n">tested</span><span class="p">,</span> <span class="n">binned_land_use_data</span><span class="p">):</span>
    
    <span class="n">binned</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">use</span> <span class="ow">in</span> <span class="n">binned_land_use_data</span><span class="o">.</span><span class="n">use</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
        <span class="n">locations_by_bin</span> <span class="o">=</span> <span class="n">retrieve_locations_by_bin</span><span class="p">(</span><span class="n">binned_land_use_data</span><span class="p">,</span> <span class="n">use</span><span class="o">=</span><span class="n">use</span><span class="p">)</span>
        <span class="n">bin_totals</span> <span class="o">=</span> <span class="n">collect_bin_data</span><span class="p">(</span><span class="n">tested</span><span class="p">,</span> <span class="n">locations_by_bin</span><span class="p">)</span>
        
        <span class="n">binned</span> <span class="o">+=</span> <span class="n">bin_totals</span>
        
        
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">binned</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;k&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span><span class="s2">&quot;n&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;n-k&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="c1"># scaled prior</span>



<span class="c1"># survey data:</span>
<span class="n">dfBeaches</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/beaches.csv&quot;</span><span class="p">)</span>
<span class="n">dfCodes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/codes_with_group_names_2015.csv&quot;</span><span class="p">)</span>

<span class="c1"># set the index of the beach data to location slug</span>
<span class="n">dfBeaches</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># set the index of to codes</span>
<span class="n">dfCodes</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># code description map</span>
<span class="n">code_d_map</span> <span class="o">=</span> <span class="n">dfCodes</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># shorten the descriptions of two codes</span>
<span class="n">code_d_map</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;G38&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sheeting for protecting large cargo items&quot;</span>
<span class="n">code_d_map</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;G73&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Foamed items &amp; pieces (non packaging/insulation)&quot;</span>

<span class="c1"># code material map</span>
<span class="n">code_m_map</span> <span class="o">=</span> <span class="n">dfCodes</span><span class="o">.</span><span class="n">material</span>

<span class="c1"># this defines the css rules for the note-book table displays</span>
<span class="n">header_row</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;th:nth-child(1)&#39;</span><span class="p">,</span> <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;background-color: #FFF; text-align:right&#39;</span><span class="p">}</span>
<span class="n">even_rows</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;selector&quot;</span><span class="p">:</span> <span class="s1">&#39;tr:nth-child(even)&#39;</span><span class="p">,</span> <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;background-color: rgba(139, 69, 19, 0.08);&#39;</span><span class="p">}</span>
<span class="n">odd_rows</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;tr:nth-child(odd)&#39;</span><span class="p">,</span> <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="s1">&#39;background: #FFF;&#39;</span><span class="p">}</span>
<span class="n">table_font</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;tr&#39;</span><span class="p">,</span> <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="s1">&#39;font-size: 12px;&#39;</span><span class="p">}</span>
<span class="n">table_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="s1">&#39;padding: 6px;&#39;</span><span class="p">}</span>
<span class="n">table_css_styles</span> <span class="o">=</span> <span class="p">[</span><span class="n">even_rows</span><span class="p">,</span> <span class="n">odd_rows</span><span class="p">,</span> <span class="n">table_font</span><span class="p">,</span> <span class="n">header_row</span><span class="p">]</span>

<span class="n">pdtype</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>
<span class="n">pstype</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">diverging_palette</span><span class="p">(</span><span class="mi">230</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;resources/surveys_iqaasl.csv&#39;</span><span class="p">)</span>

<span class="c1"># the lakes of interest</span>
<span class="c1"># collection points would be a good</span>
<span class="c1"># label. This is how they are considered in the model</span>
<span class="c1"># these locations serve as the endpoint for many </span>
<span class="c1"># small rivers</span>
<span class="n">collection_points</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;zurichsee&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bielersee&#39;</span><span class="p">,</span>
    <span class="s1">&#39;neuenburgersee&#39;</span><span class="p">,</span>
    <span class="s1">&#39;walensee&#39;</span><span class="p">,</span>
    <span class="s1">&#39;vierwaldstattersee&#39;</span><span class="p">,</span>
    <span class="s1">&#39;brienzersee&#39;</span><span class="p">,</span>
    <span class="s1">&#39;thunersee&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lac-leman&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lago-maggiore&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lago-di-lugano&#39;</span><span class="p">,</span>
    <span class="s1">&#39;zugersee&#39;</span>
<span class="p">]</span>

<span class="c1"># the data-frame of survey results to be considered</span>
<span class="n">features_of_interest</span> <span class="o">=</span> <span class="n">collection_points</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">features_of_interest</span><span class="p">)]</span>

<span class="c1"># map the location to the name of the lake</span>
<span class="n">wn_map</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;feature&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span>
<span class="n">wn_map</span> <span class="o">=</span> <span class="n">wn_map</span><span class="p">[</span><span class="s2">&quot;feature&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_222d3 tr:nth-child(even) {
  background-color: rgba(139, 69, 19, 0.08);
}
#T_222d3 tr:nth-child(odd) {
  background: #FFF;
}
#T_222d3 tr {
  font-size: 12px;
}
#T_222d3 th:nth-child(1) {
  background-color: #FFF;
  text-align: right;
}
</style>
<table id="T_222d3">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_222d3_level0_col0" class="col_heading level0 col0" >0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_222d3_level0_row0" class="row_heading level0 row0" >n locations</th>
      <td id="T_222d3_row0_col0" class="data row0 col0" >93</td>
    </tr>
    <tr>
      <th id="T_222d3_level0_row1" class="row_heading level0 row1" >n samples</th>
      <td id="T_222d3_row1_col0" class="data row1 col0" >331</td>
    </tr>
    <tr>
      <th id="T_222d3_level0_row2" class="row_heading level0 row2" >n lake samples</th>
      <td id="T_222d3_row2_col0" class="data row2 col0" >331</td>
    </tr>
    <tr>
      <th id="T_222d3_level0_row3" class="row_heading level0 row3" >n identified object types</th>
      <td id="T_222d3_row3_col0" class="data row3 col0" >205</td>
    </tr>
    <tr>
      <th id="T_222d3_level0_row4" class="row_heading level0 row4" >n possible object types</th>
      <td id="T_222d3_row4_col0" class="data row4 col0" >230</td>
    </tr>
    <tr>
      <th id="T_222d3_level0_row5" class="row_heading level0 row5" >total number of objects</th>
      <td id="T_222d3_row5_col0" class="data row5 col0" >52269</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Each row of the survey data accounts for the quantity identified of a particular group of objects at a location on a given date. For example, there are 230 entries for each survey, representing the 230 possible groups an item can be placed in. Objects that were not identified are given the default quantity of zero. The unique indentifier for a survey is the combination of location and date (loc_date). For example consider the survey results from mullermatte on March 31, 2021:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_765cf tr:nth-child(even) {
  background-color: rgba(139, 69, 19, 0.08);
}
#T_765cf tr:nth-child(odd) {
  background: #FFF;
}
#T_765cf tr {
  font-size: 12px;
}
#T_765cf th:nth-child(1) {
  background-color: #FFF;
  text-align: right;
}
</style>
<table id="T_765cf">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_765cf_level0_col0" class="col_heading level0 col0" >loc_date</th>
      <th id="T_765cf_level0_col1" class="col_heading level0 col1" >date</th>
      <th id="T_765cf_level0_col2" class="col_heading level0 col2" >location</th>
      <th id="T_765cf_level0_col3" class="col_heading level0 col3" >river_bassin</th>
      <th id="T_765cf_level0_col4" class="col_heading level0 col4" >feature</th>
      <th id="T_765cf_level0_col5" class="col_heading level0 col5" >city</th>
      <th id="T_765cf_level0_col6" class="col_heading level0 col6" >code</th>
      <th id="T_765cf_level0_col7" class="col_heading level0 col7" >pcs_m</th>
      <th id="T_765cf_level0_col8" class="col_heading level0 col8" >quantity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_765cf_level0_row0" class="row_heading level0 row0" >3013</th>
      <td id="T_765cf_row0_col0" class="data row0 col0" >('mullermatte', '2021-03-31')</td>
      <td id="T_765cf_row0_col1" class="data row0 col1" >2021-03-31</td>
      <td id="T_765cf_row0_col2" class="data row0 col2" >mullermatte</td>
      <td id="T_765cf_row0_col3" class="data row0 col3" >aare</td>
      <td id="T_765cf_row0_col4" class="data row0 col4" >bielersee</td>
      <td id="T_765cf_row0_col5" class="data row0 col5" >Biel/Bienne</td>
      <td id="T_765cf_row0_col6" class="data row0 col6" >G167</td>
      <td id="T_765cf_row0_col7" class="data row0 col7" >0.070000</td>
      <td id="T_765cf_row0_col8" class="data row0 col8" >3</td>
    </tr>
    <tr>
      <th id="T_765cf_level0_row1" class="row_heading level0 row1" >3014</th>
      <td id="T_765cf_row1_col0" class="data row1 col0" >('mullermatte', '2021-03-31')</td>
      <td id="T_765cf_row1_col1" class="data row1 col1" >2021-03-31</td>
      <td id="T_765cf_row1_col2" class="data row1 col2" >mullermatte</td>
      <td id="T_765cf_row1_col3" class="data row1 col3" >aare</td>
      <td id="T_765cf_row1_col4" class="data row1 col4" >bielersee</td>
      <td id="T_765cf_row1_col5" class="data row1 col5" >Biel/Bienne</td>
      <td id="T_765cf_row1_col6" class="data row1 col6" >G31</td>
      <td id="T_765cf_row1_col7" class="data row1 col7" >0.020000</td>
      <td id="T_765cf_row1_col8" class="data row1 col8" >1</td>
    </tr>
    <tr>
      <th id="T_765cf_level0_row2" class="row_heading level0 row2" >3015</th>
      <td id="T_765cf_row2_col0" class="data row2 col0" >('mullermatte', '2021-03-31')</td>
      <td id="T_765cf_row2_col1" class="data row2 col1" >2021-03-31</td>
      <td id="T_765cf_row2_col2" class="data row2 col2" >mullermatte</td>
      <td id="T_765cf_row2_col3" class="data row2 col3" >aare</td>
      <td id="T_765cf_row2_col4" class="data row2 col4" >bielersee</td>
      <td id="T_765cf_row2_col5" class="data row2 col5" >Biel/Bienne</td>
      <td id="T_765cf_row2_col6" class="data row2 col6" >G100</td>
      <td id="T_765cf_row2_col7" class="data row2 col7" >0.020000</td>
      <td id="T_765cf_row2_col8" class="data row2 col8" >1</td>
    </tr>
    <tr>
      <th id="T_765cf_level0_row3" class="row_heading level0 row3" >3016</th>
      <td id="T_765cf_row3_col0" class="data row3 col0" >('mullermatte', '2021-03-31')</td>
      <td id="T_765cf_row3_col1" class="data row3 col1" >2021-03-31</td>
      <td id="T_765cf_row3_col2" class="data row3 col2" >mullermatte</td>
      <td id="T_765cf_row3_col3" class="data row3 col3" >aare</td>
      <td id="T_765cf_row3_col4" class="data row3 col4" >bielersee</td>
      <td id="T_765cf_row3_col5" class="data row3 col5" >Biel/Bienne</td>
      <td id="T_765cf_row3_col6" class="data row3 col6" >G177</td>
      <td id="T_765cf_row3_col7" class="data row3 col7" >0.120000</td>
      <td id="T_765cf_row3_col8" class="data row3 col8" >5</td>
    </tr>
    <tr>
      <th id="T_765cf_level0_row4" class="row_heading level0 row4" >3017</th>
      <td id="T_765cf_row4_col0" class="data row4 col0" >('mullermatte', '2021-03-31')</td>
      <td id="T_765cf_row4_col1" class="data row4 col1" >2021-03-31</td>
      <td id="T_765cf_row4_col2" class="data row4 col2" >mullermatte</td>
      <td id="T_765cf_row4_col3" class="data row4 col3" >aare</td>
      <td id="T_765cf_row4_col4" class="data row4 col4" >bielersee</td>
      <td id="T_765cf_row4_col5" class="data row4 col5" >Biel/Bienne</td>
      <td id="T_765cf_row4_col6" class="data row4 col6" >G35</td>
      <td id="T_765cf_row4_col7" class="data row4 col7" >0.020000</td>
      <td id="T_765cf_row4_col8" class="data row4 col8" >1</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="the-land-use-data">
<h3><span class="section-number">6.4.2. </span>The land use data<a class="headerlink" href="#the-land-use-data" title="Permalink to this headline">#</a></h3>
<p>How the land use is extracted from the map layers and schematic was demonstrated in the sections New Map data and River and Lake intersections.</p>
<div class="section" id="aggregating-scaling-and-binning">
<h4><span class="section-number">6.4.2.1. </span>Aggregating, scaling and binning<a class="headerlink" href="#aggregating-scaling-and-binning" title="Permalink to this headline">#</a></h4>
<p><strong>Aggregating the land use values:</strong> For land-cover objects the surface area of the polygon that defines each land use attribute that is bounded by the location hexagon is summed. For example their may be two different polygons that represent forest utilization within a hex, the sum of the two polygons is returned. Land cover objects include:</p>
<ol class="arabic simple">
<li><p>Buildings</p></li>
<li><p>Woods</p></li>
<li><p>Orchards</p></li>
<li><p>Wetlands</p></li>
<li><p>City center</p></li>
<li><p>Cliffs</p></li>
<li><p>Vineyards</p></li>
<li><p>Undefined</p></li>
</ol>
<p>Land-use objects concern much smaller portions of the hex and represent specific land-use cases such as schools, hospitals or camping grounds. They have been aggregated in two categories for each hex:</p>
<ol class="arabic simple">
<li><p>Recreation</p></li>
<li><p>Infrastructure</p></li>
</ol>
<p><strong>Scaling the land use values:</strong> The land-use and land-cover objects are scaled according to the proportion of the amount of land in the hex that is not covered by water.</p>
<p><strong>Binning the land use values:</strong> The scaled values were binned by quantile (.05) from zero to one. In other words there are twenty bins that group the land use and land cover values. Consider the land-use for Mullermatte below. The surface area 2’362’780 m² or 2.4 km². Scaled it is .51 or around the 50th percentile of all locations. It is in bin 11, this can be used to find other locations that have similar land-use values for city (next table).</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># these are the land use values for each hex</span>
<span class="c1"># nutuzungsareal and freizeit areal are totaled</span>
<span class="c1"># the surface area of these two use cases gets added</span>
<span class="c1"># to the total of the land cover surface area</span>
<span class="n">dfln</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/hex-3000m-cleaned/lake-locations-nutuzungsareal.csv&quot;</span><span class="p">)</span>
<span class="n">dflf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/hex-3000m-cleaned/lake-locations-freizeitareal.csv&quot;</span><span class="p">)</span>

<span class="c1"># rename the columns and total the surface are for each component</span>
<span class="n">dflf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;OBJEKTART&quot;</span><span class="p">:</span><span class="s2">&quot;use&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dflf</span> <span class="o">=</span> <span class="n">dflf</span><span class="p">[</span><span class="o">~</span><span class="n">dflf</span><span class="o">.</span><span class="n">use</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;Reben&#39;</span><span class="p">,</span> <span class="s1">&#39;Obstanlage&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">dflf_t</span> <span class="o">=</span> <span class="n">dflf</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;river_bass&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;feature&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">dflf_t</span><span class="p">[</span><span class="s2">&quot;use&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;recreation&quot;</span>

<span class="n">dfln</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;OBJEKTART&quot;</span><span class="p">:</span><span class="s2">&quot;use&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">dfln</span> <span class="o">=</span> <span class="n">dfln</span><span class="p">[</span><span class="o">~</span><span class="n">dfln</span><span class="o">.</span><span class="n">use</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;Reben&#39;</span><span class="p">,</span> <span class="s1">&#39;Obstanlage&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">dfln_t</span> <span class="o">=</span> <span class="n">dfln</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;river_bass&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;feature&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">dfln_t</span><span class="p">[</span><span class="s2">&quot;use&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;infrastructure&quot;</span>

<span class="c1"># combine the data frames</span>
<span class="n">rec_inf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dfln_t</span><span class="p">,</span> <span class="n">dflf_t</span><span class="p">])</span>
<span class="n">rec_inf</span> <span class="o">=</span> <span class="n">rec_inf</span><span class="p">[</span><span class="n">rec_inf</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">locations</span><span class="p">)]</span>

<span class="c1"># this is the land cover, the total surface area of the hex is accounted for here</span>
<span class="c1"># this includes the surface area of the lake within the hex</span>
<span class="c1"># there are portions of the map layer that have no land-use attribute</span>
<span class="c1"># to account for this, the total surface area of all labeled sections is </span>
<span class="c1"># substracted from the area of a hex 5845672 m². This attribute is labled </span>
<span class="c1"># undefined</span>
<span class="n">dflc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;resources/hex-3000m-cleaned/lake-locations-landcover.csv&quot;</span><span class="p">)</span>

<span class="c1"># sum the unique land cover values for each location</span>
<span class="n">area_of_a_hex</span> <span class="o">=</span> <span class="mi">5845672</span>
<span class="n">xgr</span> <span class="o">=</span> <span class="n">dflc</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;river_bass&quot;</span><span class="p">,</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="s2">&quot;OBJVAL&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># the sum of all the land cover values for a location</span>
<span class="n">xgrt</span> <span class="o">=</span> <span class="n">xgr</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;river_bass&quot;</span><span class="p">,</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="s2">&quot;feature&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># the amount of surface area that is not accounted for </span>
<span class="n">xgrt</span><span class="p">[</span><span class="s2">&quot;undefined&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">area_of_a_hex</span> <span class="o">-</span> <span class="n">xgrt</span><span class="o">.</span><span class="n">surface</span>

<span class="c1"># format data frame to join to the other land cover totals</span>
<span class="n">xgrt</span><span class="p">[</span><span class="s2">&quot;OBJVAL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;undefined&quot;</span>
<span class="n">xgrt</span><span class="p">[</span><span class="s2">&quot;surface&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xgrt</span><span class="p">[</span><span class="s2">&quot;undefined&quot;</span><span class="p">]</span>
<span class="n">xgrt</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;undefined&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># add to other totals</span>
<span class="n">dflcx</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">xgr</span><span class="p">,</span> <span class="n">xgrt</span><span class="p">])</span>

<span class="c1"># remove the value of See from the surface area of a hex.</span>
<span class="c1"># We are considering the magnitude of land use type in relation</span>
<span class="c1"># to the amount of land that is available to be used, not including </span>
<span class="c1"># amount of land that is covered by the lake itself</span>
<span class="n">xsee</span> <span class="o">=</span> <span class="n">xgr</span><span class="p">[</span><span class="n">xgr</span><span class="o">.</span><span class="n">OBJVAL</span> <span class="o">==</span> <span class="s2">&quot;See&quot;</span><span class="p">][[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;surface&quot;</span><span class="p">]]</span>
<span class="n">xsee</span><span class="p">[</span><span class="s2">&quot;hex minus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">area_of_a_hex</span> <span class="o">-</span> <span class="n">xsee</span><span class="o">.</span><span class="n">surface</span>
<span class="n">hex_minus</span> <span class="o">=</span> <span class="n">xsee</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;hex minus&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># map the adjusted surface area to to the land use</span>
<span class="c1"># totals and scale the surface column to the adjusted surface area</span>
<span class="n">dflcx</span><span class="p">[</span><span class="s2">&quot;hex minus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dflcx</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">hex_minus</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;hex minus&quot;</span><span class="p">])</span>
<span class="c1"># change column name</span>
<span class="n">dflcx</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;OBJVAL&quot;</span><span class="p">:</span><span class="s2">&quot;use&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># add the land use attributes to the land-cover data</span>
<span class="n">rec_inf</span><span class="p">[</span><span class="s2">&quot;hex minus&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec_inf</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">hex_minus</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="s2">&quot;hex minus&quot;</span><span class="p">])</span>

<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;river_bass&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="s2">&quot;surface&quot;</span><span class="p">,</span> <span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="s2">&quot;hex minus&quot;</span><span class="p">]</span>

<span class="n">agg_land_use</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dflcx</span><span class="p">[</span><span class="n">columns</span><span class="p">],</span> <span class="n">rec_inf</span><span class="p">[</span><span class="n">columns</span><span class="p">]])</span>

<span class="n">agg_land_use</span><span class="p">[</span><span class="s2">&quot;scaled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">agg_land_use</span><span class="o">.</span><span class="n">surface</span><span class="o">/</span><span class="n">agg_land_use</span><span class="p">[</span><span class="s2">&quot;hex minus&quot;</span><span class="p">]</span>

<span class="c1"># remove See from the data frame</span>
<span class="n">agg_land_use</span> <span class="o">=</span> <span class="n">agg_land_use</span><span class="p">[</span><span class="n">agg_land_use</span><span class="o">.</span><span class="n">use</span> <span class="o">!=</span> <span class="s2">&quot;See&quot;</span><span class="p">]</span>

<span class="n">bind</span> <span class="o">=</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">IntervalIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">([(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.00000001</span><span class="p">,</span> <span class="mf">.049999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.05000</span><span class="p">,</span> <span class="mf">.099999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.10000</span><span class="p">,</span> <span class="mf">.149999</span><span class="p">),(</span><span class="mf">.15000</span><span class="p">,</span> <span class="mf">.199999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.2</span><span class="p">,</span> <span class="mf">.2499</span><span class="p">),</span> <span class="p">(</span><span class="mf">.25</span><span class="p">,</span> <span class="mf">.2999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.3000</span><span class="p">,</span> <span class="mf">.3499</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">.35</span><span class="p">,</span> <span class="mf">.3999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.4000</span><span class="p">,</span> <span class="mf">.449999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.45</span><span class="p">,</span> <span class="mf">.499999</span><span class="p">),(</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">.549999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.55</span><span class="p">,</span> <span class="mf">.5999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.6000</span><span class="p">,</span> <span class="mf">.6499</span><span class="p">),</span> <span class="p">(</span><span class="mf">.65</span><span class="p">,</span> <span class="mf">.6999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.7</span><span class="p">,</span> <span class="mf">.7499</span><span class="p">),</span> <span class="p">(</span><span class="mf">.75</span><span class="p">,</span> <span class="mf">.7999</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">.8</span><span class="p">,</span> <span class="mf">.8499</span><span class="p">),</span> <span class="p">(</span><span class="mf">.85</span><span class="p">,</span> <span class="mf">.8999</span><span class="p">),</span> <span class="p">(</span><span class="mf">.9</span><span class="p">,</span> <span class="mf">.9499</span><span class="p">),</span> <span class="p">(</span><span class="mf">.95</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>

<span class="c1"># bin the scaled column</span>

<span class="n">sbins</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">agg_land_use</span><span class="o">.</span><span class="n">scaled</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bind</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">21</span><span class="p">),</span> <span class="n">include_lowest</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">retbins</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">sbins</span><span class="o">=</span><span class="n">sbins</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">rename_categories</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">21</span><span class="p">))</span>

<span class="n">agg_land_use</span><span class="p">[</span><span class="s2">&quot;binned&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sbins</span>

<span class="n">aglu</span> <span class="o">=</span> <span class="n">agg_land_use</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">aglu</span> <span class="o">=</span> <span class="n">aglu</span><span class="p">[</span><span class="n">aglu</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">unique</span><span class="p">())]</span>
<span class="n">sample_data</span> <span class="o">=</span> <span class="n">aglu</span><span class="p">[</span><span class="n">aglu</span><span class="o">.</span><span class="n">location</span> <span class="o">==</span> <span class="n">beach</span><span class="p">][[</span><span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="s2">&quot;river_bass&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="s2">&quot;hex minus&quot;</span><span class="p">,</span> <span class="s2">&quot;surface&quot;</span><span class="p">,</span> <span class="s2">&quot;scaled&quot;</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="n">drop</span> <span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sample_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">sample_data</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">set_table_styles</span><span class="p">(</span><span class="n">table_css_styles</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_f3988 tr:nth-child(even) {
  background-color: rgba(139, 69, 19, 0.08);
}
#T_f3988 tr:nth-child(odd) {
  background: #FFF;
}
#T_f3988 tr {
  font-size: 12px;
}
#T_f3988 th:nth-child(1) {
  background-color: #FFF;
  text-align: right;
}
</style>
<table id="T_f3988">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_f3988_level0_col0" class="col_heading level0 col0" >river_bass</th>
      <th id="T_f3988_level0_col1" class="col_heading level0 col1" >location</th>
      <th id="T_f3988_level0_col2" class="col_heading level0 col2" >city</th>
      <th id="T_f3988_level0_col3" class="col_heading level0 col3" >feature</th>
      <th id="T_f3988_level0_col4" class="col_heading level0 col4" >hex minus</th>
      <th id="T_f3988_level0_col5" class="col_heading level0 col5" >surface</th>
      <th id="T_f3988_level0_col6" class="col_heading level0 col6" >scaled</th>
      <th id="T_f3988_level0_col7" class="col_heading level0 col7" >binned</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_f3988_level0_row0" class="row_heading level0 row0" >Siedl</th>
      <td id="T_f3988_row0_col0" class="data row0 col0" >aare</td>
      <td id="T_f3988_row0_col1" class="data row0 col1" >mullermatte</td>
      <td id="T_f3988_row0_col2" class="data row0 col2" >Biel/Bienne</td>
      <td id="T_f3988_row0_col3" class="data row0 col3" >bielersee</td>
      <td id="T_f3988_row0_col4" class="data row0 col4" >4602265</td>
      <td id="T_f3988_row0_col5" class="data row0 col5" >2362780</td>
      <td id="T_f3988_row0_col6" class="data row0 col6" >0.513395</td>
      <td id="T_f3988_row0_col7" class="data row0 col7" >11</td>
    </tr>
    <tr>
      <th id="T_f3988_level0_row1" class="row_heading level0 row1" >Stadtzentr</th>
      <td id="T_f3988_row1_col0" class="data row1 col0" >aare</td>
      <td id="T_f3988_row1_col1" class="data row1 col1" >mullermatte</td>
      <td id="T_f3988_row1_col2" class="data row1 col2" >Biel/Bienne</td>
      <td id="T_f3988_row1_col3" class="data row1 col3" >bielersee</td>
      <td id="T_f3988_row1_col4" class="data row1 col4" >4602265</td>
      <td id="T_f3988_row1_col5" class="data row1 col5" >34237</td>
      <td id="T_f3988_row1_col6" class="data row1 col6" >0.007439</td>
      <td id="T_f3988_row1_col7" class="data row1 col7" >1</td>
    </tr>
    <tr>
      <th id="T_f3988_level0_row2" class="row_heading level0 row2" >Wald</th>
      <td id="T_f3988_row2_col0" class="data row2 col0" >aare</td>
      <td id="T_f3988_row2_col1" class="data row2 col1" >mullermatte</td>
      <td id="T_f3988_row2_col2" class="data row2 col2" >Biel/Bienne</td>
      <td id="T_f3988_row2_col3" class="data row2 col3" >bielersee</td>
      <td id="T_f3988_row2_col4" class="data row2 col4" >4602265</td>
      <td id="T_f3988_row2_col5" class="data row2 col5" >1928607</td>
      <td id="T_f3988_row2_col6" class="data row2 col6" >0.419056</td>
      <td id="T_f3988_row2_col7" class="data row2 col7" >9</td>
    </tr>
    <tr>
      <th id="T_f3988_level0_row3" class="row_heading level0 row3" >Fels</th>
      <td id="T_f3988_row3_col0" class="data row3 col0" >aare</td>
      <td id="T_f3988_row3_col1" class="data row3 col1" >mullermatte</td>
      <td id="T_f3988_row3_col2" class="data row3 col2" >Biel/Bienne</td>
      <td id="T_f3988_row3_col3" class="data row3 col3" >bielersee</td>
      <td id="T_f3988_row3_col4" class="data row3 col4" >4602265</td>
      <td id="T_f3988_row3_col5" class="data row3 col5" >0</td>
      <td id="T_f3988_row3_col6" class="data row3 col6" >0.000000</td>
      <td id="T_f3988_row3_col7" class="data row3 col7" >0</td>
    </tr>
    <tr>
      <th id="T_f3988_level0_row4" class="row_heading level0 row4" >Obstanlage</th>
      <td id="T_f3988_row4_col0" class="data row4 col0" >aare</td>
      <td id="T_f3988_row4_col1" class="data row4 col1" >mullermatte</td>
      <td id="T_f3988_row4_col2" class="data row4 col2" >Biel/Bienne</td>
      <td id="T_f3988_row4_col3" class="data row4 col3" >bielersee</td>
      <td id="T_f3988_row4_col4" class="data row4 col4" >4602265</td>
      <td id="T_f3988_row4_col5" class="data row4 col5" >0</td>
      <td id="T_f3988_row4_col6" class="data row4 col6" >0.000000</td>
      <td id="T_f3988_row4_col7" class="data row4 col7" >0</td>
    </tr>
    <tr>
      <th id="T_f3988_level0_row5" class="row_heading level0 row5" >Reben</th>
      <td id="T_f3988_row5_col0" class="data row5 col0" >aare</td>
      <td id="T_f3988_row5_col1" class="data row5 col1" >mullermatte</td>
      <td id="T_f3988_row5_col2" class="data row5 col2" >Biel/Bienne</td>
      <td id="T_f3988_row5_col3" class="data row5 col3" >bielersee</td>
      <td id="T_f3988_row5_col4" class="data row5 col4" >4602265</td>
      <td id="T_f3988_row5_col5" class="data row5 col5" >0</td>
      <td id="T_f3988_row5_col6" class="data row5 col6" >0.000000</td>
      <td id="T_f3988_row5_col7" class="data row5 col7" >0</td>
    </tr>
    <tr>
      <th id="T_f3988_level0_row6" class="row_heading level0 row6" >Sumpf</th>
      <td id="T_f3988_row6_col0" class="data row6 col0" >aare</td>
      <td id="T_f3988_row6_col1" class="data row6 col1" >mullermatte</td>
      <td id="T_f3988_row6_col2" class="data row6 col2" >Biel/Bienne</td>
      <td id="T_f3988_row6_col3" class="data row6 col3" >bielersee</td>
      <td id="T_f3988_row6_col4" class="data row6 col4" >4602265</td>
      <td id="T_f3988_row6_col5" class="data row6 col5" >0</td>
      <td id="T_f3988_row6_col6" class="data row6 col6" >0.000000</td>
      <td id="T_f3988_row6_col7" class="data row6 col7" >0</td>
    </tr>
    <tr>
      <th id="T_f3988_level0_row7" class="row_heading level0 row7" >undefined</th>
      <td id="T_f3988_row7_col0" class="data row7 col0" >aare</td>
      <td id="T_f3988_row7_col1" class="data row7 col1" >mullermatte</td>
      <td id="T_f3988_row7_col2" class="data row7 col2" >Biel/Bienne</td>
      <td id="T_f3988_row7_col3" class="data row7 col3" >bielersee</td>
      <td id="T_f3988_row7_col4" class="data row7 col4" >4602265</td>
      <td id="T_f3988_row7_col5" class="data row7 col5" >276641</td>
      <td id="T_f3988_row7_col6" class="data row7 col6" >0.060110</td>
      <td id="T_f3988_row7_col7" class="data row7 col7" >2</td>
    </tr>
    <tr>
      <th id="T_f3988_level0_row8" class="row_heading level0 row8" >infrastructure</th>
      <td id="T_f3988_row8_col0" class="data row8 col0" >aare</td>
      <td id="T_f3988_row8_col1" class="data row8 col1" >mullermatte</td>
      <td id="T_f3988_row8_col2" class="data row8 col2" >Biel/Bienne</td>
      <td id="T_f3988_row8_col3" class="data row8 col3" >bielersee</td>
      <td id="T_f3988_row8_col4" class="data row8 col4" >4602265</td>
      <td id="T_f3988_row8_col5" class="data row8 col5" >186185</td>
      <td id="T_f3988_row8_col6" class="data row8 col6" >0.040455</td>
      <td id="T_f3988_row8_col7" class="data row8 col7" >1</td>
    </tr>
    <tr>
      <th id="T_f3988_level0_row9" class="row_heading level0 row9" >recreation</th>
      <td id="T_f3988_row9_col0" class="data row9 col0" >aare</td>
      <td id="T_f3988_row9_col1" class="data row9 col1" >mullermatte</td>
      <td id="T_f3988_row9_col2" class="data row9 col2" >Biel/Bienne</td>
      <td id="T_f3988_row9_col3" class="data row9 col3" >bielersee</td>
      <td id="T_f3988_row9_col4" class="data row9 col4" >4602265</td>
      <td id="T_f3988_row9_col5" class="data row9 col5" >138729</td>
      <td id="T_f3988_row9_col6" class="data row9 col6" >0.030144</td>
      <td id="T_f3988_row9_col7" class="data row9 col7" >1</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p><em>Survey locations that have similar amounts of <strong>Urban</strong> land use within location hex</em></p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_e6569 tr:nth-child(even) {
  background-color: rgba(139, 69, 19, 0.08);
}
#T_e6569 tr:nth-child(odd) {
  background: #FFF;
}
#T_e6569 tr {
  font-size: 12px;
}
#T_e6569 th:nth-child(1) {
  background-color: #FFF;
  text-align: right;
}
</style>
<table id="T_e6569">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_e6569_level0_col0" class="col_heading level0 col0" >location</th>
      <th id="T_e6569_level0_col1" class="col_heading level0 col1" >river_bass</th>
      <th id="T_e6569_level0_col2" class="col_heading level0 col2" >city</th>
      <th id="T_e6569_level0_col3" class="col_heading level0 col3" >feature</th>
      <th id="T_e6569_level0_col4" class="col_heading level0 col4" >surface</th>
      <th id="T_e6569_level0_col5" class="col_heading level0 col5" >use</th>
      <th id="T_e6569_level0_col6" class="col_heading level0 col6" >hex minus</th>
      <th id="T_e6569_level0_col7" class="col_heading level0 col7" >scaled</th>
      <th id="T_e6569_level0_col8" class="col_heading level0 col8" >binned</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_e6569_level0_row0" class="row_heading level0 row0" >593</th>
      <td id="T_e6569_row0_col0" class="data row0 col0" >mullermatte</td>
      <td id="T_e6569_row0_col1" class="data row0 col1" >aare</td>
      <td id="T_e6569_row0_col2" class="data row0 col2" >Biel/Bienne</td>
      <td id="T_e6569_row0_col3" class="data row0 col3" >bielersee</td>
      <td id="T_e6569_row0_col4" class="data row0 col4" >2362780</td>
      <td id="T_e6569_row0_col5" class="data row0 col5" >Siedl</td>
      <td id="T_e6569_row0_col6" class="data row0 col6" >4602265</td>
      <td id="T_e6569_row0_col7" class="data row0 col7" >0.513395</td>
      <td id="T_e6569_row0_col8" class="data row0 col8" >11</td>
    </tr>
    <tr>
      <th id="T_e6569_level0_row1" class="row_heading level0 row1" >617</th>
      <td id="T_e6569_row1_col0" class="data row1 col0" >nouvelle-plage</td>
      <td id="T_e6569_row1_col1" class="data row1 col1" >aare</td>
      <td id="T_e6569_row1_col2" class="data row1 col2" >Estavayer</td>
      <td id="T_e6569_row1_col3" class="data row1 col3" >neuenburgersee</td>
      <td id="T_e6569_row1_col4" class="data row1 col4" >1517551</td>
      <td id="T_e6569_row1_col5" class="data row1 col5" >Siedl</td>
      <td id="T_e6569_row1_col6" class="data row1 col6" >2860919</td>
      <td id="T_e6569_row1_col7" class="data row1 col7" >0.530442</td>
      <td id="T_e6569_row1_col8" class="data row1 col8" >11</td>
    </tr>
    <tr>
      <th id="T_e6569_level0_row2" class="row_heading level0 row2" >963</th>
      <td id="T_e6569_row2_col0" class="data row2 col0" >tolochenaz</td>
      <td id="T_e6569_row2_col1" class="data row2 col1" >rhone</td>
      <td id="T_e6569_row2_col2" class="data row2 col2" >Tolochenaz</td>
      <td id="T_e6569_row2_col3" class="data row2 col3" >lac-leman</td>
      <td id="T_e6569_row2_col4" class="data row2 col4" >1733621</td>
      <td id="T_e6569_row2_col5" class="data row2 col5" >Siedl</td>
      <td id="T_e6569_row2_col6" class="data row2 col6" >3216699</td>
      <td id="T_e6569_row2_col7" class="data row2 col7" >0.538944</td>
      <td id="T_e6569_row2_col8" class="data row2 col8" >11</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p><em>Survey locations that have similar amounts of <strong>Forest</strong> land use within location hex</em></p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_1832d tr:nth-child(even) {
  background-color: rgba(139, 69, 19, 0.08);
}
#T_1832d tr:nth-child(odd) {
  background: #FFF;
}
#T_1832d tr {
  font-size: 12px;
}
#T_1832d th:nth-child(1) {
  background-color: #FFF;
  text-align: right;
}
</style>
<table id="T_1832d">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_1832d_level0_col0" class="col_heading level0 col0" >location</th>
      <th id="T_1832d_level0_col1" class="col_heading level0 col1" >river_bass</th>
      <th id="T_1832d_level0_col2" class="col_heading level0 col2" >city</th>
      <th id="T_1832d_level0_col3" class="col_heading level0 col3" >feature</th>
      <th id="T_1832d_level0_col4" class="col_heading level0 col4" >surface</th>
      <th id="T_1832d_level0_col5" class="col_heading level0 col5" >use</th>
      <th id="T_1832d_level0_col6" class="col_heading level0 col6" >hex minus</th>
      <th id="T_1832d_level0_col7" class="col_heading level0 col7" >scaled</th>
      <th id="T_1832d_level0_col8" class="col_heading level0 col8" >binned</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_1832d_level0_row0" class="row_heading level0 row0" >275</th>
      <td id="T_1832d_row0_col0" class="data row0 col0" >gasi-strand</td>
      <td id="T_1832d_row0_col1" class="data row0 col1" >linth</td>
      <td id="T_1832d_row0_col2" class="data row0 col2" >Weesen</td>
      <td id="T_1832d_row0_col3" class="data row0 col3" >walensee</td>
      <td id="T_1832d_row0_col4" class="data row0 col4" >1628315</td>
      <td id="T_1832d_row0_col5" class="data row0 col5" >Wald</td>
      <td id="T_1832d_row0_col6" class="data row0 col6" >3800608</td>
      <td id="T_1832d_row0_col7" class="data row0 col7" >0.428435</td>
      <td id="T_1832d_row0_col8" class="data row0 col8" >9</td>
    </tr>
    <tr>
      <th id="T_1832d_level0_row1" class="row_heading level0 row1" >386</th>
      <td id="T_1832d_row1_col0" class="data row1 col0" >lacleman_gland_lecoanets</td>
      <td id="T_1832d_row1_col1" class="data row1 col1" >rhone</td>
      <td id="T_1832d_row1_col2" class="data row1 col2" >Gland</td>
      <td id="T_1832d_row1_col3" class="data row1 col3" >lac-leman</td>
      <td id="T_1832d_row1_col4" class="data row1 col4" >1259466</td>
      <td id="T_1832d_row1_col5" class="data row1 col5" >Wald</td>
      <td id="T_1832d_row1_col6" class="data row1 col6" >3091169</td>
      <td id="T_1832d_row1_col7" class="data row1 col7" >0.407440</td>
      <td id="T_1832d_row1_col8" class="data row1 col8" >9</td>
    </tr>
    <tr>
      <th id="T_1832d_level0_row2" class="row_heading level0 row2" >556</th>
      <td id="T_1832d_row2_col0" class="data row2 col0" >magadino-lido</td>
      <td id="T_1832d_row2_col1" class="data row2 col1" >ticino</td>
      <td id="T_1832d_row2_col2" class="data row2 col2" >Gambarogno</td>
      <td id="T_1832d_row2_col3" class="data row2 col3" >lago-maggiore</td>
      <td id="T_1832d_row2_col4" class="data row2 col4" >1491775</td>
      <td id="T_1832d_row2_col5" class="data row2 col5" >Wald</td>
      <td id="T_1832d_row2_col6" class="data row2 col6" >3599319</td>
      <td id="T_1832d_row2_col7" class="data row2 col7" >0.414460</td>
      <td id="T_1832d_row2_col8" class="data row2 col8" >9</td>
    </tr>
    <tr>
      <th id="T_1832d_level0_row3" class="row_heading level0 row3" >579</th>
      <td id="T_1832d_row3_col0" class="data row3 col0" >mols-rocks</td>
      <td id="T_1832d_row3_col1" class="data row3 col1" >linth</td>
      <td id="T_1832d_row3_col2" class="data row3 col2" >Quarten</td>
      <td id="T_1832d_row3_col3" class="data row3 col3" >walensee</td>
      <td id="T_1832d_row3_col4" class="data row3 col4" >1460847</td>
      <td id="T_1832d_row3_col5" class="data row3 col5" >Wald</td>
      <td id="T_1832d_row3_col6" class="data row3 col6" >3514935</td>
      <td id="T_1832d_row3_col7" class="data row3 col7" >0.415611</td>
      <td id="T_1832d_row3_col8" class="data row3 col8" >9</td>
    </tr>
    <tr>
      <th id="T_1832d_level0_row4" class="row_heading level0 row4" >586</th>
      <td id="T_1832d_row4_col0" class="data row4 col0" >muhlehorn-dorf</td>
      <td id="T_1832d_row4_col1" class="data row4 col1" >linth</td>
      <td id="T_1832d_row4_col2" class="data row4 col2" >Glarus Nord</td>
      <td id="T_1832d_row4_col3" class="data row4 col3" >walensee</td>
      <td id="T_1832d_row4_col4" class="data row4 col4" >1302522</td>
      <td id="T_1832d_row4_col5" class="data row4 col5" >Wald</td>
      <td id="T_1832d_row4_col6" class="data row4 col6" >3158628</td>
      <td id="T_1832d_row4_col7" class="data row4 col7" >0.412370</td>
      <td id="T_1832d_row4_col8" class="data row4 col8" >9</td>
    </tr>
    <tr>
      <th id="T_1832d_level0_row5" class="row_heading level0 row5" >595</th>
      <td id="T_1832d_row5_col0" class="data row5 col0" >mullermatte</td>
      <td id="T_1832d_row5_col1" class="data row5 col1" >aare</td>
      <td id="T_1832d_row5_col2" class="data row5 col2" >Biel/Bienne</td>
      <td id="T_1832d_row5_col3" class="data row5 col3" >bielersee</td>
      <td id="T_1832d_row5_col4" class="data row5 col4" >1928607</td>
      <td id="T_1832d_row5_col5" class="data row5 col5" >Wald</td>
      <td id="T_1832d_row5_col6" class="data row5 col6" >4602265</td>
      <td id="T_1832d_row5_col7" class="data row5 col7" >0.419056</td>
      <td id="T_1832d_row5_col8" class="data row5 col8" >9</td>
    </tr>
    <tr>
      <th id="T_1832d_level0_row6" class="row_heading level0 row6" >602</th>
      <td id="T_1832d_row6_col0" class="data row6 col0" >murg-bad</td>
      <td id="T_1832d_row6_col1" class="data row6 col1" >linth</td>
      <td id="T_1832d_row6_col2" class="data row6 col2" >Quarten</td>
      <td id="T_1832d_row6_col3" class="data row6 col3" >walensee</td>
      <td id="T_1832d_row6_col4" class="data row6 col4" >1029136</td>
      <td id="T_1832d_row6_col5" class="data row6 col5" >Wald</td>
      <td id="T_1832d_row6_col6" class="data row6 col6" >2521874</td>
      <td id="T_1832d_row6_col7" class="data row6 col7" >0.408084</td>
      <td id="T_1832d_row6_col8" class="data row6 col8" >9</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Note that the only common element of the two preceeding tables is the location in question.</p>
<div class="cell tag_remove-input docutils container">
</div>
</div>
</div>
</div>
<div class="section" id="testing-the-threshold">
<h2><span class="section-number">6.5. </span>Testing the threshold<a class="headerlink" href="#testing-the-threshold" title="Permalink to this headline">#</a></h2>
<p>To test a threshhold the survey results for the object of interest at each location are compared to the threshhold value. The number of times that the threshold value was exceeded (success) is counted for each location and sample. The number of samples for each location is also recorded. The result is an indexed data frame that contains the number of successes and samples for each location.</p>
<p>For example consider the results for locations with similar urban land-use characteristics as mullermatte:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_c6d1d tr:nth-child(even) {
  background-color: rgba(139, 69, 19, 0.08);
}
#T_c6d1d tr:nth-child(odd) {
  background: #FFF;
}
#T_c6d1d tr {
  font-size: 12px;
}
#T_c6d1d th:nth-child(1) {
  background-color: #FFF;
  text-align: right;
}
</style>
<table id="T_c6d1d">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_c6d1d_level0_col0" class="col_heading level0 col0" >k</th>
      <th id="T_c6d1d_level0_col1" class="col_heading level0 col1" >n</th>
      <th id="T_c6d1d_level0_col2" class="col_heading level0 col2" >n-k</th>
      <th id="T_c6d1d_level0_col3" class="col_heading level0 col3" >k/n</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_c6d1d_level0_row0" class="row_heading level0 row0" >mullermatte</th>
      <td id="T_c6d1d_row0_col0" class="data row0 col0" >10</td>
      <td id="T_c6d1d_row0_col1" class="data row0 col1" >12</td>
      <td id="T_c6d1d_row0_col2" class="data row0 col2" >2</td>
      <td id="T_c6d1d_row0_col3" class="data row0 col3" >0.833333</td>
    </tr>
    <tr>
      <th id="T_c6d1d_level0_row1" class="row_heading level0 row1" >nouvelle-plage</th>
      <td id="T_c6d1d_row1_col0" class="data row1 col0" >0</td>
      <td id="T_c6d1d_row1_col1" class="data row1 col1" >1</td>
      <td id="T_c6d1d_row1_col2" class="data row1 col2" >1</td>
      <td id="T_c6d1d_row1_col3" class="data row1 col3" >0.000000</td>
    </tr>
    <tr>
      <th id="T_c6d1d_level0_row2" class="row_heading level0 row2" >tolochenaz</th>
      <td id="T_c6d1d_row2_col0" class="data row2 col0" >0</td>
      <td id="T_c6d1d_row2_col1" class="data row2 col1" >1</td>
      <td id="T_c6d1d_row2_col2" class="data row2 col2" >1</td>
      <td id="T_c6d1d_row2_col3" class="data row2 col3" >0.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>These results reprsent the number of times that a threshold value was exceeded (k) and the number of samples (n) at each location. When the survey results are merged with the land-use values for each location the result is the number of times that threshhold value was exceeded for the range of land use values contained in the bin:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_dcabe tr:nth-child(even) {
  background-color: rgba(139, 69, 19, 0.08);
}
#T_dcabe tr:nth-child(odd) {
  background: #FFF;
}
#T_dcabe tr {
  font-size: 12px;
}
#T_dcabe th:nth-child(1) {
  background-color: #FFF;
  text-align: right;
}
</style>
<table id="T_dcabe">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_dcabe_level0_col0" class="col_heading level0 col0" >location</th>
      <th id="T_dcabe_level0_col1" class="col_heading level0 col1" >hex minus</th>
      <th id="T_dcabe_level0_col2" class="col_heading level0 col2" >surface</th>
      <th id="T_dcabe_level0_col3" class="col_heading level0 col3" >scaled</th>
      <th id="T_dcabe_level0_col4" class="col_heading level0 col4" >binned</th>
      <th id="T_dcabe_level0_col5" class="col_heading level0 col5" >k</th>
      <th id="T_dcabe_level0_col6" class="col_heading level0 col6" >n</th>
      <th id="T_dcabe_level0_col7" class="col_heading level0 col7" >n-k</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_dcabe_level0_row0" class="row_heading level0 row0" >Siedl</th>
      <td id="T_dcabe_row0_col0" class="data row0 col0" >mullermatte</td>
      <td id="T_dcabe_row0_col1" class="data row0 col1" >4602265</td>
      <td id="T_dcabe_row0_col2" class="data row0 col2" >2362780</td>
      <td id="T_dcabe_row0_col3" class="data row0 col3" >0.513395</td>
      <td id="T_dcabe_row0_col4" class="data row0 col4" >11</td>
      <td id="T_dcabe_row0_col5" class="data row0 col5" >10</td>
      <td id="T_dcabe_row0_col6" class="data row0 col6" >14</td>
      <td id="T_dcabe_row0_col7" class="data row0 col7" >4</td>
    </tr>
    <tr>
      <th id="T_dcabe_level0_row1" class="row_heading level0 row1" >Siedl</th>
      <td id="T_dcabe_row1_col0" class="data row1 col0" >nouvelle-plage</td>
      <td id="T_dcabe_row1_col1" class="data row1 col1" >2860919</td>
      <td id="T_dcabe_row1_col2" class="data row1 col2" >1517551</td>
      <td id="T_dcabe_row1_col3" class="data row1 col3" >0.530442</td>
      <td id="T_dcabe_row1_col4" class="data row1 col4" >11</td>
      <td id="T_dcabe_row1_col5" class="data row1 col5" >10</td>
      <td id="T_dcabe_row1_col6" class="data row1 col6" >14</td>
      <td id="T_dcabe_row1_col7" class="data row1 col7" >4</td>
    </tr>
    <tr>
      <th id="T_dcabe_level0_row2" class="row_heading level0 row2" >Siedl</th>
      <td id="T_dcabe_row2_col0" class="data row2 col0" >tolochenaz</td>
      <td id="T_dcabe_row2_col1" class="data row2 col1" >3216699</td>
      <td id="T_dcabe_row2_col2" class="data row2 col2" >1733621</td>
      <td id="T_dcabe_row2_col3" class="data row2 col3" >0.538944</td>
      <td id="T_dcabe_row2_col4" class="data row2 col4" >11</td>
      <td id="T_dcabe_row2_col5" class="data row2 col5" >10</td>
      <td id="T_dcabe_row2_col6" class="data row2 col6" >14</td>
      <td id="T_dcabe_row2_col7" class="data row2 col7" >4</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p><strong>Interpretation:</strong> Locations where the scaled surface area classified as urban is between .5 and .55 (bin 11) exceeded the threshold value 10/14 times.</p>
<p>When this process is repeated for all locations and all land-use values, the record of success for each location can be considered in terms of the global record of success, given the land use characteristics:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_62f13 tr:nth-child(even) {
  background-color: rgba(139, 69, 19, 0.08);
}
#T_62f13 tr:nth-child(odd) {
  background: #FFF;
}
#T_62f13 tr {
  font-size: 12px;
}
#T_62f13 th:nth-child(1) {
  background-color: #FFF;
  text-align: right;
}
</style>
<table id="T_62f13">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_62f13_level0_col0" class="col_heading level0 col0" >river_bass</th>
      <th id="T_62f13_level0_col1" class="col_heading level0 col1" >location</th>
      <th id="T_62f13_level0_col2" class="col_heading level0 col2" >city</th>
      <th id="T_62f13_level0_col3" class="col_heading level0 col3" >feature</th>
      <th id="T_62f13_level0_col4" class="col_heading level0 col4" >hex minus</th>
      <th id="T_62f13_level0_col5" class="col_heading level0 col5" >surface</th>
      <th id="T_62f13_level0_col6" class="col_heading level0 col6" >scaled</th>
      <th id="T_62f13_level0_col7" class="col_heading level0 col7" >binned</th>
      <th id="T_62f13_level0_col8" class="col_heading level0 col8" >k</th>
      <th id="T_62f13_level0_col9" class="col_heading level0 col9" >n</th>
      <th id="T_62f13_level0_col10" class="col_heading level0 col10" >n-k</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_62f13_level0_row0" class="row_heading level0 row0" >Siedl</th>
      <td id="T_62f13_row0_col0" class="data row0 col0" >aare</td>
      <td id="T_62f13_row0_col1" class="data row0 col1" >mullermatte</td>
      <td id="T_62f13_row0_col2" class="data row0 col2" >Biel/Bienne</td>
      <td id="T_62f13_row0_col3" class="data row0 col3" >bielersee</td>
      <td id="T_62f13_row0_col4" class="data row0 col4" >4602265</td>
      <td id="T_62f13_row0_col5" class="data row0 col5" >2362780</td>
      <td id="T_62f13_row0_col6" class="data row0 col6" >0.513395</td>
      <td id="T_62f13_row0_col7" class="data row0 col7" >11</td>
      <td id="T_62f13_row0_col8" class="data row0 col8" >10</td>
      <td id="T_62f13_row0_col9" class="data row0 col9" >14</td>
      <td id="T_62f13_row0_col10" class="data row0 col10" >4</td>
    </tr>
    <tr>
      <th id="T_62f13_level0_row1" class="row_heading level0 row1" >Stadtzentr</th>
      <td id="T_62f13_row1_col0" class="data row1 col0" >aare</td>
      <td id="T_62f13_row1_col1" class="data row1 col1" >mullermatte</td>
      <td id="T_62f13_row1_col2" class="data row1 col2" >Biel/Bienne</td>
      <td id="T_62f13_row1_col3" class="data row1 col3" >bielersee</td>
      <td id="T_62f13_row1_col4" class="data row1 col4" >4602265</td>
      <td id="T_62f13_row1_col5" class="data row1 col5" >34237</td>
      <td id="T_62f13_row1_col6" class="data row1 col6" >0.007439</td>
      <td id="T_62f13_row1_col7" class="data row1 col7" >1</td>
      <td id="T_62f13_row1_col8" class="data row1 col8" >16</td>
      <td id="T_62f13_row1_col9" class="data row1 col9" >20</td>
      <td id="T_62f13_row1_col10" class="data row1 col10" >4</td>
    </tr>
    <tr>
      <th id="T_62f13_level0_row2" class="row_heading level0 row2" >Wald</th>
      <td id="T_62f13_row2_col0" class="data row2 col0" >aare</td>
      <td id="T_62f13_row2_col1" class="data row2 col1" >mullermatte</td>
      <td id="T_62f13_row2_col2" class="data row2 col2" >Biel/Bienne</td>
      <td id="T_62f13_row2_col3" class="data row2 col3" >bielersee</td>
      <td id="T_62f13_row2_col4" class="data row2 col4" >4602265</td>
      <td id="T_62f13_row2_col5" class="data row2 col5" >1928607</td>
      <td id="T_62f13_row2_col6" class="data row2 col6" >0.419056</td>
      <td id="T_62f13_row2_col7" class="data row2 col7" >9</td>
      <td id="T_62f13_row2_col8" class="data row2 col8" >14</td>
      <td id="T_62f13_row2_col9" class="data row2 col9" >31</td>
      <td id="T_62f13_row2_col10" class="data row2 col10" >17</td>
    </tr>
    <tr>
      <th id="T_62f13_level0_row3" class="row_heading level0 row3" >Fels</th>
      <td id="T_62f13_row3_col0" class="data row3 col0" >aare</td>
      <td id="T_62f13_row3_col1" class="data row3 col1" >mullermatte</td>
      <td id="T_62f13_row3_col2" class="data row3 col2" >Biel/Bienne</td>
      <td id="T_62f13_row3_col3" class="data row3 col3" >bielersee</td>
      <td id="T_62f13_row3_col4" class="data row3 col4" >4602265</td>
      <td id="T_62f13_row3_col5" class="data row3 col5" >0</td>
      <td id="T_62f13_row3_col6" class="data row3 col6" >0.000000</td>
      <td id="T_62f13_row3_col7" class="data row3 col7" >0</td>
      <td id="T_62f13_row3_col8" class="data row3 col8" >145</td>
      <td id="T_62f13_row3_col9" class="data row3 col9" >281</td>
      <td id="T_62f13_row3_col10" class="data row3 col10" >136</td>
    </tr>
    <tr>
      <th id="T_62f13_level0_row4" class="row_heading level0 row4" >Obstanlage</th>
      <td id="T_62f13_row4_col0" class="data row4 col0" >aare</td>
      <td id="T_62f13_row4_col1" class="data row4 col1" >mullermatte</td>
      <td id="T_62f13_row4_col2" class="data row4 col2" >Biel/Bienne</td>
      <td id="T_62f13_row4_col3" class="data row4 col3" >bielersee</td>
      <td id="T_62f13_row4_col4" class="data row4 col4" >4602265</td>
      <td id="T_62f13_row4_col5" class="data row4 col5" >0</td>
      <td id="T_62f13_row4_col6" class="data row4 col6" >0.000000</td>
      <td id="T_62f13_row4_col7" class="data row4 col7" >0</td>
      <td id="T_62f13_row4_col8" class="data row4 col8" >136</td>
      <td id="T_62f13_row4_col9" class="data row4 col9" >273</td>
      <td id="T_62f13_row4_col10" class="data row4 col10" >137</td>
    </tr>
    <tr>
      <th id="T_62f13_level0_row5" class="row_heading level0 row5" >Reben</th>
      <td id="T_62f13_row5_col0" class="data row5 col0" >aare</td>
      <td id="T_62f13_row5_col1" class="data row5 col1" >mullermatte</td>
      <td id="T_62f13_row5_col2" class="data row5 col2" >Biel/Bienne</td>
      <td id="T_62f13_row5_col3" class="data row5 col3" >bielersee</td>
      <td id="T_62f13_row5_col4" class="data row5 col4" >4602265</td>
      <td id="T_62f13_row5_col5" class="data row5 col5" >0</td>
      <td id="T_62f13_row5_col6" class="data row5 col6" >0.000000</td>
      <td id="T_62f13_row5_col7" class="data row5 col7" >0</td>
      <td id="T_62f13_row5_col8" class="data row5 col8" >119</td>
      <td id="T_62f13_row5_col9" class="data row5 col9" >257</td>
      <td id="T_62f13_row5_col10" class="data row5 col10" >138</td>
    </tr>
    <tr>
      <th id="T_62f13_level0_row6" class="row_heading level0 row6" >Sumpf</th>
      <td id="T_62f13_row6_col0" class="data row6 col0" >aare</td>
      <td id="T_62f13_row6_col1" class="data row6 col1" >mullermatte</td>
      <td id="T_62f13_row6_col2" class="data row6 col2" >Biel/Bienne</td>
      <td id="T_62f13_row6_col3" class="data row6 col3" >bielersee</td>
      <td id="T_62f13_row6_col4" class="data row6 col4" >4602265</td>
      <td id="T_62f13_row6_col5" class="data row6 col5" >0</td>
      <td id="T_62f13_row6_col6" class="data row6 col6" >0.000000</td>
      <td id="T_62f13_row6_col7" class="data row6 col7" >0</td>
      <td id="T_62f13_row6_col8" class="data row6 col8" >127</td>
      <td id="T_62f13_row6_col9" class="data row6 col9" >247</td>
      <td id="T_62f13_row6_col10" class="data row6 col10" >120</td>
    </tr>
    <tr>
      <th id="T_62f13_level0_row7" class="row_heading level0 row7" >undefined</th>
      <td id="T_62f13_row7_col0" class="data row7 col0" >aare</td>
      <td id="T_62f13_row7_col1" class="data row7 col1" >mullermatte</td>
      <td id="T_62f13_row7_col2" class="data row7 col2" >Biel/Bienne</td>
      <td id="T_62f13_row7_col3" class="data row7 col3" >bielersee</td>
      <td id="T_62f13_row7_col4" class="data row7 col4" >4602265</td>
      <td id="T_62f13_row7_col5" class="data row7 col5" >276641</td>
      <td id="T_62f13_row7_col6" class="data row7 col6" >0.060110</td>
      <td id="T_62f13_row7_col7" class="data row7 col7" >2</td>
      <td id="T_62f13_row7_col8" class="data row7 col8" >11</td>
      <td id="T_62f13_row7_col9" class="data row7 col9" >16</td>
      <td id="T_62f13_row7_col10" class="data row7 col10" >5</td>
    </tr>
    <tr>
      <th id="T_62f13_level0_row8" class="row_heading level0 row8" >infrastructure</th>
      <td id="T_62f13_row8_col0" class="data row8 col0" >aare</td>
      <td id="T_62f13_row8_col1" class="data row8 col1" >mullermatte</td>
      <td id="T_62f13_row8_col2" class="data row8 col2" >Biel/Bienne</td>
      <td id="T_62f13_row8_col3" class="data row8 col3" >bielersee</td>
      <td id="T_62f13_row8_col4" class="data row8 col4" >4602265</td>
      <td id="T_62f13_row8_col5" class="data row8 col5" >186185</td>
      <td id="T_62f13_row8_col6" class="data row8 col6" >0.040455</td>
      <td id="T_62f13_row8_col7" class="data row8 col7" >1</td>
      <td id="T_62f13_row8_col8" class="data row8 col8" >99</td>
      <td id="T_62f13_row8_col9" class="data row8 col9" >216</td>
      <td id="T_62f13_row8_col10" class="data row8 col10" >117</td>
    </tr>
    <tr>
      <th id="T_62f13_level0_row9" class="row_heading level0 row9" >recreation</th>
      <td id="T_62f13_row9_col0" class="data row9 col0" >aare</td>
      <td id="T_62f13_row9_col1" class="data row9 col1" >mullermatte</td>
      <td id="T_62f13_row9_col2" class="data row9 col2" >Biel/Bienne</td>
      <td id="T_62f13_row9_col3" class="data row9 col3" >bielersee</td>
      <td id="T_62f13_row9_col4" class="data row9 col4" >4602265</td>
      <td id="T_62f13_row9_col5" class="data row9 col5" >138729</td>
      <td id="T_62f13_row9_col6" class="data row9 col6" >0.030144</td>
      <td id="T_62f13_row9_col7" class="data row9 col7" >1</td>
      <td id="T_62f13_row9_col8" class="data row9 col8" >122</td>
      <td id="T_62f13_row9_col9" class="data row9 col9" >243</td>
      <td id="T_62f13_row9_col10" class="data row9 col10" >121</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="section" id="the-odds-and-frequency-of-exceeding-the-threshold">
<h3><span class="section-number">6.5.1. </span>The odds and frequency of exceeding the threshold<a class="headerlink" href="#the-odds-and-frequency-of-exceeding-the-threshold" title="Permalink to this headline">#</a></h3>
<p>Given the values in the preceeding table an initial assesment of the frequency (k/n) and the odds (k/(n-k)) of exceeding the threshold can be made.</p>
<p><strong>The expected frequency</strong> (k/n) that a survey result will exceed the threshhold value for a particular land use group is given in the table below.</p>
<ol class="arabic simple">
<li><p>all data = all the results and all land use values, the median of all data</p></li>
<li><p>survey area = the survey results from the survey area, given the land use conditions of the survey area</p></li>
<li><p>lake = the survey results from the lake, given the land use conditions of the lake</p></li>
<li><p>location = the survey results from the locations with similar land-use features as mullermatte (including mullermatte)</p></li>
</ol>
<p><strong>Remarks</strong>: We expect the median value to be exceeded 50% of the time when all data is considered. The frequency that the threshhold will be exceeded within the survey area is lower than the rest of the data for the following land-use attributes:</p>
<ol class="arabic simple">
<li><p>Orchard</p></li>
<li><p>Urban</p></li>
<li><p>Forest</p></li>
<li><p>Infrastructure</p></li>
</ol>
<p>At the lake level, values greater than the median should be expected for wetlands. For locations that have similar characteristics the urbanization (city, city center) and undefined areas should expect values greater than the median.</p>
<p>Compared to the reported median of the lakes and rivers in the Aare survey area (<a class="reference external" href="https://hammerdirt-analyst.github.io/IQAASL-End-0f-Sampling-2021/aare_sa.html">Results Aare Survey area</a>), we would expect the frequency that the threshhold is exceeded to be less than all-data in the Aare survey area given that the reported median for the same object is less in the Aare survey area.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">collect_odds_frequency</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;odds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;k&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;n-k&quot;</span><span class="p">]</span>
    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;k&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">data</span>

<span class="k">def</span> <span class="nf">land_use_odds_frequency</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">rb</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
    <span class="n">agg_cols</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;k&quot;</span><span class="p">:</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;n-k&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">}</span>
    
    <span class="n">dall</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">])</span>
    <span class="n">dall</span> <span class="o">=</span> <span class="n">dall</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_cols</span><span class="p">)</span>
    <span class="n">dall</span> <span class="o">=</span> <span class="n">collect_odds_frequency</span><span class="p">(</span><span class="n">dall</span><span class="p">)</span>
    
    <span class="n">drb</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">river_bass</span> <span class="o">==</span> <span class="n">rb</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">])</span>
    <span class="n">drb</span> <span class="o">=</span> <span class="n">drb</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_cols</span><span class="p">)</span>
    <span class="n">drb</span> <span class="o">=</span> <span class="n">collect_odds_frequency</span><span class="p">(</span><span class="n">drb</span><span class="p">)</span>
    
    <span class="n">dfeat</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">feature</span> <span class="o">==</span> <span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">])</span>
    <span class="n">dfeat</span> <span class="o">=</span> <span class="n">dfeat</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_cols</span><span class="p">)</span>
    <span class="n">dfeat</span> <span class="o">=</span> <span class="n">collect_odds_frequency</span><span class="p">(</span><span class="n">dfeat</span><span class="p">)</span>
    
    <span class="n">dloc</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">location</span> <span class="o">==</span> <span class="n">location</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">])</span>
    <span class="n">dloc</span> <span class="o">=</span> <span class="n">dloc</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">agg_cols</span><span class="p">)</span>
    <span class="n">dloc</span> <span class="o">=</span> <span class="n">collect_odds_frequency</span><span class="p">(</span><span class="n">dloc</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">dall</span><span class="p">,</span> <span class="n">drb</span><span class="p">,</span> <span class="n">dfeat</span><span class="p">,</span> <span class="n">dloc</span>

<span class="k">def</span> <span class="nf">summary_table_odds_frequency</span><span class="p">(</span><span class="n">dall</span><span class="p">,</span> <span class="n">drb</span><span class="p">,</span> <span class="n">dfeat</span><span class="p">,</span> <span class="n">dloc</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s2">&quot;odds&quot;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;all data&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">,</span> <span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">]):</span>    
    
    <span class="n">dall</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">column</span><span class="p">:</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">drb</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">column</span><span class="p">:</span><span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">]},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dfeat</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">column</span><span class="p">:</span><span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">]},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dloc</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">column</span><span class="p">:</span><span class="n">labels</span><span class="p">[</span><span class="mi">3</span><span class="p">]},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dall</span><span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">drb</span><span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">dfeat</span><span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">location</span><span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="mi">3</span><span class="p">]]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">summary</span>

    
<span class="n">aglu_totals</span> <span class="o">=</span> <span class="n">aglu</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s2">&quot;use&quot;</span><span class="p">,</span> <span class="s2">&quot;binned&quot;</span><span class="p">])</span>

<span class="n">all_data</span><span class="p">,</span> <span class="n">r_bas</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">location</span> <span class="o">=</span> <span class="n">land_use_odds_frequency</span><span class="p">(</span><span class="n">aglu</span><span class="p">,</span> <span class="n">survey_area</span><span class="p">,</span> <span class="n">a_feature</span><span class="p">,</span> <span class="n">beach</span><span class="p">)</span>

<span class="n">summary_frequency</span> <span class="o">=</span> <span class="n">summary_table_odds_frequency</span><span class="p">(</span><span class="n">all_data</span><span class="p">,</span> <span class="n">r_bas</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;all data&quot;</span><span class="p">,</span> <span class="s2">&quot;survey area&quot;</span><span class="p">,</span><span class="s2">&quot;lake&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">])</span>
<span class="n">summary_frequency</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">style_frequency</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">props</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;=</span> <span class="mf">.51</span>  <span class="k">else</span> <span class="kc">None</span>
<span class="c1"># s2 = df2.style.applymap(style_negative, props=&#39;color:red;&#39;)\</span>
<span class="c1">#               .applymap(lambda v: &#39;opacity: 20%;&#39; if (v &lt; 0.3) and (v &gt; -0.3) else None)</span>
<span class="c1"># s2</span>
<span class="c1"># sodds = summary_odds.style.format(precision=2) # </span>
<span class="n">s_frequency</span> <span class="o">=</span> <span class="n">summary_frequency</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="n">style_frequency</span><span class="p">,</span> <span class="n">props</span><span class="o">=</span><span class="s1">&#39;color:red;&#39;</span><span class="p">)</span>
<span class="n">s_frequency</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="s1">&#39;opacity: 20%;&#39;</span> <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&lt;=</span> <span class="mf">0.515</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">v</span> <span class="o">&gt;</span> <span class="mf">0.495</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_584ed_row0_col0, #T_584ed_row0_col1, #T_584ed_row1_col3, #T_584ed_row2_col0, #T_584ed_row2_col1, #T_584ed_row2_col2, #T_584ed_row4_col0, #T_584ed_row5_col0, #T_584ed_row8_col1, #T_584ed_row8_col2, #T_584ed_row8_col3, #T_584ed_row9_col1 {
  opacity: 20%;
}
#T_584ed_row0_col2, #T_584ed_row5_col3 {
  color: red;
  opacity: 20%;
}
#T_584ed_row0_col3, #T_584ed_row3_col3, #T_584ed_row4_col3, #T_584ed_row5_col2, #T_584ed_row9_col3 {
  color: red;
}
</style>
<table id="T_584ed">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_584ed_level0_col0" class="col_heading level0 col0" >all data</th>
      <th id="T_584ed_level0_col1" class="col_heading level0 col1" >survey area</th>
      <th id="T_584ed_level0_col2" class="col_heading level0 col2" >lake</th>
      <th id="T_584ed_level0_col3" class="col_heading level0 col3" >location</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_584ed_level0_row0" class="row_heading level0 row0" >Fels</th>
      <td id="T_584ed_row0_col0" class="data row0 col0" >0.50</td>
      <td id="T_584ed_row0_col1" class="data row0 col1" >0.50</td>
      <td id="T_584ed_row0_col2" class="data row0 col2" >0.51</td>
      <td id="T_584ed_row0_col3" class="data row0 col3" >0.52</td>
    </tr>
    <tr>
      <th id="T_584ed_level0_row1" class="row_heading level0 row1" >Obstanlage</th>
      <td id="T_584ed_row1_col0" class="data row1 col0" >0.49</td>
      <td id="T_584ed_row1_col1" class="data row1 col1" >0.48</td>
      <td id="T_584ed_row1_col2" class="data row1 col2" >0.49</td>
      <td id="T_584ed_row1_col3" class="data row1 col3" >0.50</td>
    </tr>
    <tr>
      <th id="T_584ed_level0_row2" class="row_heading level0 row2" >Reben</th>
      <td id="T_584ed_row2_col0" class="data row2 col0" >0.50</td>
      <td id="T_584ed_row2_col1" class="data row2 col1" >0.50</td>
      <td id="T_584ed_row2_col2" class="data row2 col2" >0.50</td>
      <td id="T_584ed_row2_col3" class="data row2 col3" >0.46</td>
    </tr>
    <tr>
      <th id="T_584ed_level0_row3" class="row_heading level0 row3" >Siedl</th>
      <td id="T_584ed_row3_col0" class="data row3 col0" >0.49</td>
      <td id="T_584ed_row3_col1" class="data row3 col1" >0.48</td>
      <td id="T_584ed_row3_col2" class="data row3 col2" >0.41</td>
      <td id="T_584ed_row3_col3" class="data row3 col3" >0.71</td>
    </tr>
    <tr>
      <th id="T_584ed_level0_row4" class="row_heading level0 row4" >Stadtzentr</th>
      <td id="T_584ed_row4_col0" class="data row4 col0" >0.50</td>
      <td id="T_584ed_row4_col1" class="data row4 col1" >0.49</td>
      <td id="T_584ed_row4_col2" class="data row4 col2" >0.49</td>
      <td id="T_584ed_row4_col3" class="data row4 col3" >0.80</td>
    </tr>
    <tr>
      <th id="T_584ed_level0_row5" class="row_heading level0 row5" >Sumpf</th>
      <td id="T_584ed_row5_col0" class="data row5 col0" >0.50</td>
      <td id="T_584ed_row5_col1" class="data row5 col1" >0.49</td>
      <td id="T_584ed_row5_col2" class="data row5 col2" >0.52</td>
      <td id="T_584ed_row5_col3" class="data row5 col3" >0.51</td>
    </tr>
    <tr>
      <th id="T_584ed_level0_row6" class="row_heading level0 row6" >Wald</th>
      <td id="T_584ed_row6_col0" class="data row6 col0" >0.49</td>
      <td id="T_584ed_row6_col1" class="data row6 col1" >0.46</td>
      <td id="T_584ed_row6_col2" class="data row6 col2" >0.38</td>
      <td id="T_584ed_row6_col3" class="data row6 col3" >0.45</td>
    </tr>
    <tr>
      <th id="T_584ed_level0_row7" class="row_heading level0 row7" >infrastructure</th>
      <td id="T_584ed_row7_col0" class="data row7 col0" >0.49</td>
      <td id="T_584ed_row7_col1" class="data row7 col1" >0.46</td>
      <td id="T_584ed_row7_col2" class="data row7 col2" >0.47</td>
      <td id="T_584ed_row7_col3" class="data row7 col3" >0.46</td>
    </tr>
    <tr>
      <th id="T_584ed_level0_row8" class="row_heading level0 row8" >recreation</th>
      <td id="T_584ed_row8_col0" class="data row8 col0" >0.49</td>
      <td id="T_584ed_row8_col1" class="data row8 col1" >0.50</td>
      <td id="T_584ed_row8_col2" class="data row8 col2" >0.50</td>
      <td id="T_584ed_row8_col3" class="data row8 col3" >0.50</td>
    </tr>
    <tr>
      <th id="T_584ed_level0_row9" class="row_heading level0 row9" >undefined</th>
      <td id="T_584ed_row9_col0" class="data row9 col0" >0.49</td>
      <td id="T_584ed_row9_col1" class="data row9 col1" >0.50</td>
      <td id="T_584ed_row9_col2" class="data row9 col2" >0.48</td>
      <td id="T_584ed_row9_col3" class="data row9 col3" >0.69</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p><strong>The expected odds:</strong> are similar to the expected frequency. Notably for this location urbanization, city center and undefined land use attributes increase the odds in favor of exceeding the threshold value by more than 2/1.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_d8086_row0_col1, #T_d8086_row1_col3 {
  opacity: 20%;
}
#T_d8086_row0_col2, #T_d8086_row0_col3, #T_d8086_row3_col3, #T_d8086_row4_col3, #T_d8086_row5_col2, #T_d8086_row5_col3, #T_d8086_row8_col2, #T_d8086_row8_col3, #T_d8086_row9_col3 {
  color: red;
}
</style>
<table id="T_d8086">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_d8086_level0_col0" class="col_heading level0 col0" >all data</th>
      <th id="T_d8086_level0_col1" class="col_heading level0 col1" >survey area</th>
      <th id="T_d8086_level0_col2" class="col_heading level0 col2" >lake</th>
      <th id="T_d8086_level0_col3" class="col_heading level0 col3" >location</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_d8086_level0_row0" class="row_heading level0 row0" >Fels</th>
      <td id="T_d8086_row0_col0" class="data row0 col0" >0.99</td>
      <td id="T_d8086_row0_col1" class="data row0 col1" >0.99</td>
      <td id="T_d8086_row0_col2" class="data row0 col2" >1.06</td>
      <td id="T_d8086_row0_col3" class="data row0 col3" >1.07</td>
    </tr>
    <tr>
      <th id="T_d8086_level0_row1" class="row_heading level0 row1" >Obstanlage</th>
      <td id="T_d8086_row1_col0" class="data row1 col0" >0.98</td>
      <td id="T_d8086_row1_col1" class="data row1 col1" >0.92</td>
      <td id="T_d8086_row1_col2" class="data row1 col2" >0.98</td>
      <td id="T_d8086_row1_col3" class="data row1 col3" >0.99</td>
    </tr>
    <tr>
      <th id="T_d8086_level0_row2" class="row_heading level0 row2" >Reben</th>
      <td id="T_d8086_row2_col0" class="data row2 col0" >0.99</td>
      <td id="T_d8086_row2_col1" class="data row2 col1" >0.99</td>
      <td id="T_d8086_row2_col2" class="data row2 col2" >0.99</td>
      <td id="T_d8086_row2_col3" class="data row2 col3" >0.86</td>
    </tr>
    <tr>
      <th id="T_d8086_level0_row3" class="row_heading level0 row3" >Siedl</th>
      <td id="T_d8086_row3_col0" class="data row3 col0" >0.97</td>
      <td id="T_d8086_row3_col1" class="data row3 col1" >0.92</td>
      <td id="T_d8086_row3_col2" class="data row3 col2" >0.68</td>
      <td id="T_d8086_row3_col3" class="data row3 col3" >2.50</td>
    </tr>
    <tr>
      <th id="T_d8086_level0_row4" class="row_heading level0 row4" >Stadtzentr</th>
      <td id="T_d8086_row4_col0" class="data row4 col0" >0.99</td>
      <td id="T_d8086_row4_col1" class="data row4 col1" >0.98</td>
      <td id="T_d8086_row4_col2" class="data row4 col2" >0.95</td>
      <td id="T_d8086_row4_col3" class="data row4 col3" >4.00</td>
    </tr>
    <tr>
      <th id="T_d8086_level0_row5" class="row_heading level0 row5" >Sumpf</th>
      <td id="T_d8086_row5_col0" class="data row5 col0" >0.99</td>
      <td id="T_d8086_row5_col1" class="data row5 col1" >0.98</td>
      <td id="T_d8086_row5_col2" class="data row5 col2" >1.10</td>
      <td id="T_d8086_row5_col3" class="data row5 col3" >1.06</td>
    </tr>
    <tr>
      <th id="T_d8086_level0_row6" class="row_heading level0 row6" >Wald</th>
      <td id="T_d8086_row6_col0" class="data row6 col0" >0.97</td>
      <td id="T_d8086_row6_col1" class="data row6 col1" >0.84</td>
      <td id="T_d8086_row6_col2" class="data row6 col2" >0.60</td>
      <td id="T_d8086_row6_col3" class="data row6 col3" >0.82</td>
    </tr>
    <tr>
      <th id="T_d8086_level0_row7" class="row_heading level0 row7" >infrastructure</th>
      <td id="T_d8086_row7_col0" class="data row7 col0" >0.97</td>
      <td id="T_d8086_row7_col1" class="data row7 col1" >0.86</td>
      <td id="T_d8086_row7_col2" class="data row7 col2" >0.88</td>
      <td id="T_d8086_row7_col3" class="data row7 col3" >0.85</td>
    </tr>
    <tr>
      <th id="T_d8086_level0_row8" class="row_heading level0 row8" >recreation</th>
      <td id="T_d8086_row8_col0" class="data row8 col0" >0.97</td>
      <td id="T_d8086_row8_col1" class="data row8 col1" >0.98</td>
      <td id="T_d8086_row8_col2" class="data row8 col2" >1.01</td>
      <td id="T_d8086_row8_col3" class="data row8 col3" >1.01</td>
    </tr>
    <tr>
      <th id="T_d8086_level0_row9" class="row_heading level0 row9" >undefined</th>
      <td id="T_d8086_row9_col0" class="data row9 col0" >0.97</td>
      <td id="T_d8086_row9_col1" class="data row9 col1" >0.99</td>
      <td id="T_d8086_row9_col2" class="data row9 col2" >0.92</td>
      <td id="T_d8086_row9_col3" class="data row9 col3" >2.20</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p><strong>Interpretation:</strong> We do expect to exceed the national median the Aare survey area. At the lake level there are conditions that suggest the median value will be exceeded. However, we do not expect to exceed the median in most cases. For this location in particular we expect the median value to be exceeded frequently. The main causes could be attributed to the runoff from the urban center, increased use of recreational areas and appropriation or use of undefined areas within the hexagon that surrounds mullermatte.</p>
</div>
<div class="section" id="the-probability-of-exceeding-the-threshold">
<h3><span class="section-number">6.5.2. </span>The probability of exceeding the threshold<a class="headerlink" href="#the-probability-of-exceeding-the-threshold" title="Permalink to this headline">#</a></h3>
<p>The probability of exceeding the threshhold can be written as a conditional probability statement. Substituting our variables in to Bayes’ Theorem we get:</p>
<div class="math notranslate nohighlight">
\[p(\theta | landuse) = \frac{p(landuse|\theta)*p(\theta)}{p(landuse)}\]</div>
<p>This is read as the probability of exceeding the threshold given the land-use conditions <span class="math notranslate nohighlight">\(p(\theta | landuse)\)</span> is equal to the product of  the probability that the threshold was exceeded for a land-use condition given the proabability of exceeding the threshold <span class="math notranslate nohighlight">\(p(landuse|\theta)\)</span> and the probability of exceeding the threshhold <span class="math notranslate nohighlight">\(p(\theta)\)</span>, divided by the probability of exceeding the threshold under all land-use condtions <span class="math notranslate nohighlight">\(p(landuse)\)</span>. (<a class="reference external" href="https://en.wikipedia.org/wiki/Bayes%27_theorem">Bayes’ theorem</a>) (<a class="reference external" href="https://en.wikipedia.org/wiki/Conditional_probability">conditional proabability</a>)</p>
<p>The terms of this relationship can be labled in the following way:</p>
<ol class="arabic simple">
<li><p>Conditional probability of interest (posterior) = <span class="math notranslate nohighlight">\(p(\theta | landuse)\)</span></p></li>
<li><p>Likelihood = <span class="math notranslate nohighlight">\(p(landuse|\theta)\)</span></p></li>
<li><p>Prior = <span class="math notranslate nohighlight">\(p(\theta)\)</span></p></li>
<li><p>Marginal probability of the data = <span class="math notranslate nohighlight">\(p(landuse)\)</span></p></li>
</ol>
<div class="section" id="the-prior">
<h4><span class="section-number">6.5.2.1. </span>The prior<a class="headerlink" href="#the-prior" title="Permalink to this headline">#</a></h4>
<p>The prior is <span class="math notranslate nohighlight">\(p(\theta)\)</span> which we define as <strong>the probability of exceeding the threshhold at the parent aggregation level</strong>. That is we consider the the probability of exceeding the threshhold in the survey area by considering the results at the survey area and taking the results of all the data as prior knowledge.</p>
<div class="math notranslate nohighlight">
\[p(\theta_{survey area} | landuse_{surveyarea}) = \frac{p(landuse_{surveyarea}|\theta_{surveyarea})*p(\theta_{alldata})}{p(landuse_{surveyarea})}\]</div>
<p>Then the probability of exceeding the threshold in the survey area is used as the prior for the lake:</p>
<div class="math notranslate nohighlight">
\[p(\theta_{lake} | landuse_{lake}) = \frac{p(landuse_{lake}|\theta_{lake})*p(\theta_{surveyarea})}{p(landuse_{lake})}\]</div>
<p><strong>Scaling the prior</strong> means optimizing the parameters of the Beta function in such away that the <em>prior</em> results do not overwhelm the survey results or the inverse. For example at the lake level k=1’220 and n=2’524 but the results for mullermatte are k=10 and n=12. The known values (our prior lake data) is two orders of magnitude greater than our sample results.</p>
<div class="math notranslate nohighlight">
\[ E[Beta(1'220, (2'524-1'220))] \approx 0.483359746 \approx E[Beta(11.587249777917547, 12.385060418239757)] \]</div>
<p>In other words we can use different values of n and k to get the same expected results from the Beta distribution. The orginal values are optimized by finding the minimum values for n and (n-k) that satisfy the above requirements. (<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/optimize.html#root-finding">Optimization and Roots</a>) (<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/optimize.root-hybr.html#optimize-root-hybr">Root method</a>) (<a class="reference external" href="https://en.wikipedia.org/wiki/Powell%27s_method">Powell’s method</a>)</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculating the probability of exceeding the threshold</span>

<span class="k">def</span> <span class="nf">minimize_alpha_beta_beta</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span><span class="p">):</span>
    
    <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
    <span class="c1"># define the mean and variance in terms of the parameters</span>
    <span class="c1"># mean or mu</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">/</span><span class="p">(</span><span class="n">alpha</span><span class="o">+</span><span class="n">beta</span><span class="p">)</span>    
    
    <span class="c1"># standard deviation</span>
    <span class="n">v</span> <span class="o">=</span>  <span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span><span class="o">/</span><span class="p">(((</span><span class="n">alpha</span><span class="o">+</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">alpha</span><span class="o">+</span><span class="n">beta</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="p">[</span><span class="n">m</span> <span class="o">-</span> <span class="n">mu</span><span class="p">,</span> <span class="n">v</span> <span class="o">-</span> <span class="n">var</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">getAlphaBeta</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">mu</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">mu</span><span class="p">)</span>

    <span class="n">beta</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span>

<span class="k">def</span> <span class="nf">update_alpha_beta_for_a_code</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">start_scale</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
    
    <span class="n">k</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">data</span>    
    <span class="n">mu</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">mu</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mu is zero&quot;</span><span class="p">)</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="mf">0.0001</span>
    <span class="n">var</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">/</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">var</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>
        <span class="n">var</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">getAlphaBeta</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span> 
    
    <span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">minimize_alpha_beta_beta</span><span class="p">,</span> <span class="n">start_scale</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">var</span><span class="p">))</span><span class="o">.</span><span class="n">x</span>
    
    <span class="k">return</span> <span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">,</span> <span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span>

<span class="k">def</span> <span class="nf">make_beta</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n_minus_k</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Makes a beta object.&quot;&quot;&quot;</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">beta</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n_minus_k</span><span class="p">)</span>
    <span class="n">dist</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">k</span>
    <span class="n">dist</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">n_minus_k</span>
    <span class="k">return</span> <span class="n">dist</span>

<span class="k">def</span> <span class="nf">update_beta</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update a beta distribution.&quot;&quot;&quot;</span>
    <span class="n">k</span><span class="p">,</span> <span class="n">n_minus_k</span> <span class="o">=</span> <span class="n">data</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">k</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">beta</span> <span class="o">+</span> <span class="n">n_minus_k</span>
    <span class="k">return</span> <span class="n">make_beta</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">y_prior</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">,</span> <span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">update_alpha_beta_for_a_code</span><span class="p">((</span><span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span><span class="p">))</span>
    <span class="n">prior_beta</span> <span class="o">=</span> <span class="n">make_beta</span><span class="p">(</span><span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">prior_beta</span>

<span class="k">def</span> <span class="nf">updated_prior</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">scaled</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
    <span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">,</span> <span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">update_alpha_beta_for_a_code</span><span class="p">((</span><span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">scaled</span><span class="p">:</span>
        <span class="n">updated_prior</span> <span class="o">=</span> <span class="n">update_beta</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="p">(</span><span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">updated_prior</span> <span class="o">=</span> <span class="n">update_beta</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">k</span><span class="p">))</span>
        
    <span class="n">yupdated</span> <span class="o">=</span> <span class="p">[</span><span class="n">updated_prior</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">updated_prior</span><span class="p">,</span> <span class="n">yupdated</span>


<span class="c1"># probability of exceeding the threshold for all data</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span> <span class="o">=</span> <span class="n">all_data</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">all_data</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">,</span> <span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">update_alpha_beta_for_a_code</span><span class="p">((</span><span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span><span class="p">))</span>
<span class="n">a_prior</span> <span class="o">=</span> <span class="n">make_beta</span><span class="p">(</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">.5</span><span class="p">)</span>
<span class="n">prior_beta</span> <span class="o">=</span> <span class="n">update_beta</span><span class="p">(</span><span class="n">a_prior</span><span class="p">,</span> <span class="p">(</span><span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">))</span>
<span class="n">yprior</span> <span class="o">=</span> <span class="p">[</span><span class="n">prior_beta</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>

<span class="c1"># probability of exceeding the threshold for the survey area</span>
<span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span> <span class="o">=</span> <span class="n">r_bas</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">r_bas</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">,</span> <span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">update_alpha_beta_for_a_code</span><span class="p">((</span><span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span><span class="p">))</span>
<span class="n">rbass_probs</span> <span class="o">=</span> <span class="n">update_beta</span><span class="p">(</span><span class="n">prior_beta</span><span class="p">,</span> <span class="p">(</span><span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">))</span>
<span class="n">yrbass</span> <span class="o">=</span> <span class="p">[</span><span class="n">rbass_probs</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>

<span class="c1"># probability of exceeding the threshhold for the lake</span>
<span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">feature</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">,</span> <span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">update_alpha_beta_for_a_code</span><span class="p">((</span><span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span><span class="p">))</span>
<span class="n">lake_probs</span> <span class="o">=</span> <span class="n">update_beta</span><span class="p">(</span><span class="n">rbass_probs</span><span class="p">,</span> <span class="p">(</span><span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">))</span>
<span class="n">y1</span> <span class="o">=</span> <span class="p">[</span><span class="n">lake_probs</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>

<span class="c1"># probability of exceeding the threshhold for similar locations</span>
<span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">location</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">,</span> <span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">update_alpha_beta_for_a_code</span><span class="p">((</span><span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span><span class="p">))</span>
<span class="n">location_probs</span> <span class="o">=</span> <span class="n">update_beta</span><span class="p">(</span><span class="n">lake_probs</span><span class="p">,</span> <span class="p">(</span><span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">))</span>
<span class="n">y2</span> <span class="o">=</span> <span class="p">[</span><span class="n">location_probs</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>

<span class="c1"># probability of exceeding the threshhold for mullermatte</span>
<span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span> <span class="o">=</span> <span class="n">tested</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">beach</span><span class="p">]</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">tested</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">beach</span><span class="p">]</span><span class="o">.</span><span class="n">n</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">,</span> <span class="n">kscaled</span><span class="p">,</span> <span class="n">nscaled</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">update_alpha_beta_for_a_code</span><span class="p">((</span><span class="n">observed_alpha</span><span class="p">,</span> <span class="n">observed_beta</span><span class="p">))</span>
<span class="n">expected_probs</span> <span class="o">=</span> <span class="n">update_beta</span><span class="p">(</span><span class="n">location_probs</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">k</span><span class="p">))</span>
<span class="n">y3</span> <span class="o">=</span> <span class="p">[</span><span class="n">expected_probs</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">yprior_e</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">prior_beta</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="mf">.9</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">rbas_prior</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">rbass_probs</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="mf">.9</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">lake_prior</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">lake_probs</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="mf">.9</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">location_prior</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">location_probs</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="mf">.9</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">expected</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">expected_probs</span><span class="o">.</span><span class="n">interval</span><span class="p">(</span><span class="mf">.9</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;The probability of exceeding the national median</span><span class="se">\n</span><span class="s2"> of snack wrappers in the Aare survey area and Bielersee&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">yprior</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">yprior</span><span class="p">),</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;All data, 90% ci = </span><span class="si">{</span><span class="n">yprior_e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">yrbass</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">yrbass</span><span class="p">),</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Aare survey area, 90% ci = </span><span class="si">{</span><span class="n">rbas_prior</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">y1</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">y1</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Bielersee, 90% ci = </span><span class="si">{</span><span class="n">lake_prior</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">y2</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">y2</span><span class="p">),</span> <span class="s1">&#39;y-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Locations similar to mullermatte, 90% ci = </span><span class="si">{</span><span class="n">location_prior</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">y3</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">y3</span><span class="p">),</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">beach</span><span class="si">}</span><span class="s1">, 90% ci = </span><span class="si">{</span><span class="n">expected</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/fbceff81eeeb850329298c466c3debb8ce70b220643f90b1f22591175b9e477e.png" src="_images/fbceff81eeeb850329298c466c3debb8ce70b220643f90b1f22591175b9e477e.png" />
</div>
</div>
</div>
</div>
<div class="section" id="logistic-regression">
<h3><span class="section-number">6.5.3. </span>Logistic regression<a class="headerlink" href="#logistic-regression" title="Permalink to this headline">#</a></h3>
</div>
<div class="section" id="infrastructure">
<h3><span class="section-number">6.5.4. </span>Infrastructure<a class="headerlink" href="#infrastructure" title="Permalink to this headline">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">expit</span>

<span class="n">log_of</span> <span class="o">=</span> <span class="n">to_test</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">log_of</span> <span class="o">=</span> <span class="n">log_of</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">]]</span>
<span class="n">ict</span> <span class="o">=</span> <span class="n">aglu</span><span class="p">[</span><span class="n">aglu</span><span class="o">.</span><span class="n">use</span> <span class="o">==</span> <span class="s2">&quot;infrastructure&quot;</span><span class="p">][[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;scaled&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span>
<span class="n">ict</span> <span class="o">=</span> <span class="n">ict</span><span class="p">[</span><span class="s2">&quot;scaled&quot;</span><span class="p">]</span>
<span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;infrastructure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ict</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>


<span class="n">obj_min</span><span class="p">,</span> <span class="n">obj_max</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">infrastructure</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">log_of</span><span class="o">.</span><span class="n">infrastructure</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;failed ~ infrastructure&#39;</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">logit</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">log_of</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">inter</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Intercept&#39;</span><span class="p">]</span>
<span class="n">slope</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;infrastructure&#39;</span><span class="p">]</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">obj_min</span><span class="p">,</span> <span class="n">obj_max</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">.01</span><span class="p">)</span>

<span class="n">log_odds</span> <span class="o">=</span> <span class="n">inter</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">xs</span>
<span class="n">odds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_odds</span><span class="p">)</span>

<span class="n">ps_x</span> <span class="o">=</span> <span class="n">expit</span><span class="p">(</span><span class="n">inter</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">xs</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ps_x</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;infrastructure&quot;</span><span class="p">],</span> <span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Infrastructure&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Percent of land-use&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability of exceeding threshhold&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">.1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/471382e0eef125b9734370daf353feecb57ea53b1a74490b9bde15063f7dc81e.png" src="_images/471382e0eef125b9734370daf353feecb57ea53b1a74490b9bde15063f7dc81e.png" />
</div>
</div>
</div>
<div class="section" id="urbanization">
<h3><span class="section-number">6.5.5. </span>Urbanization<a class="headerlink" href="#urbanization" title="Permalink to this headline">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">log_of</span> <span class="o">=</span> <span class="n">to_test</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">log_of</span> <span class="o">=</span> <span class="n">log_of</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">]]</span>

<span class="n">ict</span> <span class="o">=</span> <span class="n">aglu</span><span class="p">[</span><span class="n">aglu</span><span class="o">.</span><span class="n">use</span> <span class="o">==</span> <span class="s2">&quot;Siedl&quot;</span><span class="p">][[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;scaled&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span>
<span class="n">ict</span> <span class="o">=</span> <span class="n">ict</span><span class="p">[</span><span class="s2">&quot;scaled&quot;</span><span class="p">]</span>
<span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;Siedl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ict</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>

<span class="n">obj_min</span><span class="p">,</span> <span class="n">obj_max</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">Siedl</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">log_of</span><span class="o">.</span><span class="n">Siedl</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;failed ~ Siedl&#39;</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">logit</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">log_of</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">inter</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Intercept&#39;</span><span class="p">]</span>
<span class="n">slope</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Siedl&#39;</span><span class="p">]</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">obj_min</span><span class="p">,</span> <span class="n">obj_max</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">.1</span><span class="p">)</span>

<span class="n">log_odds</span> <span class="o">=</span> <span class="n">inter</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">xs</span>
<span class="n">odds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_odds</span><span class="p">)</span>

<span class="n">ps_x</span> <span class="o">=</span> <span class="n">expit</span><span class="p">(</span><span class="n">inter</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">xs</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ps_x</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;Siedl&quot;</span><span class="p">],</span> <span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Buildings/urban&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Percent of land-use&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability of exceeding threshhold&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">.1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/848182436bae9904d459b36b8b328dda1879a967cb4a6dff2f1d9b23ca14ad16.png" src="_images/848182436bae9904d459b36b8b328dda1879a967cb4a6dff2f1d9b23ca14ad16.png" />
</div>
</div>
</div>
<div class="section" id="forest">
<h3><span class="section-number">6.5.6. </span>Forest<a class="headerlink" href="#forest" title="Permalink to this headline">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">log_of</span> <span class="o">=</span> <span class="n">to_test</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">log_of</span> <span class="o">=</span> <span class="n">log_of</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">]]</span>

<span class="n">ict</span> <span class="o">=</span> <span class="n">aglu</span><span class="p">[</span><span class="n">aglu</span><span class="o">.</span><span class="n">use</span> <span class="o">==</span> <span class="s2">&quot;Wald&quot;</span><span class="p">][[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;scaled&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span>
<span class="n">ict</span> <span class="o">=</span> <span class="n">ict</span><span class="p">[</span><span class="s2">&quot;scaled&quot;</span><span class="p">]</span>
<span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;Wald&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ict</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>

<span class="n">obj_min</span><span class="p">,</span> <span class="n">obj_max</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">Wald</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">log_of</span><span class="o">.</span><span class="n">Wald</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;failed ~ Wald&#39;</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">logit</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">log_of</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">inter</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Intercept&#39;</span><span class="p">]</span>
<span class="n">slope</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Wald&#39;</span><span class="p">]</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">obj_min</span><span class="p">,</span> <span class="n">obj_max</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">.1</span><span class="p">)</span>

<span class="n">log_odds</span> <span class="o">=</span> <span class="n">inter</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">xs</span>
<span class="n">odds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_odds</span><span class="p">)</span>

<span class="n">ps_x</span> <span class="o">=</span> <span class="n">expit</span><span class="p">(</span><span class="n">inter</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">xs</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ps_x</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;Wald&quot;</span><span class="p">],</span> <span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Forests/woods&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Percent of land-use&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability of exceeding threshhold&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">.1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/895a03fee5e76647a949aa84e93b6df12451339c392644c57f2c3e7b879b11b3.png" src="_images/895a03fee5e76647a949aa84e93b6df12451339c392644c57f2c3e7b879b11b3.png" />
</div>
</div>
</div>
<div class="section" id="undefined">
<h3><span class="section-number">6.5.7. </span>Undefined<a class="headerlink" href="#undefined" title="Permalink to this headline">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">log_of</span> <span class="o">=</span> <span class="n">to_test</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">log_of</span> <span class="o">=</span> <span class="n">log_of</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">]]</span>

<span class="n">ict</span> <span class="o">=</span> <span class="n">aglu</span><span class="p">[</span><span class="n">aglu</span><span class="o">.</span><span class="n">use</span> <span class="o">==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">][[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;scaled&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span>
<span class="n">ict</span> <span class="o">=</span> <span class="n">ict</span><span class="p">[</span><span class="s2">&quot;scaled&quot;</span><span class="p">]</span>
<span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;Undefined&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ict</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>

<span class="n">obj_min</span><span class="p">,</span> <span class="n">obj_max</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">Undefined</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">log_of</span><span class="o">.</span><span class="n">Undefined</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;failed ~ Undefined&#39;</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">logit</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">log_of</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">inter</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Intercept&#39;</span><span class="p">]</span>
<span class="n">slope</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Undefined&#39;</span><span class="p">]</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">obj_min</span><span class="p">,</span> <span class="n">obj_max</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">.1</span><span class="p">)</span>

<span class="n">log_odds</span> <span class="o">=</span> <span class="n">inter</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">xs</span>
<span class="n">odds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_odds</span><span class="p">)</span>

<span class="n">ps_x</span> <span class="o">=</span> <span class="n">expit</span><span class="p">(</span><span class="n">inter</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">xs</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ps_x</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;Undefined&quot;</span><span class="p">],</span> <span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Land use not defined in map&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Percent of land-use&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability of exceeding threshhold&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">.1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/0b7d7393f476f3de113540313719e33816b577ec36a81be1ae39481625f39473.png" src="_images/0b7d7393f476f3de113540313719e33816b577ec36a81be1ae39481625f39473.png" />
</div>
</div>
</div>
<div class="section" id="recreation">
<h3><span class="section-number">6.5.8. </span>Recreation<a class="headerlink" href="#recreation" title="Permalink to this headline">#</a></h3>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">log_of</span> <span class="o">=</span> <span class="n">to_test</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">log_of</span> <span class="o">=</span> <span class="n">log_of</span><span class="p">[[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;failed&quot;</span><span class="p">]]</span>

<span class="n">ict</span> <span class="o">=</span> <span class="n">aglu</span><span class="p">[</span><span class="n">aglu</span><span class="o">.</span><span class="n">use</span> <span class="o">==</span> <span class="s2">&quot;recreation&quot;</span><span class="p">][[</span><span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;scaled&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;location&quot;</span><span class="p">)</span>
<span class="n">ict</span> <span class="o">=</span> <span class="n">ict</span><span class="p">[</span><span class="s2">&quot;scaled&quot;</span><span class="p">]</span>
<span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;recreation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ict</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>

<span class="n">obj_min</span><span class="p">,</span> <span class="n">obj_max</span> <span class="o">=</span> <span class="n">log_of</span><span class="o">.</span><span class="n">recreation</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">log_of</span><span class="o">.</span><span class="n">recreation</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="n">formula</span> <span class="o">=</span> <span class="s1">&#39;failed ~ recreation&#39;</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">logit</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">log_of</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">inter</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Intercept&#39;</span><span class="p">]</span>
<span class="n">slope</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;recreation&#39;</span><span class="p">]</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">obj_min</span><span class="p">,</span> <span class="n">obj_max</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">.1</span><span class="p">)</span>

<span class="n">log_odds</span> <span class="o">=</span> <span class="n">inter</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">xs</span>
<span class="n">odds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_odds</span><span class="p">)</span>

<span class="n">ps_x</span> <span class="o">=</span> <span class="n">expit</span><span class="p">(</span><span class="n">inter</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">xs</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ps_x</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;recreation&quot;</span><span class="p">],</span> <span class="n">log_of</span><span class="p">[</span><span class="s2">&quot;failed&quot;</span><span class="p">],</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Recreation/sports/camping&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Kilometers²&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability of exceeding threshhold&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">.1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="_images/dfd4406ca8880afd5762c0639bb62699d690a0ee9ddf99048804b5023948d220.png" src="_images/dfd4406ca8880afd5762c0639bb62699d690a0ee9ddf99048804b5023948d220.png" />
</div>
</div>
</div>
<div class="section" id="distance-to-river-intersection">
<h3><span class="section-number">6.5.9. </span>Distance to river intersection<a class="headerlink" href="#distance-to-river-intersection" title="Permalink to this headline">#</a></h3>
<p><em>Currently being edited</em></p>
<div class="cell tag_remove-input docutils container">
</div>
</div>
<div class="section" id="length-of-river-intersects">
<h3><span class="section-number">6.5.10. </span>Length of river intersects<a class="headerlink" href="#length-of-river-intersects" title="Permalink to this headline">#</a></h3>
<p><em>Currently being edited</em></p>
<div class="cell tag_remove-input docutils container">
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">threshhold</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.11
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<p>This script updated 23/05/2023 in Biel, CH</p>
<blockquote>
<div><p>❤️ what you do everyday</p>
</div></blockquote>
<p><em>analyst at hammerdirt</em></p>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Git repo: https://github.com/hammerdirt-analyst/landuse.git

Git branch: probability

IPython    : 8.12.0
PIL        : 9.5.0
numpy      : 1.24.2
seaborn    : 0.12.2
matplotlib : 3.7.1
statsmodels: 0.13.5
scipy      : 1.10.1
pandas     : 2.0.0
json       : 2.0.9
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="hex-3000-m.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">5. </span>All Data – New map data</p>
      </div>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivation">6.1. Motivation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#proposition">6.1.1. Proposition</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methods-of-inference">6.2. Methods of inference</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#binomial-distribution">6.2.1. Binomial distribution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#odds-and-log-odds">6.2.2. Odds and log odds</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#variables">6.3. Variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data">6.4. Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#survey-data">6.4.1. Survey data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-land-use-data">6.4.2. The land use data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#aggregating-scaling-and-binning">6.4.2.1. Aggregating, scaling and binning</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#testing-the-threshold">6.5. Testing the threshold</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-odds-and-frequency-of-exceeding-the-threshold">6.5.1. The odds and frequency of exceeding the threshold</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-probability-of-exceeding-the-threshold">6.5.2. The probability of exceeding the threshold</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-prior">6.5.2.1. The prior</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#logistic-regression">6.5.3. Logistic regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#infrastructure">6.5.4. Infrastructure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#urbanization">6.5.5. Urbanization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#forest">6.5.6. Forest</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#undefined">6.5.7. Undefined</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#recreation">6.5.8. Recreation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distance-to-river-intersection">6.5.9. Distance to river intersection</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#length-of-river-intersects">6.5.10. Length of river intersects</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Schreyer et all
</p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <p>
   hammerdirt 2023
</p>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>